(function(Q,H){typeof exports=="object"&&typeof module!="undefined"?H(exports):typeof define=="function"&&define.amd?define(["exports"],H):(Q=typeof globalThis!="undefined"?globalThis:Q||self,H(Q.AMap=Q.AMap||{}))})(this,function(Q){"use strict";var H={exports:{}};H.exports=lr,H.exports.default=lr;function lr(r,e,n){n=n||2;var t=e&&e.length,i=t?e[0]*n:r.length,a=Br(r,0,i,n,!0),s=[];if(!a||a.next===a.prev)return s;var h,c,l,f,v,o,M;if(t&&(a=fn(r,e,a,n)),r.length>80*n){h=l=r[0],c=f=r[1];for(var p=n;p<i;p+=n)v=r[p],o=r[p+1],v<h&&(h=v),o<c&&(c=o),v>l&&(l=v),o>f&&(f=o);M=Math.max(l-h,f-c),M=M!==0?32767/M:0}return nr(a,s,n,h,c,M,0),s}function Br(r,e,n,t,i){var a,s;if(i===$r(r,e,n,t)>0)for(a=e;a<n;a+=t)s=Vr(a,r[a],r[a+1],s);else for(a=n-t;a>=e;a-=t)s=Vr(a,r[a],r[a+1],s);return s&&fr(s,s.next)&&(ir(s),s=s.next),s}function J(r,e){if(!r)return r;e||(e=r);var n=r,t;do if(t=!1,!n.steiner&&(fr(n,n.next)||q(n.prev,n,n.next)===0)){if(ir(n),n=e=n.prev,n===n.next)break;t=!0}else n=n.next;while(t||n!==e);return e}function nr(r,e,n,t,i,a,s){if(!!r){!s&&a&&yn(r,t,i,a);for(var h=r,c,l;r.prev!==r.next;){if(c=r.prev,l=r.next,a?hn(r,t,i,a):sn(r)){e.push(c.i/n|0),e.push(r.i/n|0),e.push(l.i/n|0),ir(r),r=l.next,h=l.next;continue}if(r=l,r===h){s?s===1?(r=cn(J(r),e,n),nr(r,e,n,t,i,a,2)):s===2&&ln(r,e,n,t,i,a):nr(J(r),e,n,t,i,a,1);break}}}}function sn(r){var e=r.prev,n=r,t=r.next;if(q(e,n,t)>=0)return!1;for(var i=e.x,a=n.x,s=t.x,h=e.y,c=n.y,l=t.y,f=i<a?i<s?i:s:a<s?a:s,v=h<c?h<l?h:l:c<l?c:l,o=i>a?i>s?i:s:a>s?a:s,M=h>c?h>l?h:l:c>l?c:l,p=t.next;p!==e;){if(p.x>=f&&p.x<=o&&p.y>=v&&p.y<=M&&er(i,h,a,c,s,l,p.x,p.y)&&q(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function hn(r,e,n,t){var i=r.prev,a=r,s=r.next;if(q(i,a,s)>=0)return!1;for(var h=i.x,c=a.x,l=s.x,f=i.y,v=a.y,o=s.y,M=h<c?h<l?h:l:c<l?c:l,p=f<v?f<o?f:o:v<o?v:o,x=h>c?h>l?h:l:c>l?c:l,y=f>v?f>o?f:o:v>o?v:o,d=Lr(M,p,e,n,t),R=Lr(x,y,e,n,t),m=r.prevZ,g=r.nextZ;m&&m.z>=d&&g&&g.z<=R;){if(m.x>=M&&m.x<=x&&m.y>=p&&m.y<=y&&m!==i&&m!==s&&er(h,f,c,v,l,o,m.x,m.y)&&q(m.prev,m,m.next)>=0||(m=m.prevZ,g.x>=M&&g.x<=x&&g.y>=p&&g.y<=y&&g!==i&&g!==s&&er(h,f,c,v,l,o,g.x,g.y)&&q(g.prev,g,g.next)>=0))return!1;g=g.nextZ}for(;m&&m.z>=d;){if(m.x>=M&&m.x<=x&&m.y>=p&&m.y<=y&&m!==i&&m!==s&&er(h,f,c,v,l,o,m.x,m.y)&&q(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;g&&g.z<=R;){if(g.x>=M&&g.x<=x&&g.y>=p&&g.y<=y&&g!==i&&g!==s&&er(h,f,c,v,l,o,g.x,g.y)&&q(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function cn(r,e,n){var t=r;do{var i=t.prev,a=t.next.next;!fr(i,a)&&Zr(i,t,t.next,a)&&tr(i,a)&&tr(a,i)&&(e.push(i.i/n|0),e.push(t.i/n|0),e.push(a.i/n|0),ir(t),ir(t.next),t=r=a),t=t.next}while(t!==r);return J(t)}function ln(r,e,n,t,i,a){var s=r;do{for(var h=s.next.next;h!==s.prev;){if(s.i!==h.i&&dn(s,h)){var c=Dr(s,h);s=J(s,s.next),c=J(c,c.next),nr(s,e,n,t,i,a,0),nr(c,e,n,t,i,a,0);return}h=h.next}s=s.next}while(s!==r)}function fn(r,e,n,t){var i=[],a,s,h,c,l;for(a=0,s=e.length;a<s;a++)h=e[a]*t,c=a<s-1?e[a+1]*t:r.length,l=Br(r,h,c,t,!1),l===l.next&&(l.steiner=!0),i.push(mn(l));for(i.sort(on),a=0;a<i.length;a++)n=vn(i[a],n);return n}function on(r,e){return r.x-e.x}function vn(r,e){var n=Mn(r,e);if(!n)return e;var t=Dr(n,r);return J(t,t.next),J(n,n.next)}function Mn(r,e){var n=e,t=r.x,i=r.y,a=-1/0,s;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var h=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(h<=t&&h>a&&(a=h,s=n.x<n.next.x?n:n.next,h===t))return s}n=n.next}while(n!==e);if(!s)return null;var c=s,l=s.x,f=s.y,v=1/0,o;n=s;do t>=n.x&&n.x>=l&&t!==n.x&&er(i<f?t:a,i,l,f,i<f?a:t,i,n.x,n.y)&&(o=Math.abs(i-n.y)/(t-n.x),tr(n,r)&&(o<v||o===v&&(n.x>s.x||n.x===s.x&&pn(s,n)))&&(s=n,v=o)),n=n.next;while(n!==c);return s}function pn(r,e){return q(r.prev,r,e.prev)<0&&q(e.next,r,r.next)<0}function yn(r,e,n,t){var i=r;do i.z===0&&(i.z=Lr(i.x,i.y,e,n,t)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,xn(i)}function xn(r){var e,n,t,i,a,s,h,c,l=1;do{for(n=r,r=null,a=null,s=0;n;){for(s++,t=n,h=0,e=0;e<l&&(h++,t=t.nextZ,!!t);e++);for(c=l;h>0||c>0&&t;)h!==0&&(c===0||!t||n.z<=t.z)?(i=n,n=n.nextZ,h--):(i=t,t=t.nextZ,c--),a?a.nextZ=i:r=i,i.prevZ=a,a=i;n=t}a.nextZ=null,l*=2}while(s>1);return r}function Lr(r,e,n,t,i){return r=(r-n)*i|0,e=(e-t)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function mn(r){var e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function er(r,e,n,t,i,a,s,h){return(i-s)*(e-h)>=(r-s)*(a-h)&&(r-s)*(t-h)>=(n-s)*(e-h)&&(n-s)*(a-h)>=(i-s)*(t-h)}function dn(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!gn(r,e)&&(tr(r,e)&&tr(e,r)&&un(r,e)&&(q(r.prev,r,e.prev)||q(r,e.prev,e))||fr(r,e)&&q(r.prev,r,r.next)>0&&q(e.prev,e,e.next)>0)}function q(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function fr(r,e){return r.x===e.x&&r.y===e.y}function Zr(r,e,n,t){var i=vr(q(r,e,n)),a=vr(q(r,e,t)),s=vr(q(n,t,r)),h=vr(q(n,t,e));return!!(i!==a&&s!==h||i===0&&or(r,n,e)||a===0&&or(r,t,e)||s===0&&or(n,r,t)||h===0&&or(n,e,t))}function or(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function vr(r){return r>0?1:r<0?-1:0}function gn(r,e){var n=r;do{if(n.i!==r.i&&n.next.i!==r.i&&n.i!==e.i&&n.next.i!==e.i&&Zr(n,n.next,r,e))return!0;n=n.next}while(n!==r);return!1}function tr(r,e){return q(r.prev,r,r.next)<0?q(r,e,r.next)>=0&&q(r,r.prev,e)>=0:q(r,e,r.prev)<0||q(r,r.next,e)<0}function un(r,e){var n=r,t=!1,i=(r.x+e.x)/2,a=(r.y+e.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(t=!t),n=n.next;while(n!==r);return t}function Dr(r,e){var n=new wr(r.i,r.x,r.y),t=new wr(e.i,e.x,e.y),i=r.next,a=e.prev;return r.next=e,e.prev=r,n.next=i,i.prev=n,t.next=n,n.prev=t,a.next=t,t.prev=a,t}function Vr(r,e,n,t){var i=new wr(r,e,n);return t?(i.next=t.next,i.prev=t,t.next.prev=i,t.next=i):(i.prev=i,i.next=i),i}function ir(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function wr(r,e,n){this.i=r,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}lr.deviation=function(r,e,n,t){var i=e&&e.length,a=i?e[0]*n:r.length,s=Math.abs($r(r,0,a,n));if(i)for(var h=0,c=e.length;h<c;h++){var l=e[h]*n,f=h<c-1?e[h+1]*n:r.length;s-=Math.abs($r(r,l,f,n))}var v=0;for(h=0;h<t.length;h+=3){var o=t[h]*n,M=t[h+1]*n,p=t[h+2]*n;v+=Math.abs((r[o]-r[p])*(r[M+1]-r[o+1])-(r[o]-r[M])*(r[p+1]-r[o+1]))}return s===0&&v===0?0:Math.abs((v-s)/s)};function $r(r,e,n,t){for(var i=0,a=e,s=n-t;a<n;a+=t)i+=(r[s]-r[a])*(r[a+1]+r[s+1]),s=a;return i}lr.flatten=function(r){for(var e=r[0][0].length,n={vertices:[],holes:[],dimensions:e},t=0,i=0;i<r.length;i++){for(var a=0;a<r[i].length;a++)for(var s=0;s<e;s++)n.vertices.push(r[i][a][s]);i>0&&(t+=r[i-1].length,n.holes.push(t))}return n};const X={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function Tn(r,{precision:e=X.precision}={}){return r=_n(r),"".concat(parseFloat(r.toPrecision(e)))}function zr(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Xr(r,e,n){const t=X.EPSILON;n&&(X.EPSILON=n);try{if(r===e)return!0;if(zr(r)&&zr(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!Xr(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=X.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{X.EPSILON=t}}function _n(r){return Math.round(r/X.EPSILON)*X.EPSILON}function En(r){function e(){var n=Reflect.construct(r,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(r.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r,e}class Rn extends En(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let t=0;t<this.ELEMENTS;++t)this[t]=e[t+n];return this.check()}toArray(e=[],n=0){for(let t=0;t<this.ELEMENTS;++t)e[n+t]=this[t];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:zr(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(X)}formatString(e){let n="";for(let t=0;t<this.ELEMENTS;++t)n+=(t>0?", ":"")+Tn(this[t],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Xr(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,t){if(t===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const a=e[i];this[i]=a+t*(n[i]-a)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(Math.max(this[t],e[t]),n[t]);return this.check()}add(...e){for(const n of e)for(let t=0;t<this.ELEMENTS;++t)this[t]+=n[t];return this.check()}subtract(...e){for(const n of e)for(let t=0;t<this.ELEMENTS;++t)this[t]-=n[t];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(X.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(Math.max(this[t],e),n);return this.check()}get elements(){return this}}function On(r,e){if(r.length!==e)return!1;for(let n=0;n<r.length;++n)if(!Number.isFinite(r[n]))return!1;return!0}function An(r){if(!Number.isFinite(r))throw new Error("Invalid number ".concat(r));return r}function Sr(r,e,n=""){if(X.debug&&!On(r,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return r}var E={},W={};Object.defineProperty(W,"__esModule",{value:!0}),W.setMatrixArrayType=Ln,W.toRadian=$n,W.equals=zn,W.RANDOM=W.ARRAY_TYPE=W.EPSILON=void 0;var Ur=1e-6;W.EPSILON=Ur;var Ir=typeof Float32Array!="undefined"?Float32Array:Array;W.ARRAY_TYPE=Ir;var Pn=Math.random;W.RANDOM=Pn;function Ln(r){W.ARRAY_TYPE=Ir=r}var wn=Math.PI/180;function $n(r){return r*wn}function zn(r,e){return Math.abs(r-e)<=Ur*Math.max(1,Math.abs(r),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function Mr(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Mr=function(n){return typeof n}:Mr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Mr(r)}Object.defineProperty(E,"__esModule",{value:!0}),E.create=Gr,E.clone=Nn,E.fromValues=Fn,E.copy=qn,E.set=Yn,E.add=kn,E.subtract=Hr,E.multiply=Qr,E.divide=Jr,E.ceil=bn,E.floor=Wn,E.min=Bn,E.max=Zn,E.round=Dn,E.scale=Vn,E.scaleAndAdd=Xn,E.distance=jr,E.squaredDistance=re,E.length=ee,E.squaredLength=ne,E.negate=Un,E.inverse=In,E.normalize=Kn,E.dot=Gn,E.cross=Hn,E.lerp=Qn,E.random=Jn,E.transformMat2=jn,E.transformMat2d=rt,E.transformMat3=et;var Sn=E.transformMat4=nt;E.rotate=tt,E.angle=it,E.zero=at,E.str=st,E.exactEquals=ht,E.equals=ct,E.forEach=E.sqrLen=E.sqrDist=E.dist=E.div=E.mul=E.sub=E.len=void 0;var j=Cn(W);function Kr(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Kr=function(i){return i?n:e})(r)}function Cn(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||Mr(r)!=="object"&&typeof r!="function")return{default:r};var n=Kr(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function Gr(){var r=new j.ARRAY_TYPE(2);return j.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0),r}function Nn(r){var e=new j.ARRAY_TYPE(2);return e[0]=r[0],e[1]=r[1],e}function Fn(r,e){var n=new j.ARRAY_TYPE(2);return n[0]=r,n[1]=e,n}function qn(r,e){return r[0]=e[0],r[1]=e[1],r}function Yn(r,e,n){return r[0]=e,r[1]=n,r}function kn(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r}function Hr(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r}function Qr(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r}function Jr(r,e,n){return r[0]=e[0]/n[0],r[1]=e[1]/n[1],r}function bn(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r}function Wn(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r}function Bn(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r}function Zn(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r}function Dn(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r}function Vn(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r}function Xn(r,e,n,t){return r[0]=e[0]+n[0]*t,r[1]=e[1]+n[1]*t,r}function jr(r,e){var n=e[0]-r[0],t=e[1]-r[1];return Math.hypot(n,t)}function re(r,e){var n=e[0]-r[0],t=e[1]-r[1];return n*n+t*t}function ee(r){var e=r[0],n=r[1];return Math.hypot(e,n)}function ne(r){var e=r[0],n=r[1];return e*e+n*n}function Un(r,e){return r[0]=-e[0],r[1]=-e[1],r}function In(r,e){return r[0]=1/e[0],r[1]=1/e[1],r}function Kn(r,e){var n=e[0],t=e[1],i=n*n+t*t;return i>0&&(i=1/Math.sqrt(i)),r[0]=e[0]*i,r[1]=e[1]*i,r}function Gn(r,e){return r[0]*e[0]+r[1]*e[1]}function Hn(r,e,n){var t=e[0]*n[1]-e[1]*n[0];return r[0]=r[1]=0,r[2]=t,r}function Qn(r,e,n,t){var i=e[0],a=e[1];return r[0]=i+t*(n[0]-i),r[1]=a+t*(n[1]-a),r}function Jn(r,e){e=e||1;var n=j.RANDOM()*2*Math.PI;return r[0]=Math.cos(n)*e,r[1]=Math.sin(n)*e,r}function jn(r,e,n){var t=e[0],i=e[1];return r[0]=n[0]*t+n[2]*i,r[1]=n[1]*t+n[3]*i,r}function rt(r,e,n){var t=e[0],i=e[1];return r[0]=n[0]*t+n[2]*i+n[4],r[1]=n[1]*t+n[3]*i+n[5],r}function et(r,e,n){var t=e[0],i=e[1];return r[0]=n[0]*t+n[3]*i+n[6],r[1]=n[1]*t+n[4]*i+n[7],r}function nt(r,e,n){var t=e[0],i=e[1];return r[0]=n[0]*t+n[4]*i+n[12],r[1]=n[1]*t+n[5]*i+n[13],r}function tt(r,e,n,t){var i=e[0]-n[0],a=e[1]-n[1],s=Math.sin(t),h=Math.cos(t);return r[0]=i*h-a*s+n[0],r[1]=i*s+a*h+n[1],r}function it(r,e){var n=r[0],t=r[1],i=e[0],a=e[1],s=Math.sqrt(n*n+t*t)*Math.sqrt(i*i+a*a),h=s&&(n*i+t*a)/s;return Math.acos(Math.min(Math.max(h,-1),1))}function at(r){return r[0]=0,r[1]=0,r}function st(r){return"vec2("+r[0]+", "+r[1]+")"}function ht(r,e){return r[0]===e[0]&&r[1]===e[1]}function ct(r,e){var n=r[0],t=r[1],i=e[0],a=e[1];return Math.abs(n-i)<=j.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(t-a)<=j.EPSILON*Math.max(1,Math.abs(t),Math.abs(a))}var lt=ee;E.len=lt;var ft=Hr;E.sub=ft;var ot=Qr;E.mul=ot;var vt=Jr;E.div=vt;var Mt=jr;E.dist=Mt;var pt=re;E.sqrDist=pt;var yt=ne;E.sqrLen=yt;var xt=function(){var r=Gr();return function(e,n,t,i,a,s){var h,c;for(n||(n=2),t||(t=0),i?c=Math.min(i*n+t,e.length):c=e.length,h=t;h<c;h+=n)r[0]=e[h],r[1]=e[h+1],a(r,r,s),e[h]=r[0],e[h+1]=r[1];return e}}();E.forEach=xt;function mt(r,e,n){const t=e[0],i=e[1],a=n[3]*t+n[7]*i||1;return r[0]=(n[0]*t+n[4]*i)/a,r[1]=(n[1]*t+n[5]*i)/a,r}function dt(r,e,n){const t=e[0],i=e[1],a=e[2],s=n[3]*t+n[7]*i+n[11]*a||1;return r[0]=(n[0]*t+n[4]*i+n[8]*a)/s,r[1]=(n[1]*t+n[5]*i+n[9]*a)/s,r[2]=(n[2]*t+n[6]*i+n[10]*a)/s,r}var T={};function pr(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pr=function(n){return typeof n}:pr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},pr(r)}Object.defineProperty(T,"__esModule",{value:!0}),T.create=ie,T.clone=Tt,T.length=ae,T.fromValues=_t,T.copy=Et,T.set=Rt,T.add=Ot,T.subtract=se,T.multiply=he,T.divide=ce,T.ceil=At,T.floor=Pt,T.min=Lt,T.max=wt,T.round=$t,T.scale=zt,T.scaleAndAdd=St,T.distance=le,T.squaredDistance=fe,T.squaredLength=oe,T.negate=Ct,T.inverse=Nt,T.normalize=Ft,T.dot=ve,T.cross=qt,T.lerp=Yt,T.hermite=kt,T.bezier=bt,T.random=Wt;var gt=T.transformMat4=Bt;T.transformMat3=Zt,T.transformQuat=Dt,T.rotateX=Vt,T.rotateY=Xt,T.rotateZ=Ut,T.angle=It,T.zero=Kt,T.str=Gt,T.exactEquals=Ht,T.equals=Qt,T.forEach=T.sqrLen=T.len=T.sqrDist=T.dist=T.div=T.mul=T.sub=void 0;var I=ut(W);function te(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(te=function(i){return i?n:e})(r)}function ut(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||pr(r)!=="object"&&typeof r!="function")return{default:r};var n=te(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function ie(){var r=new I.ARRAY_TYPE(3);return I.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Tt(r){var e=new I.ARRAY_TYPE(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function ae(r){var e=r[0],n=r[1],t=r[2];return Math.hypot(e,n,t)}function _t(r,e,n){var t=new I.ARRAY_TYPE(3);return t[0]=r,t[1]=e,t[2]=n,t}function Et(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function Rt(r,e,n,t){return r[0]=e,r[1]=n,r[2]=t,r}function Ot(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r}function se(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r}function he(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r}function ce(r,e,n){return r[0]=e[0]/n[0],r[1]=e[1]/n[1],r[2]=e[2]/n[2],r}function At(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r}function Pt(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r}function Lt(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r}function wt(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r}function $t(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r}function zt(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r}function St(r,e,n,t){return r[0]=e[0]+n[0]*t,r[1]=e[1]+n[1]*t,r[2]=e[2]+n[2]*t,r}function le(r,e){var n=e[0]-r[0],t=e[1]-r[1],i=e[2]-r[2];return Math.hypot(n,t,i)}function fe(r,e){var n=e[0]-r[0],t=e[1]-r[1],i=e[2]-r[2];return n*n+t*t+i*i}function oe(r){var e=r[0],n=r[1],t=r[2];return e*e+n*n+t*t}function Ct(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function Nt(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r}function Ft(r,e){var n=e[0],t=e[1],i=e[2],a=n*n+t*t+i*i;return a>0&&(a=1/Math.sqrt(a)),r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r}function ve(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function qt(r,e,n){var t=e[0],i=e[1],a=e[2],s=n[0],h=n[1],c=n[2];return r[0]=i*c-a*h,r[1]=a*s-t*c,r[2]=t*h-i*s,r}function Yt(r,e,n,t){var i=e[0],a=e[1],s=e[2];return r[0]=i+t*(n[0]-i),r[1]=a+t*(n[1]-a),r[2]=s+t*(n[2]-s),r}function kt(r,e,n,t,i,a){var s=a*a,h=s*(2*a-3)+1,c=s*(a-2)+a,l=s*(a-1),f=s*(3-2*a);return r[0]=e[0]*h+n[0]*c+t[0]*l+i[0]*f,r[1]=e[1]*h+n[1]*c+t[1]*l+i[1]*f,r[2]=e[2]*h+n[2]*c+t[2]*l+i[2]*f,r}function bt(r,e,n,t,i,a){var s=1-a,h=s*s,c=a*a,l=h*s,f=3*a*h,v=3*c*s,o=c*a;return r[0]=e[0]*l+n[0]*f+t[0]*v+i[0]*o,r[1]=e[1]*l+n[1]*f+t[1]*v+i[1]*o,r[2]=e[2]*l+n[2]*f+t[2]*v+i[2]*o,r}function Wt(r,e){e=e||1;var n=I.RANDOM()*2*Math.PI,t=I.RANDOM()*2-1,i=Math.sqrt(1-t*t)*e;return r[0]=Math.cos(n)*i,r[1]=Math.sin(n)*i,r[2]=t*e,r}function Bt(r,e,n){var t=e[0],i=e[1],a=e[2],s=n[3]*t+n[7]*i+n[11]*a+n[15];return s=s||1,r[0]=(n[0]*t+n[4]*i+n[8]*a+n[12])/s,r[1]=(n[1]*t+n[5]*i+n[9]*a+n[13])/s,r[2]=(n[2]*t+n[6]*i+n[10]*a+n[14])/s,r}function Zt(r,e,n){var t=e[0],i=e[1],a=e[2];return r[0]=t*n[0]+i*n[3]+a*n[6],r[1]=t*n[1]+i*n[4]+a*n[7],r[2]=t*n[2]+i*n[5]+a*n[8],r}function Dt(r,e,n){var t=n[0],i=n[1],a=n[2],s=n[3],h=e[0],c=e[1],l=e[2],f=i*l-a*c,v=a*h-t*l,o=t*c-i*h,M=i*o-a*v,p=a*f-t*o,x=t*v-i*f,y=s*2;return f*=y,v*=y,o*=y,M*=2,p*=2,x*=2,r[0]=h+f+M,r[1]=c+v+p,r[2]=l+o+x,r}function Vt(r,e,n,t){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(t)-i[2]*Math.sin(t),a[2]=i[1]*Math.sin(t)+i[2]*Math.cos(t),r[0]=a[0]+n[0],r[1]=a[1]+n[1],r[2]=a[2]+n[2],r}function Xt(r,e,n,t){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[2]*Math.sin(t)+i[0]*Math.cos(t),a[1]=i[1],a[2]=i[2]*Math.cos(t)-i[0]*Math.sin(t),r[0]=a[0]+n[0],r[1]=a[1]+n[1],r[2]=a[2]+n[2],r}function Ut(r,e,n,t){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0]*Math.cos(t)-i[1]*Math.sin(t),a[1]=i[0]*Math.sin(t)+i[1]*Math.cos(t),a[2]=i[2],r[0]=a[0]+n[0],r[1]=a[1]+n[1],r[2]=a[2]+n[2],r}function It(r,e){var n=r[0],t=r[1],i=r[2],a=e[0],s=e[1],h=e[2],c=Math.sqrt(n*n+t*t+i*i),l=Math.sqrt(a*a+s*s+h*h),f=c*l,v=f&&ve(r,e)/f;return Math.acos(Math.min(Math.max(v,-1),1))}function Kt(r){return r[0]=0,r[1]=0,r[2]=0,r}function Gt(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function Ht(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}function Qt(r,e){var n=r[0],t=r[1],i=r[2],a=e[0],s=e[1],h=e[2];return Math.abs(n-a)<=I.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(t-s)<=I.EPSILON*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(i-h)<=I.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))}var Jt=se;T.sub=Jt;var jt=he;T.mul=jt;var ri=ce;T.div=ri;var ei=le;T.dist=ei;var ni=fe;T.sqrDist=ni;var ti=ae;T.len=ti;var ii=oe;T.sqrLen=ii;var ai=function(){var r=ie();return function(e,n,t,i,a,s){var h,c;for(n||(n=3),t||(t=0),i?c=Math.min(i*n+t,e.length):c=e.length,h=t;h<c;h+=n)r[0]=e[h],r[1]=e[h+1],r[2]=e[h+2],a(r,r,s),e[h]=r[0],e[h+1]=r[1],e[h+2]=r[2];return e}}();T.forEach=ai;class si extends Rn{toString(){let e="[";if(X.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let t=0;t<this.RANK;++t)e+=" ".concat(this[t*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,t){return this[n*this.RANK+e]=An(t),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const t=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[t+i];return n}setColumn(e,n){const t=e*this.RANK;for(let i=0;i<this.RANK;++i)this[t+i]=n[i];return this}}var w={};function yr(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?yr=function(n){return typeof n}:yr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},yr(r)}Object.defineProperty(w,"__esModule",{value:!0}),w.create=ci,w.fromMat4=li,w.clone=fi,w.copy=oi,w.fromValues=vi,w.set=Mi,w.identity=pi,w.transpose=yi,w.invert=xi,w.adjoint=mi,w.determinant=di,w.multiply=pe,w.translate=gi,w.rotate=ui,w.scale=Ti,w.fromTranslation=_i,w.fromRotation=Ei,w.fromScaling=Ri,w.fromMat2d=Oi,w.fromQuat=Ai,w.normalFromMat4=Pi,w.projection=Li,w.str=wi,w.frob=$i,w.add=zi,w.subtract=ye,w.multiplyScalar=Si,w.multiplyScalarAndAdd=Ci,w.exactEquals=Ni,w.equals=Fi,w.sub=w.mul=void 0;var B=hi(W);function Me(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Me=function(i){return i?n:e})(r)}function hi(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||yr(r)!=="object"&&typeof r!="function")return{default:r};var n=Me(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function ci(){var r=new B.ARRAY_TYPE(9);return B.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function li(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r}function fi(r){var e=new B.ARRAY_TYPE(9);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e}function oi(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function vi(r,e,n,t,i,a,s,h,c){var l=new B.ARRAY_TYPE(9);return l[0]=r,l[1]=e,l[2]=n,l[3]=t,l[4]=i,l[5]=a,l[6]=s,l[7]=h,l[8]=c,l}function Mi(r,e,n,t,i,a,s,h,c,l){return r[0]=e,r[1]=n,r[2]=t,r[3]=i,r[4]=a,r[5]=s,r[6]=h,r[7]=c,r[8]=l,r}function pi(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function yi(r,e){if(r===e){var n=e[1],t=e[2],i=e[5];r[1]=e[3],r[2]=e[6],r[3]=n,r[5]=e[7],r[6]=t,r[7]=i}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function xi(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=e[4],h=e[5],c=e[6],l=e[7],f=e[8],v=f*s-h*l,o=-f*a+h*c,M=l*a-s*c,p=n*v+t*o+i*M;return p?(p=1/p,r[0]=v*p,r[1]=(-f*t+i*l)*p,r[2]=(h*t-i*s)*p,r[3]=o*p,r[4]=(f*n-i*c)*p,r[5]=(-h*n+i*a)*p,r[6]=M*p,r[7]=(-l*n+t*c)*p,r[8]=(s*n-t*a)*p,r):null}function mi(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=e[4],h=e[5],c=e[6],l=e[7],f=e[8];return r[0]=s*f-h*l,r[1]=i*l-t*f,r[2]=t*h-i*s,r[3]=h*c-a*f,r[4]=n*f-i*c,r[5]=i*a-n*h,r[6]=a*l-s*c,r[7]=t*c-n*l,r[8]=n*s-t*a,r}function di(r){var e=r[0],n=r[1],t=r[2],i=r[3],a=r[4],s=r[5],h=r[6],c=r[7],l=r[8];return e*(l*a-s*c)+n*(-l*i+s*h)+t*(c*i-a*h)}function pe(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=e[4],c=e[5],l=e[6],f=e[7],v=e[8],o=n[0],M=n[1],p=n[2],x=n[3],y=n[4],d=n[5],R=n[6],m=n[7],g=n[8];return r[0]=o*t+M*s+p*l,r[1]=o*i+M*h+p*f,r[2]=o*a+M*c+p*v,r[3]=x*t+y*s+d*l,r[4]=x*i+y*h+d*f,r[5]=x*a+y*c+d*v,r[6]=R*t+m*s+g*l,r[7]=R*i+m*h+g*f,r[8]=R*a+m*c+g*v,r}function gi(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=e[4],c=e[5],l=e[6],f=e[7],v=e[8],o=n[0],M=n[1];return r[0]=t,r[1]=i,r[2]=a,r[3]=s,r[4]=h,r[5]=c,r[6]=o*t+M*s+l,r[7]=o*i+M*h+f,r[8]=o*a+M*c+v,r}function ui(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=e[4],c=e[5],l=e[6],f=e[7],v=e[8],o=Math.sin(n),M=Math.cos(n);return r[0]=M*t+o*s,r[1]=M*i+o*h,r[2]=M*a+o*c,r[3]=M*s-o*t,r[4]=M*h-o*i,r[5]=M*c-o*a,r[6]=l,r[7]=f,r[8]=v,r}function Ti(r,e,n){var t=n[0],i=n[1];return r[0]=t*e[0],r[1]=t*e[1],r[2]=t*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function _i(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=e[0],r[7]=e[1],r[8]=1,r}function Ei(r,e){var n=Math.sin(e),t=Math.cos(e);return r[0]=t,r[1]=n,r[2]=0,r[3]=-n,r[4]=t,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function Ri(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=e[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function Oi(r,e){return r[0]=e[0],r[1]=e[1],r[2]=0,r[3]=e[2],r[4]=e[3],r[5]=0,r[6]=e[4],r[7]=e[5],r[8]=1,r}function Ai(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=n+n,h=t+t,c=i+i,l=n*s,f=t*s,v=t*h,o=i*s,M=i*h,p=i*c,x=a*s,y=a*h,d=a*c;return r[0]=1-v-p,r[3]=f-d,r[6]=o+y,r[1]=f+d,r[4]=1-l-p,r[7]=M-x,r[2]=o-y,r[5]=M+x,r[8]=1-l-v,r}function Pi(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=e[4],h=e[5],c=e[6],l=e[7],f=e[8],v=e[9],o=e[10],M=e[11],p=e[12],x=e[13],y=e[14],d=e[15],R=n*h-t*s,m=n*c-i*s,g=n*l-a*s,P=t*c-i*h,A=t*l-a*h,F=i*l-a*c,S=f*x-v*p,C=f*y-o*p,z=f*d-M*p,k=v*y-o*x,N=v*d-M*x,b=o*d-M*y,L=R*b-m*N+g*k+P*z-A*C+F*S;return L?(L=1/L,r[0]=(h*b-c*N+l*k)*L,r[1]=(c*z-s*b-l*C)*L,r[2]=(s*N-h*z+l*S)*L,r[3]=(i*N-t*b-a*k)*L,r[4]=(n*b-i*z+a*C)*L,r[5]=(t*z-n*N-a*S)*L,r[6]=(x*F-y*A+d*P)*L,r[7]=(y*g-p*F-d*m)*L,r[8]=(p*A-x*g+d*R)*L,r):null}function Li(r,e,n){return r[0]=2/e,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/n,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r}function wi(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"}function $i(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}function zi(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3]+n[3],r[4]=e[4]+n[4],r[5]=e[5]+n[5],r[6]=e[6]+n[6],r[7]=e[7]+n[7],r[8]=e[8]+n[8],r}function ye(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r[3]=e[3]-n[3],r[4]=e[4]-n[4],r[5]=e[5]-n[5],r[6]=e[6]-n[6],r[7]=e[7]-n[7],r[8]=e[8]-n[8],r}function Si(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*n,r}function Ci(r,e,n,t){return r[0]=e[0]+n[0]*t,r[1]=e[1]+n[1]*t,r[2]=e[2]+n[2]*t,r[3]=e[3]+n[3]*t,r[4]=e[4]+n[4]*t,r[5]=e[5]+n[5]*t,r[6]=e[6]+n[6]*t,r[7]=e[7]+n[7]*t,r[8]=e[8]+n[8]*t,r}function Ni(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]}function Fi(r,e){var n=r[0],t=r[1],i=r[2],a=r[3],s=r[4],h=r[5],c=r[6],l=r[7],f=r[8],v=e[0],o=e[1],M=e[2],p=e[3],x=e[4],y=e[5],d=e[6],R=e[7],m=e[8];return Math.abs(n-v)<=B.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(t-o)<=B.EPSILON*Math.max(1,Math.abs(t),Math.abs(o))&&Math.abs(i-M)<=B.EPSILON*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(a-p)<=B.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-x)<=B.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(h-y)<=B.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-d)<=B.EPSILON*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(l-R)<=B.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(f-m)<=B.EPSILON*Math.max(1,Math.abs(f),Math.abs(m))}var qi=pe;w.mul=qi;var Yi=ye;w.sub=Yi;var xe;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(xe||(xe={})),Object.freeze([1,0,0,0,1,0,0,0,1]);var _={};function xr(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?xr=function(n){return typeof n}:xr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},xr(r)}Object.defineProperty(_,"__esModule",{value:!0}),_.create=Qi,_.clone=Ji,_.copy=ji,_.fromValues=r1,_.set=e1,_.identity=ge;var ki=_.transpose=n1,bi=_.invert=t1;_.adjoint=i1;var Wi=_.determinant=a1,me=_.multiply=ue,Bi=_.translate=s1,Zi=_.scale=h1,Di=_.rotate=c1,Vi=_.rotateX=l1,Xi=_.rotateY=f1,Ui=_.rotateZ=o1;_.fromTranslation=v1,_.fromScaling=M1,_.fromRotation=p1,_.fromXRotation=y1,_.fromYRotation=x1,_.fromZRotation=m1,_.fromRotationTranslation=Te,_.fromQuat2=d1,_.getTranslation=g1,_.getScaling=_e,_.getRotation=u1,_.fromRotationTranslationScale=T1,_.fromRotationTranslationScaleOrigin=_1;var Ii=_.fromQuat=E1,Ki=_.frustum=R1;_.perspectiveNO=Ee,_.perspectiveZO=A1,_.perspectiveFromFieldOfView=P1,_.orthoNO=Oe,_.orthoZO=w1;var Gi=_.lookAt=$1;_.targetTo=z1,_.str=S1,_.frob=C1,_.add=N1,_.subtract=Pe,_.multiplyScalar=F1,_.multiplyScalarAndAdd=q1,_.exactEquals=Y1,_.equals=k1,_.sub=_.mul=Ae=_.ortho=Re=_.perspective=void 0;var $=Hi(W);function de(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(de=function(i){return i?n:e})(r)}function Hi(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||xr(r)!=="object"&&typeof r!="function")return{default:r};var n=de(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function Qi(){var r=new $.ARRAY_TYPE(16);return $.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Ji(r){var e=new $.ARRAY_TYPE(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function ji(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function r1(r,e,n,t,i,a,s,h,c,l,f,v,o,M,p,x){var y=new $.ARRAY_TYPE(16);return y[0]=r,y[1]=e,y[2]=n,y[3]=t,y[4]=i,y[5]=a,y[6]=s,y[7]=h,y[8]=c,y[9]=l,y[10]=f,y[11]=v,y[12]=o,y[13]=M,y[14]=p,y[15]=x,y}function e1(r,e,n,t,i,a,s,h,c,l,f,v,o,M,p,x,y){return r[0]=e,r[1]=n,r[2]=t,r[3]=i,r[4]=a,r[5]=s,r[6]=h,r[7]=c,r[8]=l,r[9]=f,r[10]=v,r[11]=o,r[12]=M,r[13]=p,r[14]=x,r[15]=y,r}function ge(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function n1(r,e){if(r===e){var n=e[1],t=e[2],i=e[3],a=e[6],s=e[7],h=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=n,r[6]=e[9],r[7]=e[13],r[8]=t,r[9]=a,r[11]=e[14],r[12]=i,r[13]=s,r[14]=h}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function t1(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=e[4],h=e[5],c=e[6],l=e[7],f=e[8],v=e[9],o=e[10],M=e[11],p=e[12],x=e[13],y=e[14],d=e[15],R=n*h-t*s,m=n*c-i*s,g=n*l-a*s,P=t*c-i*h,A=t*l-a*h,F=i*l-a*c,S=f*x-v*p,C=f*y-o*p,z=f*d-M*p,k=v*y-o*x,N=v*d-M*x,b=o*d-M*y,L=R*b-m*N+g*k+P*z-A*C+F*S;return L?(L=1/L,r[0]=(h*b-c*N+l*k)*L,r[1]=(i*N-t*b-a*k)*L,r[2]=(x*F-y*A+d*P)*L,r[3]=(o*A-v*F-M*P)*L,r[4]=(c*z-s*b-l*C)*L,r[5]=(n*b-i*z+a*C)*L,r[6]=(y*g-p*F-d*m)*L,r[7]=(f*F-o*g+M*m)*L,r[8]=(s*N-h*z+l*S)*L,r[9]=(t*z-n*N-a*S)*L,r[10]=(p*A-x*g+d*R)*L,r[11]=(v*g-f*A-M*R)*L,r[12]=(h*C-s*k-c*S)*L,r[13]=(n*k-t*C+i*S)*L,r[14]=(x*m-p*P-y*R)*L,r[15]=(f*P-v*m+o*R)*L,r):null}function i1(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=e[4],h=e[5],c=e[6],l=e[7],f=e[8],v=e[9],o=e[10],M=e[11],p=e[12],x=e[13],y=e[14],d=e[15];return r[0]=h*(o*d-M*y)-v*(c*d-l*y)+x*(c*M-l*o),r[1]=-(t*(o*d-M*y)-v*(i*d-a*y)+x*(i*M-a*o)),r[2]=t*(c*d-l*y)-h*(i*d-a*y)+x*(i*l-a*c),r[3]=-(t*(c*M-l*o)-h*(i*M-a*o)+v*(i*l-a*c)),r[4]=-(s*(o*d-M*y)-f*(c*d-l*y)+p*(c*M-l*o)),r[5]=n*(o*d-M*y)-f*(i*d-a*y)+p*(i*M-a*o),r[6]=-(n*(c*d-l*y)-s*(i*d-a*y)+p*(i*l-a*c)),r[7]=n*(c*M-l*o)-s*(i*M-a*o)+f*(i*l-a*c),r[8]=s*(v*d-M*x)-f*(h*d-l*x)+p*(h*M-l*v),r[9]=-(n*(v*d-M*x)-f*(t*d-a*x)+p*(t*M-a*v)),r[10]=n*(h*d-l*x)-s*(t*d-a*x)+p*(t*l-a*h),r[11]=-(n*(h*M-l*v)-s*(t*M-a*v)+f*(t*l-a*h)),r[12]=-(s*(v*y-o*x)-f*(h*y-c*x)+p*(h*o-c*v)),r[13]=n*(v*y-o*x)-f*(t*y-i*x)+p*(t*o-i*v),r[14]=-(n*(h*y-c*x)-s*(t*y-i*x)+p*(t*c-i*h)),r[15]=n*(h*o-c*v)-s*(t*o-i*v)+f*(t*c-i*h),r}function a1(r){var e=r[0],n=r[1],t=r[2],i=r[3],a=r[4],s=r[5],h=r[6],c=r[7],l=r[8],f=r[9],v=r[10],o=r[11],M=r[12],p=r[13],x=r[14],y=r[15],d=e*s-n*a,R=e*h-t*a,m=e*c-i*a,g=n*h-t*s,P=n*c-i*s,A=t*c-i*h,F=l*p-f*M,S=l*x-v*M,C=l*y-o*M,z=f*x-v*p,k=f*y-o*p,N=v*y-o*x;return d*N-R*k+m*z+g*C-P*S+A*F}function ue(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=e[4],c=e[5],l=e[6],f=e[7],v=e[8],o=e[9],M=e[10],p=e[11],x=e[12],y=e[13],d=e[14],R=e[15],m=n[0],g=n[1],P=n[2],A=n[3];return r[0]=m*t+g*h+P*v+A*x,r[1]=m*i+g*c+P*o+A*y,r[2]=m*a+g*l+P*M+A*d,r[3]=m*s+g*f+P*p+A*R,m=n[4],g=n[5],P=n[6],A=n[7],r[4]=m*t+g*h+P*v+A*x,r[5]=m*i+g*c+P*o+A*y,r[6]=m*a+g*l+P*M+A*d,r[7]=m*s+g*f+P*p+A*R,m=n[8],g=n[9],P=n[10],A=n[11],r[8]=m*t+g*h+P*v+A*x,r[9]=m*i+g*c+P*o+A*y,r[10]=m*a+g*l+P*M+A*d,r[11]=m*s+g*f+P*p+A*R,m=n[12],g=n[13],P=n[14],A=n[15],r[12]=m*t+g*h+P*v+A*x,r[13]=m*i+g*c+P*o+A*y,r[14]=m*a+g*l+P*M+A*d,r[15]=m*s+g*f+P*p+A*R,r}function s1(r,e,n){var t=n[0],i=n[1],a=n[2],s,h,c,l,f,v,o,M,p,x,y,d;return e===r?(r[12]=e[0]*t+e[4]*i+e[8]*a+e[12],r[13]=e[1]*t+e[5]*i+e[9]*a+e[13],r[14]=e[2]*t+e[6]*i+e[10]*a+e[14],r[15]=e[3]*t+e[7]*i+e[11]*a+e[15]):(s=e[0],h=e[1],c=e[2],l=e[3],f=e[4],v=e[5],o=e[6],M=e[7],p=e[8],x=e[9],y=e[10],d=e[11],r[0]=s,r[1]=h,r[2]=c,r[3]=l,r[4]=f,r[5]=v,r[6]=o,r[7]=M,r[8]=p,r[9]=x,r[10]=y,r[11]=d,r[12]=s*t+f*i+p*a+e[12],r[13]=h*t+v*i+x*a+e[13],r[14]=c*t+o*i+y*a+e[14],r[15]=l*t+M*i+d*a+e[15]),r}function h1(r,e,n){var t=n[0],i=n[1],a=n[2];return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*a,r[9]=e[9]*a,r[10]=e[10]*a,r[11]=e[11]*a,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function c1(r,e,n,t){var i=t[0],a=t[1],s=t[2],h=Math.hypot(i,a,s),c,l,f,v,o,M,p,x,y,d,R,m,g,P,A,F,S,C,z,k,N,b,L,U;return h<$.EPSILON?null:(h=1/h,i*=h,a*=h,s*=h,c=Math.sin(n),l=Math.cos(n),f=1-l,v=e[0],o=e[1],M=e[2],p=e[3],x=e[4],y=e[5],d=e[6],R=e[7],m=e[8],g=e[9],P=e[10],A=e[11],F=i*i*f+l,S=a*i*f+s*c,C=s*i*f-a*c,z=i*a*f-s*c,k=a*a*f+l,N=s*a*f+i*c,b=i*s*f+a*c,L=a*s*f-i*c,U=s*s*f+l,r[0]=v*F+x*S+m*C,r[1]=o*F+y*S+g*C,r[2]=M*F+d*S+P*C,r[3]=p*F+R*S+A*C,r[4]=v*z+x*k+m*N,r[5]=o*z+y*k+g*N,r[6]=M*z+d*k+P*N,r[7]=p*z+R*k+A*N,r[8]=v*b+x*L+m*U,r[9]=o*b+y*L+g*U,r[10]=M*b+d*L+P*U,r[11]=p*b+R*L+A*U,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function l1(r,e,n){var t=Math.sin(n),i=Math.cos(n),a=e[4],s=e[5],h=e[6],c=e[7],l=e[8],f=e[9],v=e[10],o=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=a*i+l*t,r[5]=s*i+f*t,r[6]=h*i+v*t,r[7]=c*i+o*t,r[8]=l*i-a*t,r[9]=f*i-s*t,r[10]=v*i-h*t,r[11]=o*i-c*t,r}function f1(r,e,n){var t=Math.sin(n),i=Math.cos(n),a=e[0],s=e[1],h=e[2],c=e[3],l=e[8],f=e[9],v=e[10],o=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=a*i-l*t,r[1]=s*i-f*t,r[2]=h*i-v*t,r[3]=c*i-o*t,r[8]=a*t+l*i,r[9]=s*t+f*i,r[10]=h*t+v*i,r[11]=c*t+o*i,r}function o1(r,e,n){var t=Math.sin(n),i=Math.cos(n),a=e[0],s=e[1],h=e[2],c=e[3],l=e[4],f=e[5],v=e[6],o=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=a*i+l*t,r[1]=s*i+f*t,r[2]=h*i+v*t,r[3]=c*i+o*t,r[4]=l*i-a*t,r[5]=f*i-s*t,r[6]=v*i-h*t,r[7]=o*i-c*t,r}function v1(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function M1(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function p1(r,e,n){var t=n[0],i=n[1],a=n[2],s=Math.hypot(t,i,a),h,c,l;return s<$.EPSILON?null:(s=1/s,t*=s,i*=s,a*=s,h=Math.sin(e),c=Math.cos(e),l=1-c,r[0]=t*t*l+c,r[1]=i*t*l+a*h,r[2]=a*t*l-i*h,r[3]=0,r[4]=t*i*l-a*h,r[5]=i*i*l+c,r[6]=a*i*l+t*h,r[7]=0,r[8]=t*a*l+i*h,r[9]=i*a*l-t*h,r[10]=a*a*l+c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function y1(r,e){var n=Math.sin(e),t=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t,r[6]=n,r[7]=0,r[8]=0,r[9]=-n,r[10]=t,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function x1(r,e){var n=Math.sin(e),t=Math.cos(e);return r[0]=t,r[1]=0,r[2]=-n,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=n,r[9]=0,r[10]=t,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function m1(r,e){var n=Math.sin(e),t=Math.cos(e);return r[0]=t,r[1]=n,r[2]=0,r[3]=0,r[4]=-n,r[5]=t,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Te(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=t+t,c=i+i,l=a+a,f=t*h,v=t*c,o=t*l,M=i*c,p=i*l,x=a*l,y=s*h,d=s*c,R=s*l;return r[0]=1-(M+x),r[1]=v+R,r[2]=o-d,r[3]=0,r[4]=v-R,r[5]=1-(f+x),r[6]=p+y,r[7]=0,r[8]=o+d,r[9]=p-y,r[10]=1-(f+M),r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function d1(r,e){var n=new $.ARRAY_TYPE(3),t=-e[0],i=-e[1],a=-e[2],s=e[3],h=e[4],c=e[5],l=e[6],f=e[7],v=t*t+i*i+a*a+s*s;return v>0?(n[0]=(h*s+f*t+c*a-l*i)*2/v,n[1]=(c*s+f*i+l*t-h*a)*2/v,n[2]=(l*s+f*a+h*i-c*t)*2/v):(n[0]=(h*s+f*t+c*a-l*i)*2,n[1]=(c*s+f*i+l*t-h*a)*2,n[2]=(l*s+f*a+h*i-c*t)*2),Te(r,e,n),r}function g1(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function _e(r,e){var n=e[0],t=e[1],i=e[2],a=e[4],s=e[5],h=e[6],c=e[8],l=e[9],f=e[10];return r[0]=Math.hypot(n,t,i),r[1]=Math.hypot(a,s,h),r[2]=Math.hypot(c,l,f),r}function u1(r,e){var n=new $.ARRAY_TYPE(3);_e(n,e);var t=1/n[0],i=1/n[1],a=1/n[2],s=e[0]*t,h=e[1]*i,c=e[2]*a,l=e[4]*t,f=e[5]*i,v=e[6]*a,o=e[8]*t,M=e[9]*i,p=e[10]*a,x=s+f+p,y=0;return x>0?(y=Math.sqrt(x+1)*2,r[3]=.25*y,r[0]=(v-M)/y,r[1]=(o-c)/y,r[2]=(h-l)/y):s>f&&s>p?(y=Math.sqrt(1+s-f-p)*2,r[3]=(v-M)/y,r[0]=.25*y,r[1]=(h+l)/y,r[2]=(o+c)/y):f>p?(y=Math.sqrt(1+f-s-p)*2,r[3]=(o-c)/y,r[0]=(h+l)/y,r[1]=.25*y,r[2]=(v+M)/y):(y=Math.sqrt(1+p-s-f)*2,r[3]=(h-l)/y,r[0]=(o+c)/y,r[1]=(v+M)/y,r[2]=.25*y),r}function T1(r,e,n,t){var i=e[0],a=e[1],s=e[2],h=e[3],c=i+i,l=a+a,f=s+s,v=i*c,o=i*l,M=i*f,p=a*l,x=a*f,y=s*f,d=h*c,R=h*l,m=h*f,g=t[0],P=t[1],A=t[2];return r[0]=(1-(p+y))*g,r[1]=(o+m)*g,r[2]=(M-R)*g,r[3]=0,r[4]=(o-m)*P,r[5]=(1-(v+y))*P,r[6]=(x+d)*P,r[7]=0,r[8]=(M+R)*A,r[9]=(x-d)*A,r[10]=(1-(v+p))*A,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function _1(r,e,n,t,i){var a=e[0],s=e[1],h=e[2],c=e[3],l=a+a,f=s+s,v=h+h,o=a*l,M=a*f,p=a*v,x=s*f,y=s*v,d=h*v,R=c*l,m=c*f,g=c*v,P=t[0],A=t[1],F=t[2],S=i[0],C=i[1],z=i[2],k=(1-(x+d))*P,N=(M+g)*P,b=(p-m)*P,L=(M-g)*A,U=(1-(o+d))*A,hr=(y+R)*A,cr=(p+m)*F,tn=(y-R)*F,an=(1-(o+x))*F;return r[0]=k,r[1]=N,r[2]=b,r[3]=0,r[4]=L,r[5]=U,r[6]=hr,r[7]=0,r[8]=cr,r[9]=tn,r[10]=an,r[11]=0,r[12]=n[0]+S-(k*S+L*C+cr*z),r[13]=n[1]+C-(N*S+U*C+tn*z),r[14]=n[2]+z-(b*S+hr*C+an*z),r[15]=1,r}function E1(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=n+n,h=t+t,c=i+i,l=n*s,f=t*s,v=t*h,o=i*s,M=i*h,p=i*c,x=a*s,y=a*h,d=a*c;return r[0]=1-v-p,r[1]=f+d,r[2]=o-y,r[3]=0,r[4]=f-d,r[5]=1-l-p,r[6]=M+x,r[7]=0,r[8]=o+y,r[9]=M-x,r[10]=1-l-v,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function R1(r,e,n,t,i,a,s){var h=1/(n-e),c=1/(i-t),l=1/(a-s);return r[0]=a*2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a*2*c,r[6]=0,r[7]=0,r[8]=(n+e)*h,r[9]=(i+t)*c,r[10]=(s+a)*l,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*a*2*l,r[15]=0,r}function Ee(r,e,n,t,i){var a=1/Math.tan(e/2),s;return r[0]=a/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(s=1/(t-i),r[10]=(i+t)*s,r[14]=2*i*t*s):(r[10]=-1,r[14]=-2*t),r}var O1=Ee,Re=_.perspective=O1;function A1(r,e,n,t,i){var a=1/Math.tan(e/2),s;return r[0]=a/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(s=1/(t-i),r[10]=i*s,r[14]=i*t*s):(r[10]=-1,r[14]=-t),r}function P1(r,e,n,t){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),h=Math.tan(e.rightDegrees*Math.PI/180),c=2/(s+h),l=2/(i+a);return r[0]=c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=l,r[6]=0,r[7]=0,r[8]=-((s-h)*c*.5),r[9]=(i-a)*l*.5,r[10]=t/(n-t),r[11]=-1,r[12]=0,r[13]=0,r[14]=t*n/(n-t),r[15]=0,r}function Oe(r,e,n,t,i,a,s){var h=1/(e-n),c=1/(t-i),l=1/(a-s);return r[0]=-2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*c,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*l,r[11]=0,r[12]=(e+n)*h,r[13]=(i+t)*c,r[14]=(s+a)*l,r[15]=1,r}var L1=Oe,Ae=_.ortho=L1;function w1(r,e,n,t,i,a,s){var h=1/(e-n),c=1/(t-i),l=1/(a-s);return r[0]=-2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*c,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=l,r[11]=0,r[12]=(e+n)*h,r[13]=(i+t)*c,r[14]=a*l,r[15]=1,r}function $1(r,e,n,t){var i,a,s,h,c,l,f,v,o,M,p=e[0],x=e[1],y=e[2],d=t[0],R=t[1],m=t[2],g=n[0],P=n[1],A=n[2];return Math.abs(p-g)<$.EPSILON&&Math.abs(x-P)<$.EPSILON&&Math.abs(y-A)<$.EPSILON?ge(r):(f=p-g,v=x-P,o=y-A,M=1/Math.hypot(f,v,o),f*=M,v*=M,o*=M,i=R*o-m*v,a=m*f-d*o,s=d*v-R*f,M=Math.hypot(i,a,s),M?(M=1/M,i*=M,a*=M,s*=M):(i=0,a=0,s=0),h=v*s-o*a,c=o*i-f*s,l=f*a-v*i,M=Math.hypot(h,c,l),M?(M=1/M,h*=M,c*=M,l*=M):(h=0,c=0,l=0),r[0]=i,r[1]=h,r[2]=f,r[3]=0,r[4]=a,r[5]=c,r[6]=v,r[7]=0,r[8]=s,r[9]=l,r[10]=o,r[11]=0,r[12]=-(i*p+a*x+s*y),r[13]=-(h*p+c*x+l*y),r[14]=-(f*p+v*x+o*y),r[15]=1,r)}function z1(r,e,n,t){var i=e[0],a=e[1],s=e[2],h=t[0],c=t[1],l=t[2],f=i-n[0],v=a-n[1],o=s-n[2],M=f*f+v*v+o*o;M>0&&(M=1/Math.sqrt(M),f*=M,v*=M,o*=M);var p=c*o-l*v,x=l*f-h*o,y=h*v-c*f;return M=p*p+x*x+y*y,M>0&&(M=1/Math.sqrt(M),p*=M,x*=M,y*=M),r[0]=p,r[1]=x,r[2]=y,r[3]=0,r[4]=v*y-o*x,r[5]=o*p-f*y,r[6]=f*x-v*p,r[7]=0,r[8]=f,r[9]=v,r[10]=o,r[11]=0,r[12]=i,r[13]=a,r[14]=s,r[15]=1,r}function S1(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function C1(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function N1(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3]+n[3],r[4]=e[4]+n[4],r[5]=e[5]+n[5],r[6]=e[6]+n[6],r[7]=e[7]+n[7],r[8]=e[8]+n[8],r[9]=e[9]+n[9],r[10]=e[10]+n[10],r[11]=e[11]+n[11],r[12]=e[12]+n[12],r[13]=e[13]+n[13],r[14]=e[14]+n[14],r[15]=e[15]+n[15],r}function Pe(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r[3]=e[3]-n[3],r[4]=e[4]-n[4],r[5]=e[5]-n[5],r[6]=e[6]-n[6],r[7]=e[7]-n[7],r[8]=e[8]-n[8],r[9]=e[9]-n[9],r[10]=e[10]-n[10],r[11]=e[11]-n[11],r[12]=e[12]-n[12],r[13]=e[13]-n[13],r[14]=e[14]-n[14],r[15]=e[15]-n[15],r}function F1(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*n,r[9]=e[9]*n,r[10]=e[10]*n,r[11]=e[11]*n,r[12]=e[12]*n,r[13]=e[13]*n,r[14]=e[14]*n,r[15]=e[15]*n,r}function q1(r,e,n,t){return r[0]=e[0]+n[0]*t,r[1]=e[1]+n[1]*t,r[2]=e[2]+n[2]*t,r[3]=e[3]+n[3]*t,r[4]=e[4]+n[4]*t,r[5]=e[5]+n[5]*t,r[6]=e[6]+n[6]*t,r[7]=e[7]+n[7]*t,r[8]=e[8]+n[8]*t,r[9]=e[9]+n[9]*t,r[10]=e[10]+n[10]*t,r[11]=e[11]+n[11]*t,r[12]=e[12]+n[12]*t,r[13]=e[13]+n[13]*t,r[14]=e[14]+n[14]*t,r[15]=e[15]+n[15]*t,r}function Y1(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}function k1(r,e){var n=r[0],t=r[1],i=r[2],a=r[3],s=r[4],h=r[5],c=r[6],l=r[7],f=r[8],v=r[9],o=r[10],M=r[11],p=r[12],x=r[13],y=r[14],d=r[15],R=e[0],m=e[1],g=e[2],P=e[3],A=e[4],F=e[5],S=e[6],C=e[7],z=e[8],k=e[9],N=e[10],b=e[11],L=e[12],U=e[13],hr=e[14],cr=e[15];return Math.abs(n-R)<=$.EPSILON*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(t-m)<=$.EPSILON*Math.max(1,Math.abs(t),Math.abs(m))&&Math.abs(i-g)<=$.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(a-P)<=$.EPSILON*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(s-A)<=$.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(h-F)<=$.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(c-S)<=$.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(l-C)<=$.EPSILON*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(f-z)<=$.EPSILON*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(v-k)<=$.EPSILON*Math.max(1,Math.abs(v),Math.abs(k))&&Math.abs(o-N)<=$.EPSILON*Math.max(1,Math.abs(o),Math.abs(N))&&Math.abs(M-b)<=$.EPSILON*Math.max(1,Math.abs(M),Math.abs(b))&&Math.abs(p-L)<=$.EPSILON*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(x-U)<=$.EPSILON*Math.max(1,Math.abs(x),Math.abs(U))&&Math.abs(y-hr)<=$.EPSILON*Math.max(1,Math.abs(y),Math.abs(hr))&&Math.abs(d-cr)<=$.EPSILON*Math.max(1,Math.abs(d),Math.abs(cr))}var b1=ue;_.mul=b1;var W1=Pe;_.sub=W1;var O={};function mr(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?mr=function(n){return typeof n}:mr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},mr(r)}Object.defineProperty(O,"__esModule",{value:!0}),O.create=we,O.clone=D1,O.fromValues=V1,O.copy=X1,O.set=U1,O.add=I1,O.subtract=$e,O.multiply=ze,O.divide=Se,O.ceil=K1,O.floor=G1,O.min=H1,O.max=Q1,O.round=J1,O.scale=j1,O.scaleAndAdd=ra,O.distance=Ce,O.squaredDistance=Ne,O.length=Fe,O.squaredLength=qe,O.negate=ea,O.inverse=na,O.normalize=ta,O.dot=ia,O.cross=sa,O.lerp=ha,O.random=ca;var B1=O.transformMat4=la;O.transformQuat=fa,O.zero=oa,O.str=va,O.exactEquals=Ma,O.equals=pa,O.forEach=O.sqrLen=O.len=O.sqrDist=O.dist=O.div=O.mul=O.sub=void 0;var D=Z1(W);function Le(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Le=function(i){return i?n:e})(r)}function Z1(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||mr(r)!=="object"&&typeof r!="function")return{default:r};var n=Le(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function we(){var r=new D.ARRAY_TYPE(4);return D.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function D1(r){var e=new D.ARRAY_TYPE(4);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function V1(r,e,n,t){var i=new D.ARRAY_TYPE(4);return i[0]=r,i[1]=e,i[2]=n,i[3]=t,i}function X1(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function U1(r,e,n,t,i){return r[0]=e,r[1]=n,r[2]=t,r[3]=i,r}function I1(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3]+n[3],r}function $e(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r[3]=e[3]-n[3],r}function ze(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r[3]=e[3]*n[3],r}function Se(r,e,n){return r[0]=e[0]/n[0],r[1]=e[1]/n[1],r[2]=e[2]/n[2],r[3]=e[3]/n[3],r}function K1(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r[3]=Math.ceil(e[3]),r}function G1(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r[3]=Math.floor(e[3]),r}function H1(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r[3]=Math.min(e[3],n[3]),r}function Q1(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r[3]=Math.max(e[3],n[3]),r}function J1(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r[3]=Math.round(e[3]),r}function j1(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r}function ra(r,e,n,t){return r[0]=e[0]+n[0]*t,r[1]=e[1]+n[1]*t,r[2]=e[2]+n[2]*t,r[3]=e[3]+n[3]*t,r}function Ce(r,e){var n=e[0]-r[0],t=e[1]-r[1],i=e[2]-r[2],a=e[3]-r[3];return Math.hypot(n,t,i,a)}function Ne(r,e){var n=e[0]-r[0],t=e[1]-r[1],i=e[2]-r[2],a=e[3]-r[3];return n*n+t*t+i*i+a*a}function Fe(r){var e=r[0],n=r[1],t=r[2],i=r[3];return Math.hypot(e,n,t,i)}function qe(r){var e=r[0],n=r[1],t=r[2],i=r[3];return e*e+n*n+t*t+i*i}function ea(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r}function na(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r[3]=1/e[3],r}function ta(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=n*n+t*t+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),r[0]=n*s,r[1]=t*s,r[2]=i*s,r[3]=a*s,r}function ia(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function sa(r,e,n,t){var i=n[0]*t[1]-n[1]*t[0],a=n[0]*t[2]-n[2]*t[0],s=n[0]*t[3]-n[3]*t[0],h=n[1]*t[2]-n[2]*t[1],c=n[1]*t[3]-n[3]*t[1],l=n[2]*t[3]-n[3]*t[2],f=e[0],v=e[1],o=e[2],M=e[3];return r[0]=v*l-o*c+M*h,r[1]=-(f*l)+o*s-M*a,r[2]=f*c-v*s+M*i,r[3]=-(f*h)+v*a-o*i,r}function ha(r,e,n,t){var i=e[0],a=e[1],s=e[2],h=e[3];return r[0]=i+t*(n[0]-i),r[1]=a+t*(n[1]-a),r[2]=s+t*(n[2]-s),r[3]=h+t*(n[3]-h),r}function ca(r,e){e=e||1;var n,t,i,a,s,h;do n=D.RANDOM()*2-1,t=D.RANDOM()*2-1,s=n*n+t*t;while(s>=1);do i=D.RANDOM()*2-1,a=D.RANDOM()*2-1,h=i*i+a*a;while(h>=1);var c=Math.sqrt((1-s)/h);return r[0]=e*n,r[1]=e*t,r[2]=e*i*c,r[3]=e*a*c,r}function la(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3];return r[0]=n[0]*t+n[4]*i+n[8]*a+n[12]*s,r[1]=n[1]*t+n[5]*i+n[9]*a+n[13]*s,r[2]=n[2]*t+n[6]*i+n[10]*a+n[14]*s,r[3]=n[3]*t+n[7]*i+n[11]*a+n[15]*s,r}function fa(r,e,n){var t=e[0],i=e[1],a=e[2],s=n[0],h=n[1],c=n[2],l=n[3],f=l*t+h*a-c*i,v=l*i+c*t-s*a,o=l*a+s*i-h*t,M=-s*t-h*i-c*a;return r[0]=f*l+M*-s+v*-c-o*-h,r[1]=v*l+M*-h+o*-s-f*-c,r[2]=o*l+M*-c+f*-h-v*-s,r[3]=e[3],r}function oa(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r}function va(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}function Ma(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]}function pa(r,e){var n=r[0],t=r[1],i=r[2],a=r[3],s=e[0],h=e[1],c=e[2],l=e[3];return Math.abs(n-s)<=D.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(t-h)<=D.EPSILON*Math.max(1,Math.abs(t),Math.abs(h))&&Math.abs(i-c)<=D.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-l)<=D.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))}var ya=$e;O.sub=ya;var xa=ze;O.mul=xa;var ma=Se;O.div=ma;var da=Ce;O.dist=da;var ga=Ne;O.sqrDist=ga;var ua=Fe;O.len=ua;var Ta=qe;O.sqrLen=Ta;var _a=function(){var r=we();return function(e,n,t,i,a,s){var h,c;for(n||(n=4),t||(t=0),i?c=Math.min(i*n+t,e.length):c=e.length,h=t;h<c;h+=n)r[0]=e[h],r[1]=e[h+1],r[2]=e[h+2],r[3]=e[h+3],a(r,r,s),e[h]=r[0],e[h+1]=r[1],e[h+2]=r[2],e[h+3]=r[3];return e}}();O.forEach=_a;var Cr;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(Cr||(Cr={}));const Ea=45*Math.PI/180,Ra=1,Nr=.1,Fr=500,Oa=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ar extends si{static get IDENTITY(){return Pa()}static get ZERO(){return Aa()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Cr}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,t,i,a,s,h,c,l,f,v,o,M,p,x,y){return this[0]=e,this[1]=n,this[2]=t,this[3]=i,this[4]=a,this[5]=s,this[6]=h,this[7]=c,this[8]=l,this[9]=f,this[10]=v,this[11]=o,this[12]=M,this[13]=p,this[14]=x,this[15]=y,this.check()}setRowMajor(e,n,t,i,a,s,h,c,l,f,v,o,M,p,x,y){return this[0]=e,this[1]=a,this[2]=l,this[3]=M,this[4]=n,this[5]=s,this[6]=f,this[7]=p,this[8]=t,this[9]=h,this[10]=v,this[11]=x,this[12]=i,this[13]=c,this[14]=o,this[15]=y,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Oa)}fromObject(e){return this.check()}fromQuaternion(e){return Ii(this,e),this.check()}frustum(e){const{left:n,right:t,bottom:i,top:a,near:s=Nr,far:h=Fr}=e;return h===1/0?La(this,n,t,i,a,s):Ki(this,n,t,i,a,s,h),this.check()}lookAt(e){const{eye:n,center:t=[0,0,0],up:i=[0,1,0]}=e;return Gi(this,n,t,i),this.check()}ortho(e){const{left:n,right:t,bottom:i,top:a,near:s=Nr,far:h=Fr}=e;return Ae(this,n,t,i,a,s,h),this.check()}orthographic(e){const{fovy:n=Ea,aspect:t=Ra,focalDistance:i=1,near:a=Nr,far:s=Fr}=e;Ye(n);const h=n/2,c=i*Math.tan(h),l=c*t;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:a,far:s})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:t=1,near:i=.1,far:a=500}=e;return Ye(n),Re(this,n,t,i,a),this.check()}determinant(){return Wi(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const t=this.getScale(n),i=1/t[0],a=1/t[1],s=1/t[2];return e[0]=this[0]*i,e[1]=this[1]*a,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*a,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*a,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const t=this.getScale(n),i=1/t[0],a=1/t[1],s=1/t[2];return e[0]=this[0]*i,e[1]=this[1]*a,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*a,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*a,e[8]=this[10]*s,e}transpose(){return ki(this,this),this.check()}invert(){return bi(this,this),this.check()}multiplyLeft(e){return me(this,e,this),this.check()}multiplyRight(e){return me(this,this,e),this.check()}rotateX(e){return Vi(this,this,e),this.check()}rotateY(e){return Xi(this,this,e),this.check()}rotateZ(e){return Ui(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return Di(this,this,e,n),this.check()}scale(e){return Zi(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Bi(this,this,e),this.check()}transform(e,n){return e.length===4?(n=B1(n||[-0,-0,-0,-0],e,this),Sr(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:t}=e;let i;switch(t){case 2:i=Sn(n||[-0,-0],e,this);break;case 3:i=gt(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Sr(i,e.length),i}transformAsVector(e,n){let t;switch(e.length){case 2:t=mt(n||[-0,-0],e,this);break;case 3:t=dt(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Sr(t,e.length),t}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,t){return this.identity().translate([e,n,t])}}let dr,gr;function Aa(){return dr||(dr=new ar([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(dr)),dr}function Pa(){return gr||(gr=new ar,Object.freeze(gr)),gr}function Ye(r){if(r>Math.PI*2)throw Error("expected radians")}function La(r,e,n,t,i,a){const s=2*a/(n-e),h=2*a/(i-t),c=(n+e)/(n-e),l=(i+t)/(i-t),f=-1,v=-1,o=-2*a;return r[0]=s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=c,r[9]=l,r[10]=f,r[11]=v,r[12]=0,r[13]=0,r[14]=o,r[15]=0,r}var u={};function ur(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ur=function(n){return typeof n}:ur=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ur(r)}Object.defineProperty(u,"__esModule",{value:!0}),u.create=qr,u.identity=$a,u.setAxisAngle=be,u.getAxisAngle=za,u.getAngle=Sa,u.multiply=We,u.rotateX=Ca,u.rotateY=Na,u.rotateZ=Fa,u.calculateW=qa,u.exp=Be,u.ln=Ze,u.pow=Ya,u.slerp=_r,u.random=ka,u.invert=ba,u.conjugate=Wa,u.fromMat3=De,u.fromEuler=Ba,u.str=Za,u.setAxes=u.sqlerp=u.rotationTo=u.equals=u.exactEquals=u.normalize=u.sqrLen=u.squaredLength=u.len=u.length=u.lerp=u.dot=u.scale=u.mul=u.add=u.set=u.copy=u.fromValues=u.clone=void 0;var rr=Tr(W),wa=Tr(w),K=Tr(T),Z=Tr(O);function ke(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ke=function(i){return i?n:e})(r)}function Tr(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||ur(r)!=="object"&&typeof r!="function")return{default:r};var n=ke(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function qr(){var r=new rr.ARRAY_TYPE(4);return rr.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function $a(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function be(r,e,n){n=n*.5;var t=Math.sin(n);return r[0]=t*e[0],r[1]=t*e[1],r[2]=t*e[2],r[3]=Math.cos(n),r}function za(r,e){var n=Math.acos(e[3])*2,t=Math.sin(n/2);return t>rr.EPSILON?(r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t):(r[0]=1,r[1]=0,r[2]=0),n}function Sa(r,e){var n=Xe(r,e);return Math.acos(2*n*n-1)}function We(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=n[0],c=n[1],l=n[2],f=n[3];return r[0]=t*f+s*h+i*l-a*c,r[1]=i*f+s*c+a*h-t*l,r[2]=a*f+s*l+t*c-i*h,r[3]=s*f-t*h-i*c-a*l,r}function Ca(r,e,n){n*=.5;var t=e[0],i=e[1],a=e[2],s=e[3],h=Math.sin(n),c=Math.cos(n);return r[0]=t*c+s*h,r[1]=i*c+a*h,r[2]=a*c-i*h,r[3]=s*c-t*h,r}function Na(r,e,n){n*=.5;var t=e[0],i=e[1],a=e[2],s=e[3],h=Math.sin(n),c=Math.cos(n);return r[0]=t*c-a*h,r[1]=i*c+s*h,r[2]=a*c+t*h,r[3]=s*c-i*h,r}function Fa(r,e,n){n*=.5;var t=e[0],i=e[1],a=e[2],s=e[3],h=Math.sin(n),c=Math.cos(n);return r[0]=t*c+i*h,r[1]=i*c-t*h,r[2]=a*c+s*h,r[3]=s*c-a*h,r}function qa(r,e){var n=e[0],t=e[1],i=e[2];return r[0]=n,r[1]=t,r[2]=i,r[3]=Math.sqrt(Math.abs(1-n*n-t*t-i*i)),r}function Be(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=Math.sqrt(n*n+t*t+i*i),h=Math.exp(a),c=s>0?h*Math.sin(s)/s:0;return r[0]=n*c,r[1]=t*c,r[2]=i*c,r[3]=h*Math.cos(s),r}function Ze(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=Math.sqrt(n*n+t*t+i*i),h=s>0?Math.atan2(s,a)/s:0;return r[0]=n*h,r[1]=t*h,r[2]=i*h,r[3]=.5*Math.log(n*n+t*t+i*i+a*a),r}function Ya(r,e,n){return Ze(r,e),Ve(r,r,n),Be(r,r),r}function _r(r,e,n,t){var i=e[0],a=e[1],s=e[2],h=e[3],c=n[0],l=n[1],f=n[2],v=n[3],o,M,p,x,y;return M=i*c+a*l+s*f+h*v,M<0&&(M=-M,c=-c,l=-l,f=-f,v=-v),1-M>rr.EPSILON?(o=Math.acos(M),p=Math.sin(o),x=Math.sin((1-t)*o)/p,y=Math.sin(t*o)/p):(x=1-t,y=t),r[0]=x*i+y*c,r[1]=x*a+y*l,r[2]=x*s+y*f,r[3]=x*h+y*v,r}function ka(r){var e=rr.RANDOM(),n=rr.RANDOM(),t=rr.RANDOM(),i=Math.sqrt(1-e),a=Math.sqrt(e);return r[0]=i*Math.sin(2*Math.PI*n),r[1]=i*Math.cos(2*Math.PI*n),r[2]=a*Math.sin(2*Math.PI*t),r[3]=a*Math.cos(2*Math.PI*t),r}function ba(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=n*n+t*t+i*i+a*a,h=s?1/s:0;return r[0]=-n*h,r[1]=-t*h,r[2]=-i*h,r[3]=a*h,r}function Wa(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function De(r,e){var n=e[0]+e[4]+e[8],t;if(n>0)t=Math.sqrt(n+1),r[3]=.5*t,t=.5/t,r[0]=(e[5]-e[7])*t,r[1]=(e[6]-e[2])*t,r[2]=(e[1]-e[3])*t;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var a=(i+1)%3,s=(i+2)%3;t=Math.sqrt(e[i*3+i]-e[a*3+a]-e[s*3+s]+1),r[i]=.5*t,t=.5/t,r[3]=(e[a*3+s]-e[s*3+a])*t,r[a]=(e[a*3+i]+e[i*3+a])*t,r[s]=(e[s*3+i]+e[i*3+s])*t}return r}function Ba(r,e,n,t){var i=.5*Math.PI/180;e*=i,n*=i,t*=i;var a=Math.sin(e),s=Math.cos(e),h=Math.sin(n),c=Math.cos(n),l=Math.sin(t),f=Math.cos(t);return r[0]=a*c*f-s*h*l,r[1]=s*h*f+a*c*l,r[2]=s*c*l-a*h*f,r[3]=s*c*f+a*h*l,r}function Za(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}var Da=Z.clone;u.clone=Da;var Va=Z.fromValues;u.fromValues=Va;var Xa=Z.copy;u.copy=Xa;var Ua=Z.set;u.set=Ua;var Ia=Z.add;u.add=Ia;var Ka=We;u.mul=Ka;var Ve=Z.scale;u.scale=Ve;var Xe=Z.dot;u.dot=Xe;var Ga=Z.lerp;u.lerp=Ga;var Ue=Z.length;u.length=Ue;var Ha=Ue;u.len=Ha;var Ie=Z.squaredLength;u.squaredLength=Ie;var Qa=Ie;u.sqrLen=Qa;var Yr=Z.normalize;u.normalize=Yr;var Ja=Z.exactEquals;u.exactEquals=Ja;var ja=Z.equals;u.equals=ja;var r0=function(){var r=K.create(),e=K.fromValues(1,0,0),n=K.fromValues(0,1,0);return function(t,i,a){var s=K.dot(i,a);return s<-.999999?(K.cross(r,e,i),K.len(r)<1e-6&&K.cross(r,n,i),K.normalize(r,r),be(t,r,Math.PI),t):s>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(K.cross(r,i,a),t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1+s,Yr(t,t))}}();u.rotationTo=r0;var e0=function(){var r=qr(),e=qr();return function(n,t,i,a,s,h){return _r(r,t,s,h),_r(e,i,a,h),_r(n,r,e,2*h*(1-h)),n}}();u.sqlerp=e0;var n0=function(){var r=wa.create();return function(e,n,t,i){return r[0]=t[0],r[3]=t[1],r[6]=t[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-n[0],r[5]=-n[1],r[8]=-n[2],Yr(e,De(e,r))}}();u.setAxes=n0;var Ke;(function(r){r[r.ZYX=0]="ZYX",r[r.YXZ=1]="YXZ",r[r.XZY=2]="XZY",r[r.ZXY=3]="ZXY",r[r.YZX=4]="YZX",r[r.XYZ=5]="XYZ"})(Ke||(Ke={}));const Y=3.141592653589793,Er=6378245,Rr=.006693421622965943,Or=Y*3e3/180;function sr(r,e,n){const t=Y/180*e,i=Math.pow(2,n),a=Math.floor((r+180)/360*i),s=Math.floor((1-Math.asinh(Math.tan(t))/Y)/2*i);return[a,s]}function Ge(r,e,n){const t=Math.pow(2,n),i=r/t*360-180,a=Math.atan(Math.sinh(Y*(1-2*e/t)))*180/Y;return[i,a]}function t0(r,e){let n=Je(r-105,e-35),t=je(r-105,e-35);const i=e/180*Y;let a=Math.sin(i);a=1-Rr*a*a;const s=Math.sqrt(a);n=n*180/(Er*(1-Rr)/(a*s)*Y),t=t*180/(Er/s*Math.cos(i)*Y);const h=e+n;return{lng:r+t,lat:h}}function He(r,e){const n=a0(r,e),t=r*2-n.lng,i=e*2-n.lat;return{lng:t,lat:i}}function Qe(r,e){const n=Math.sqrt(r*r+e*e)+2e-5*Math.sin(e*Or),t=Math.atan2(e,r)+3e-6*Math.cos(r*Or),i=n*Math.cos(t)+.0065,a=n*Math.sin(t)+.006;return{lng:i,lat:a}}function i0(r,e){const n=r-.0065,t=e-.006,i=Math.sqrt(n*n+t*t)-2e-5*Math.sin(t*Or),a=Math.atan2(t,n)-3e-6*Math.cos(n*Or),s=i*Math.cos(a),h=i*Math.sin(a);return{lng:s,lat:h}}function a0(r,e){let n=Je(r-105,e-35),t=je(r-105,e-35);const i=e/180*Y;let a=Math.sin(i);a=1-Rr*a*a;const s=Math.sqrt(a);n=n*180/(Er*(1-Rr)/(a*s)*Y),t=t*180/(Er/s*Math.cos(i)*Y);const h=e+n;return{lng:r+t,lat:h}}function Je(r,e){let n=-100+2*r+3*e+.2*e*e+.1*r*e+.2*Math.sqrt(Math.abs(r));return n+=(20*Math.sin(6*r*Y)+20*Math.sin(2*r*Y))*2/3,n+=(20*Math.sin(e*Y)+40*Math.sin(e/3*Y))*2/3,n+=(160*Math.sin(e/12*Y)+320*Math.sin(e*Y/30))*2/3,n}function je(r,e){let n=300+r+2*e+.1*r*r+.1*r*e+.1*Math.sqrt(Math.abs(r));return n+=(20*Math.sin(6*r*Y)+20*Math.sin(2*r*Y))*2/3,n+=(20*Math.sin(r*Y)+40*Math.sin(r/3*Y))*2/3,n+=(150*Math.sin(r/12*Y)+300*Math.sin(r/30*Y))*2/3,n}function rn(r,e){for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r}function s0(r,e){for(var n in e)r[n]=e[n]}function en(r){return typeof r=="string"}var nn=void 0,Ar=null;function V(r,e){isNaN(r)&&(r=Ib(r),r=isNaN(r)?0:r),en(r)&&(r=parseFloat(r)),isNaN(e)&&(e=Ib(e),e=isNaN(e)?0:e),en(e)&&(e=parseFloat(e)),this.lng=r,this.lat=e}V.TL=function(r){return r&&180>=r.lng&&-180<=r.lng&&74>=r.lat&&-74<=r.lat},V.prototype.lb=function(r){return r&&this.lat==r.lat&&this.lng==r.lng};function Pr(r,e){this.x=r||0,this.y=e||0,this.x=this.x,this.y=this.y}Pr.prototype.lb=function(r){return r&&r.x==this.x&&r.y==this.y};function kr(){}kr.prototype.nh=function(){aa("lngLatToPoint\u65B9\u6CD5\u672A\u5B9E\u73B0")},kr.prototype.wi=function(){aa("pointToLngLat\u65B9\u6CD5\u672A\u5B9E\u73B0")};function G(){}G.prototype=new kr,rn(G,{$O:637099681e-2,lG:[1289059486e-2,836237787e-2,5591021,348198983e-2,167804312e-2,0],Au:[75,60,45,30,15,0],fP:[[1410526172116255e-23,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,173379812e-1],[-7435856389565537e-24,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1026014486e-2],[-3030883460898826e-23,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,685681737e-2],[-1981981304930552e-23,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,448277706e-2],[309191371068437e-23,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,25551644e-1],[2890871144776878e-24,8983055095805407e-21,-3068298e-14,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],iG:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,6477955746671607e-7,-4082003173641316e-6,1077490566351142e-5,-1517187553151559e-5,1205306533862167e-5,-5124939663577472e-6,9133119359512032e-7,67.5],[.00337398766765,111320.7020202162,4481351045890365e-9,-2339375119931662e-8,7968221547186455e-8,-1159649932797253e-7,9723671115602145e-8,-4366194633752821e-8,8477230501135234e-9,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837749470245e-9,992013.7397791013,-122195221711287e-8,1340652697009075e-9,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758690035394e-9,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],Z1:function(i,e){if(!i||!e)return 0;var n,t,i=this.Fb(i);return i?(n=this.Tk(i.lng),t=this.Tk(i.lat),e=this.Fb(e),e?this.Pe(n,this.Tk(e.lng),t,this.Tk(e.lat)):0):0},Vo:function(r,e){return!r||!e?0:(r.lng=this.JD(r.lng,-180,180),r.lat=this.ND(r.lat,-74,74),e.lng=this.JD(e.lng,-180,180),e.lat=this.ND(e.lat,-74,74),this.Pe(this.Tk(r.lng),this.Tk(e.lng),this.Tk(r.lat),this.Tk(e.lat)))},Fb:function(r){if(r===Ar||r===nn)return new V(0,0);var e,n;e=new V(Math.abs(r.lng),Math.abs(r.lat));for(var t=0;t<this.lG.length;t++)if(e.lat>=this.lG[t]){n=this.fP[t];break}return r=this.gK(r,n),r=new V(r.lng.toFixed(6),r.lat.toFixed(6))},Eb:function(r){if(r===Ar||r===nn||180<r.lng||-180>r.lng||90<r.lat||-90>r.lat)return new V(0,0);var e,n;r.lng=this.JD(r.lng,-180,180),r.lat=this.ND(r.lat,-74,74),e=new V(r.lng,r.lat);for(var t=0;t<this.Au.length;t++)if(e.lat>=this.Au[t]){n=this.iG[t];break}if(!n){for(t=0;t<this.Au.length;t++)if(e.lat<=-this.Au[t]){n=this.iG[t];break}}return r=this.gK(r,n),r=new V(r.lng.toFixed(2),r.lat.toFixed(2))},gK:function(r,e){if(r&&e){var n=e[0]+e[1]*Math.abs(r.lng),t=Math.abs(r.lat)/e[9],t=e[2]+e[3]*t+e[4]*t*t+e[5]*t*t*t+e[6]*t*t*t*t+e[7]*t*t*t*t*t+e[8]*t*t*t*t*t*t,n=n*(0>r.lng?-1:1),t=t*(0>r.lat?-1:1);return new V(n,t)}},Pe:function(r,e,n,t){return this.$O*Math.acos(Math.sin(n)*Math.sin(t)+Math.cos(n)*Math.cos(t)*Math.cos(e-r))},Tk:function(r){return Math.PI*r/180},Z3:function(r){return 180*r/Math.PI},ND:function(r,e,n){return e!=Ar&&(r=Math.max(r,e)),n!=Ar&&(r=Math.min(r,n)),r},JD:function(r,e,n){for(;r>n;)r-=n-e;for(;r<e;)r+=n-e;return r}}),rn(G.prototype,{Jm:function(r){return G.Eb(r)},nh:function(r){return r=G.Eb(r),new Pr(r.lng,r.lat)},qh:function(r){return G.Fb(r)},wi:function(r){return r=new V(r.x,r.y),G.Fb(r)},fc:function(r,e,n,t,i){if(r)return r=this.Jm(r,i),e=this.Lc(e),new Pr(Math.round((r.lng-n.lng)/e+t.width/2),Math.round((n.lat-r.lat)/e+t.height/2))},zb:function(r,e,n,t,i){if(r)return e=this.Lc(e),this.qh(new V(n.lng+e*(r.x-t.width/2),n.lat-e*(r.y-t.height/2)),i)},Lc:function(r){return Math.pow(2,18-r)}});var br=G.prototype;s0(br,{lngLatToPoint:br.nh,pointToLngLat:br.wi});let Wr={Point:V,Pixel:Pr,MercatorProjection:G};class h0{constructor(e,n){this.projection=new Wr.MercatorProjection,this.levelMax=e,this.levelMin=n}_getRetain(e){return Math.pow(2,e-18)}getResolution(e,n){return Math.pow(2,18-n)*Math.cos(e)}lnglatToPoint(e,n){let t=new Wr.Point(e,n),i=this.projection.lngLatToPoint(t);return{pointX:i.x,pointY:i.y}}pointToLnglat(e,n){let t=new Wr.Pixel(e,n),i=this.projection.pointToLngLat(t);return{lng:i.lng,lat:i.lat}}_lngToTileX(e,n){let t=this.lnglatToPoint(e,0);return Math.floor(t.pointX*this._getRetain(n)/256)}_latToTileY(e,n){let t=this.lnglatToPoint(0,e);return Math.floor(t.pointY*this._getRetain(n)/256)}lnglatToTile(e,n,t){let i=this._lngToTileX(e,t),a=this._latToTileY(n,t);return[i,a]}_lngToPixelX(e,n){let t=this._lngToTileX(e,n),i=this.lnglatToPoint(e,0);return Math.floor(i.pointX*this._getRetain(n)-t*256)}_latToPixelY(e,n){let t=this._latToTileY(e,n),i=this.lnglatToPoint(0,e);return Math.floor(i.pointY*this._getRetain(n)-t*256)}lnglatToPixel(e,n,t){let i=this._lngToPixelX(e,t),a=this._latToPixelY(n,t);return{pixelX:i,pixelY:a}}_pixelXToLng(e,n,t){let i=(n*256+e)/this._getRetain(t);return this.pointToLnglat(i,0).lng}_pixelYToLat(e,n,t){let i=(n*256+e)/this._getRetain(t);return this.pointToLnglat(0,i).lat}pixelToLnglat(e,n,t,i,a){let s=(t*256+e)/this._getRetain(a),h=(i*256+n)/this._getRetain(a),c=this.pointToLnglat(s,h);return[c.lng,c.lat]}}Object.freeze=function(r){return r};var c0=/\{ *([\w_-]+) *\}/g;function l0(r,e){return r.replace(c0,function(n,t){let i=e[t];if(i===void 0)throw new Error(`No value provided for variable ${n}`);return typeof i=="function"&&(i=i(e)),i})}class f0{constructor(e,n){if(this.program=null,this.showTiles=[],this.isReadRender=!1,this.isLayerShow=!1,this.tileCache=[],this.gridCache={},this.transformBaidu=new h0,this.maskCache=[],this._projectionMatrix=new ar,this._viewMatrix4=new ar,this._mvpMatrix4=new ar,this.isOrtho=!1,!e)throw new Error("\u8BF7\u4F20\u5165\u5730\u56FE\u5B9E\u4F8B");this.validate(n),this.map=e,this.center=e.getCenter().toArray(),this.options=Object.assign(this.getDefaultGlLayerOptions(),n),this.customCoords=e.customCoords,this.customCoords.lngLatsToCoords([this.center]),this.layer=new AMap.GLCustomLayer({zooms:this.options.zooms,opacity:this.options.opacity,visible:this.options.visible,zIndex:this.options.zIndex,init:t=>{this.gl=t;const i=`
                    uniform mat4 u_ProjectionMatrix;
                    uniform mat4 u_ViewMatrix4;
                    uniform mat4 u_MvpMatrix4;
                    uniform bool u_isOrtho;
                    attribute vec2 a_pos;
                    attribute vec2 a_TextCoord;
                    varying vec2 v_TextCoord;
                    void main() {
                       if(u_isOrtho){
                         gl_Position = u_MvpMatrix4 * vec4(a_pos,0.0, 1.0);
                       }else{
                         gl_Position = u_ProjectionMatrix * u_ViewMatrix4 * vec4(a_pos,0.0, 1.0);
                       }
                       v_TextCoord = a_TextCoord;
                    }`,a=`
                    precision mediump float;
                    uniform sampler2D u_Sampler;
                    uniform bool u_isFirst;
                    varying vec2 v_TextCoord;
                    void main() {
                       if(u_isFirst){
                         gl_FragColor = vec4(1.0, 0.0, 0.0, 0.0);
                       }else{
                         gl_FragColor = texture2D(u_Sampler, v_TextCoord);
                       }
                    }`,s=t.createShader(t.VERTEX_SHADER);t.shaderSource(s,i),t.compileShader(s);const h=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(h,a),t.compileShader(h),this.program=t.createProgram(),t.attachShader(this.program,s),t.attachShader(this.program,h),t.linkProgram(this.program),this.a_Pos=t.getAttribLocation(this.program,"a_pos"),this.a_TextCoord=t.getAttribLocation(this.program,"a_TextCoord");const c="uniform mat4 u_ProjectionMatrix;uniform mat4 u_ViewMatrix4;uniform mat4 u_MvpMatrix4;uniform bool u_isOrtho;attribute vec2 a_pos;void main() {   if(u_isOrtho){     gl_Position = u_MvpMatrix4 * vec4(a_pos,0.0, 1.0);   }else{     gl_Position = u_ProjectionMatrix * u_ViewMatrix4 * vec4(a_pos,0.0, 1.0);   }}",l="void main() {    gl_FragColor = vec4(0.0, 1.0, 0.0, 0.0);}",f=t.createShader(t.VERTEX_SHADER);t.shaderSource(f,c),t.compileShader(f);const v=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(v,l),t.compileShader(v),this.maskProgram=t.createProgram(),t.attachShader(this.maskProgram,f),t.attachShader(this.maskProgram,v),t.linkProgram(this.maskProgram),this.mask_Pos=t.getAttribLocation(this.maskProgram,"a_pos"),this.options.visible&&(this.isLayerShow=!0),this.mapCallback=()=>{this.isLayerShow&&this.update()},e.on("dragging",this.mapCallback),e.on("moveend",this.mapCallback),e.on("zoomchange",this.mapCallback),e.on("rotatechange",this.mapCallback),this._createMask(this.options.mask),this.update()},render:t=>{if(!this.isReadRender)return;const i=this.options.zooms;if(!(this.map.getZoom()<i[0]||this.map.getZoom()>i[1])){if(this.customCoords.setCenter(this.center),e.getView().type==="3D"){this.isOrtho=!1;const{near:a,far:s,fov:h,up:c,lookAt:l,position:f}=this.customCoords.getCameraParams();this._viewMatrix4.lookAt({eye:f,center:l,up:c}).translate([0,0,this.options.altitude]),this._projectionMatrix.perspective({fovy:h*Math.PI/180,far:s,near:a,aspect:t.drawingBufferWidth/t.drawingBufferHeight})}else{this.isOrtho=!0;const a=this.customCoords.getMVPMatrix();this._mvpMatrix4.copy(a)}this.maskCache.length>0?(t.clearStencil(0),t.clear(t.STENCIL_BUFFER_BIT),t.enable(t.STENCIL_TEST),t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),this._renderMask(t),t.stencilFunc(t.EQUAL,1,255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.disable(t.DEPTH_TEST),this._renderTile(t),t.enable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST)):this._renderTile(t)}}}),e.add(this.layer)}_renderMask(e){if(this.maskCache.length){this.customCoords.setCenter(this.center),e.useProgram(this.maskProgram),this.setVertex(e,this.maskProgram);for(const n of this.maskCache)e.bindBuffer(e.ARRAY_BUFFER,n.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.indexBuffer),e.vertexAttribPointer(this.mask_Pos,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.mask_Pos),e.drawElements(e.TRIANGLES,n.deviationLength,e.UNSIGNED_INT,0)}}_renderTile(e){var n,t,i,a,s,h;this.customCoords.setCenter(this.center),e.useProgram(this.program),this.setVertex(e,this.program);let c=0;for(const l of this.showTiles){if(!l.isLoad||l.imageError)continue;e.bindTexture(e.TEXTURE_2D,l.texture),e.activeTexture(e.TEXTURE0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT);const f=e.getUniformLocation(this.program,"u_Sampler");e.uniform1i(f,0),e.uniform1f(e.getUniformLocation(this.program,"u_isFirst"),c===0),e.bindBuffer(e.ARRAY_BUFFER,l.buffer),e.vertexAttribPointer(this.a_Pos,(n=l.PosParam)===null||n===void 0?void 0:n.size,e.FLOAT,!1,(t=l.PosParam)===null||t===void 0?void 0:t.stride,(i=l.PosParam)===null||i===void 0?void 0:i.offset),e.vertexAttribPointer(this.a_TextCoord,(a=l.TextCoordParam)===null||a===void 0?void 0:a.size,e.FLOAT,!1,(s=l.TextCoordParam)===null||s===void 0?void 0:s.stride,(h=l.TextCoordParam)===null||h===void 0?void 0:h.offset),e.enableVertexAttribArray(this.a_Pos),e.enableVertexAttribArray(this.a_TextCoord),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,0,4),c++}}validate(e){if(!e.url)throw new Error("\u8BF7\u4F20\u5165url");if(e.url.includes("{s}")&&(!e.subdomains||e.subdomains.length===0))throw new Error("\u8BF7\u4F20\u5165subdomains")}getDefaultGlLayerOptions(){return{url:"",zooms:[2,18],opacity:1,visible:!0,zIndex:120,proj:"gcj02",tileType:"xyz",debug:!1,cacheSize:512,tileMaxZoom:18,altitude:0}}_createMask(e){if(!e||e.length===0){this.maskCache=[];return}const n=this.getMaskDeep(e);if(n<2||n>4){console.warn("mask\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E");return}n===2?e=[[e]]:n===3&&(e=[e]);for(let t of e){t=this._convertMaskLnglatToCoords(t);const i=H.exports.flatten(t),a=H.exports(i.vertices,i.holes,i.dimensions),s=this.gl,h=new Float32Array(i.vertices),c=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,c),s.bufferData(s.ARRAY_BUFFER,h,s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,null);const l=s.createBuffer();s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,l),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint32Array(a),s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),this.maskCache.push({FSIZE:h.BYTES_PER_ELEMENT,vertexBuffer:c,indexBuffer:l,deviationLength:a.length})}}getMaskDeep(e,n=1){return e.length?typeof e[0]=="number"?n:this.getMaskDeep(e[0],n+1):-1}_convertMaskLnglatToCoords(e){return!e||e.length===0?e:typeof e[0]=="number"?this._convertLnglatToCoords([e[0],e[1]]):e.map(n=>this._convertMaskLnglatToCoords(n))}_convertLnglatToCoords(e){return this.customCoords.setCenter(this.center),this.customCoords.lngLatsToCoords([e])[0]}update(){if(!this.gl)return;this.isReadRender=!1;const e=this.gl,n=this.map,t=n.getCenter();let i=Math.ceil(n.getZoom());i>this.options.tileMaxZoom&&(i=this.options.tileMaxZoom);const a=n.getBounds();let s,h,c,l;if(this.options.tileType==="xyz"?(c=a.getNorthWest().toArray(),l=a.getSouthEast().toArray()):(c=a.getSouthWest().toArray(),l=a.getNorthEast().toArray()),this.options.proj==="wgs84"){const o=He(...c),M=He(...l);s=sr(o.lng,o.lat,i),h=sr(M.lng,M.lat,i)}else if(this.options.proj==="bd09"){const o=Qe(...c),M=Qe(...l);s=this.transformBaidu.lnglatToTile(o.lng,o.lat,i),h=this.transformBaidu.lnglatToTile(M.lng,M.lat,i)}else s=sr(c[0],c[1],i),h=sr(l[0],l[1],i);const f=[];for(let o=s[0];o<=h[0];o++)for(let M=s[1];M<=h[1];M++){const p={x:o,y:M,z:i};f.push(p),this.addGridCache(p,0,0),o===h[0]&&this.addGridCache(p,1,0),M===h[1]&&this.addGridCache(p,0,1),o===h[0]&&M===h[1]&&this.addGridCache(p,1,1)}let v;this.options.tileType==="xyz"?v=sr(t.getLng(),t.getLat(),i):v=this.transformBaidu.lnglatToTile(t.getLng(),t.getLat(),i),f.sort((o,M)=>this.tileDistance(o,v)-this.tileDistance(M,v)),this._cancelOutViewImage(f),this._clearShowTile();for(const o of f){const M=this.createTileKey(o),p=this.getTileCache(M);if(p){if(p.imageError)continue;!p.isLoad&&p.image&&p.imageCanceled&&(p.image.src=p.url,p.imageCanceled=!1),this.showTiles.push(p)}else{const x=this.createTile(e,o);this.showTiles.push(x),this.pushTileCache(x)}}this.showTiles.length>0&&this.showTiles.unshift(this.showTiles[0]),this.isReadRender=!0}_cancelOutViewImage(e){this.tileCache.forEach(n=>{e.findIndex(t=>this.createTileKey(t)===n.xyzKey)===-1&&!n.isLoad&&n.image&&(n.image.src="",n.imageCanceled=!0)})}getTileCache(e){return this.tileCache.find(n=>n.xyzKey===e)}pushTileCache(e){const n=this.options.cacheSize;n>0&&this.tileCache.length>=n&&(this.showTiles.findIndex(t=>t.xyzKey===this.tileCache[0].xyzKey)<0&&this._destroyTile(this.tileCache[0]),this.tileCache.splice(0,1)),this.tileCache.push(e)}addGridCache(e,n,t){const i=this.createTileKey(e.x+n,e.y+t,e.z);if(!this.gridCache[i])if(this.options.proj==="wgs84"){const a=t0(...Ge(e.x+n,e.y+t,e.z)),s=this._convertLnglatToCoords([a.lng,a.lat]);this.gridCache[i]={lng:s[0],lat:s[1]}}else if(this.options.tileType==="bd09"){const a=i0(...this.transformBaidu.pixelToLnglat(0,0,e.x+n,e.y+t,e.z)),s=this._convertLnglatToCoords([a.lng,a.lat]);this.gridCache[i]={lng:s[0],lat:s[1]}}else{const a=this._convertLnglatToCoords(Ge(e.x+n,e.y+t,e.z));this.gridCache[i]={lng:a[0],lat:a[1]}}}tileDistance(e,n){return Math.sqrt(Math.pow(e.x-n[0],2)+Math.pow(e.y-n[1],2))}createTileKey(e,n,t){return e instanceof Object?`${e.z}/${e.x}/${e.y}`:`${t}/${e}/${n}`}deepFormatTileNumber(e,n){return e>=0&&e<n?e:(e>0&&e>=n?e=e-n:e<0&&(e=e+n),this.deepFormatTileNumber(e,n))}createTile(e,n){let t=Math.ceil(this.map.getZoom());t>this.options.tileMaxZoom&&(t=this.options.tileMaxZoom);const i=Math.pow(2,t);let a=n.x,s=n.y;a=this.deepFormatTileNumber(a,i),s=this.deepFormatTileNumber(s,i);const h={x:a,y:s,z:n.z};this.options.subdomains&&(h.s=this.options.subdomains[Math.abs(n.x+n.y)%this.options.subdomains.length]);const c=l0(this.options.url,h),l={xyz:n,xyzKey:this.createTileKey(n),isLoad:!1,url:c,imageCanceled:!1};let f,v,o,M;this.options.tileType==="xyz"?(f=this.gridCache[this.createTileKey(n)],v=this.gridCache[this.createTileKey(n.x+1,n.y,n.z)],o=this.gridCache[this.createTileKey(n.x,n.y+1,n.z)],M=this.gridCache[this.createTileKey(n.x+1,n.y+1,n.z)]):(f=this.gridCache[this.createTileKey(n.x,n.y+1,n.z)],v=this.gridCache[this.createTileKey(n.x+1,n.y+1,n.z)],o=this.gridCache[this.createTileKey(n)],M=this.gridCache[this.createTileKey(n.x+1,n.y,n.z)]);const p=new Float32Array([f.lng,f.lat,0,1,o.lng,o.lat,0,0,v.lng,v.lat,1,1,M.lng,M.lat,1,0]),x=p.BYTES_PER_ELEMENT,y=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,y),e.bufferData(e.ARRAY_BUFFER,p,e.STATIC_DRAW),l.buffer=y,l.PosParam={size:2,stride:x*4,offset:0},l.TextCoordParam={size:2,stride:x*4,offset:x*2};const d=new Image(256,256);return d.onload=()=>{if(l.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,l.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),this.options.debug){const R=document.createElement("canvas");R.width=256,R.height=256;const m=R.getContext("2d");m.drawImage(d,0,0),m.font="25px Verdana",m.fillStyle="#ff0000",m.strokeStyle="#FF0000",m.strokeRect(0,0,256,256),m.fillText(`(${[n.x,n.y,n.z].join(",")})`,10,30),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,R)}else e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,d);l.isLoad=!0,this.showTiles.findIndex(R=>R===l)>=0&&this.requestRender()},d.onerror=()=>{l.imageCanceled||(l.imageError=!0)},d.crossOrigin="anonymous",d.src=c,l.image=d,l}setVertex(e,n){e.uniformMatrix4fv(e.getUniformLocation(n,"u_ProjectionMatrix"),!1,this._projectionMatrix.toArray()),e.uniformMatrix4fv(e.getUniformLocation(n,"u_ViewMatrix4"),!1,this._viewMatrix4.toArray()),e.uniformMatrix4fv(e.getUniformLocation(n,"u_MvpMatrix4"),!1,this._mvpMatrix4.toArray()),e.uniform1f(e.getUniformLocation(n,"u_isOrtho"),this.isOrtho)}requestRender(){this.map&&(this.map.getContext().setDirty(),this.map.render())}show(){this.isLayerShow=!0,this.update(),this.layer.show()}hide(){this.isLayerShow=!1,this.layer.hide()}getzIndex(){return this.layer.getzIndex()}setzIndex(e){this.options.zIndex=e,this.layer.setzIndex(e)}getOpacity(){return this.layer.getOpacity()}setOpacity(e){this.options.opacity=e,this.layer.setOpacity(e)}getZooms(){return this.layer.getZooms()}setZooms(e){this.options.zooms=e,this.layer.setZooms(e)}setMask(e){this._destroyMaskCache(),this._createMask(e),this.options.mask=e,this.requestRender()}getMask(){return this.options.mask}getMap(){return this.map}_destroyMaskCache(){this.maskCache.forEach(e=>{this.gl.deleteBuffer(e.vertexBuffer),this.gl.deleteBuffer(e.indexBuffer)}),this.maskCache=[]}_destroyTile(e){e.buffer&&this.gl.deleteBuffer(e.buffer),e.texture&&this.gl.deleteTexture(e.texture)}_clearAllCacheTile(){this.tileCache.forEach(e=>{this._destroyTile(e)}),this.tileCache=[]}_clearShowTile(){this.showTiles.forEach(e=>{this.tileCache.findIndex(n=>n.xyzKey===e.xyzKey)<0&&this._destroyTile(e)}),this.showTiles=[]}destroy(){this.isLayerShow=!1,this.map.remove(this.layer),this.map.off("dragging",this.mapCallback),this.map.off("moveend",this.mapCallback),this.map.off("zoomchange",this.mapCallback),this.map.off("rotatechange",this.mapCallback),this._destroyMaskCache(),this._clearShowTile(),this._clearAllCacheTile(),this.gridCache={},this.transformBaidu=null,this.mapCallback=null,this.gl.deleteProgram(this.program),this.gl.deleteProgram(this.maskProgram),this.program=null,this.maskProgram=null,this.options=void 0,this.customCoords=void 0,this.center=void 0,this.layer=null,this.gl=null,this.map=null}}Q.CustomXyzLayer=f0,Object.defineProperty(Q,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
