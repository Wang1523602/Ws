var hr={exports:{}};hr.exports=cr,hr.exports.default=cr;function cr(r,e,n){n=n||2;var t=e&&e.length,i=t?e[0]*n:r.length,a=Zr(r,0,i,n,!0),s=[];if(!a||a.next===a.prev)return s;var h,c,l,f,o,v,M;if(t&&(a=ln(r,e,a,n)),r.length>80*n){h=l=r[0],c=f=r[1];for(var p=n;p<i;p+=n)o=r[p],v=r[p+1],o<h&&(h=o),v<c&&(c=v),o>l&&(l=o),v>f&&(f=v);M=Math.max(l-h,f-c),M=M!==0?32767/M:0}return nr(a,s,n,h,c,M,0),s}function Zr(r,e,n,t,i){var a,s;if(i===wr(r,e,n,t)>0)for(a=e;a<n;a+=t)s=Xr(a,r[a],r[a+1],s);else for(a=n-t;a>=e;a-=t)s=Xr(a,r[a],r[a+1],s);return s&&lr(s,s.next)&&(ir(s),s=s.next),s}function H(r,e){if(!r)return r;e||(e=r);var n=r,t;do if(t=!1,!n.steiner&&(lr(n,n.next)||k(n.prev,n,n.next)===0)){if(ir(n),n=e=n.prev,n===n.next)break;t=!0}else n=n.next;while(t||n!==e);return e}function nr(r,e,n,t,i,a,s){if(!!r){!s&&a&&pn(r,t,i,a);for(var h=r,c,l;r.prev!==r.next;){if(c=r.prev,l=r.next,a?sn(r,t,i,a):an(r)){e.push(c.i/n|0),e.push(r.i/n|0),e.push(l.i/n|0),ir(r),r=l.next,h=l.next;continue}if(r=l,r===h){s?s===1?(r=hn(H(r),e,n),nr(r,e,n,t,i,a,2)):s===2&&cn(r,e,n,t,i,a):nr(H(r),e,n,t,i,a,1);break}}}}function an(r){var e=r.prev,n=r,t=r.next;if(k(e,n,t)>=0)return!1;for(var i=e.x,a=n.x,s=t.x,h=e.y,c=n.y,l=t.y,f=i<a?i<s?i:s:a<s?a:s,o=h<c?h<l?h:l:c<l?c:l,v=i>a?i>s?i:s:a>s?a:s,M=h>c?h>l?h:l:c>l?c:l,p=t.next;p!==e;){if(p.x>=f&&p.x<=v&&p.y>=o&&p.y<=M&&j(i,h,a,c,s,l,p.x,p.y)&&k(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function sn(r,e,n,t){var i=r.prev,a=r,s=r.next;if(k(i,a,s)>=0)return!1;for(var h=i.x,c=a.x,l=s.x,f=i.y,o=a.y,v=s.y,M=h<c?h<l?h:l:c<l?c:l,p=f<o?f<v?f:v:o<v?o:v,x=h>c?h>l?h:l:c>l?c:l,y=f>o?f>v?f:v:o>v?o:v,g=Pr(M,p,e,n,t),R=Pr(x,y,e,n,t),m=r.prevZ,d=r.nextZ;m&&m.z>=g&&d&&d.z<=R;){if(m.x>=M&&m.x<=x&&m.y>=p&&m.y<=y&&m!==i&&m!==s&&j(h,f,c,o,l,v,m.x,m.y)&&k(m.prev,m,m.next)>=0||(m=m.prevZ,d.x>=M&&d.x<=x&&d.y>=p&&d.y<=y&&d!==i&&d!==s&&j(h,f,c,o,l,v,d.x,d.y)&&k(d.prev,d,d.next)>=0))return!1;d=d.nextZ}for(;m&&m.z>=g;){if(m.x>=M&&m.x<=x&&m.y>=p&&m.y<=y&&m!==i&&m!==s&&j(h,f,c,o,l,v,m.x,m.y)&&k(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;d&&d.z<=R;){if(d.x>=M&&d.x<=x&&d.y>=p&&d.y<=y&&d!==i&&d!==s&&j(h,f,c,o,l,v,d.x,d.y)&&k(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function hn(r,e,n){var t=r;do{var i=t.prev,a=t.next.next;!lr(i,a)&&Dr(i,t,t.next,a)&&tr(i,a)&&tr(a,i)&&(e.push(i.i/n|0),e.push(t.i/n|0),e.push(a.i/n|0),ir(t),ir(t.next),t=r=a),t=t.next}while(t!==r);return H(t)}function cn(r,e,n,t,i,a){var s=r;do{for(var h=s.next.next;h!==s.prev;){if(s.i!==h.i&&mn(s,h)){var c=Vr(s,h);s=H(s,s.next),c=H(c,c.next),nr(s,e,n,t,i,a,0),nr(c,e,n,t,i,a,0);return}h=h.next}s=s.next}while(s!==r)}function ln(r,e,n,t){var i=[],a,s,h,c,l;for(a=0,s=e.length;a<s;a++)h=e[a]*t,c=a<s-1?e[a+1]*t:r.length,l=Zr(r,h,c,t,!1),l===l.next&&(l.steiner=!0),i.push(xn(l));for(i.sort(fn),a=0;a<i.length;a++)n=vn(i[a],n);return n}function fn(r,e){return r.x-e.x}function vn(r,e){var n=on(r,e);if(!n)return e;var t=Vr(n,r);return H(t,t.next),H(n,n.next)}function on(r,e){var n=e,t=r.x,i=r.y,a=-1/0,s;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var h=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(h<=t&&h>a&&(a=h,s=n.x<n.next.x?n:n.next,h===t))return s}n=n.next}while(n!==e);if(!s)return null;var c=s,l=s.x,f=s.y,o=1/0,v;n=s;do t>=n.x&&n.x>=l&&t!==n.x&&j(i<f?t:a,i,l,f,i<f?a:t,i,n.x,n.y)&&(v=Math.abs(i-n.y)/(t-n.x),tr(n,r)&&(v<o||v===o&&(n.x>s.x||n.x===s.x&&Mn(s,n)))&&(s=n,o=v)),n=n.next;while(n!==c);return s}function Mn(r,e){return k(r.prev,r,e.prev)<0&&k(e.next,r,r.next)<0}function pn(r,e,n,t){var i=r;do i.z===0&&(i.z=Pr(i.x,i.y,e,n,t)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,yn(i)}function yn(r){var e,n,t,i,a,s,h,c,l=1;do{for(n=r,r=null,a=null,s=0;n;){for(s++,t=n,h=0,e=0;e<l&&(h++,t=t.nextZ,!!t);e++);for(c=l;h>0||c>0&&t;)h!==0&&(c===0||!t||n.z<=t.z)?(i=n,n=n.nextZ,h--):(i=t,t=t.nextZ,c--),a?a.nextZ=i:r=i,i.prevZ=a,a=i;n=t}a.nextZ=null,l*=2}while(s>1);return r}function Pr(r,e,n,t,i){return r=(r-n)*i|0,e=(e-t)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function xn(r){var e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function j(r,e,n,t,i,a,s,h){return(i-s)*(e-h)>=(r-s)*(a-h)&&(r-s)*(t-h)>=(n-s)*(e-h)&&(n-s)*(a-h)>=(i-s)*(t-h)}function mn(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!gn(r,e)&&(tr(r,e)&&tr(e,r)&&dn(r,e)&&(k(r.prev,r,e.prev)||k(r,e.prev,e))||lr(r,e)&&k(r.prev,r,r.next)>0&&k(e.prev,e,e.next)>0)}function k(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function lr(r,e){return r.x===e.x&&r.y===e.y}function Dr(r,e,n,t){var i=vr(k(r,e,n)),a=vr(k(r,e,t)),s=vr(k(n,t,r)),h=vr(k(n,t,e));return!!(i!==a&&s!==h||i===0&&fr(r,n,e)||a===0&&fr(r,t,e)||s===0&&fr(n,r,t)||h===0&&fr(n,e,t))}function fr(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function vr(r){return r>0?1:r<0?-1:0}function gn(r,e){var n=r;do{if(n.i!==r.i&&n.next.i!==r.i&&n.i!==e.i&&n.next.i!==e.i&&Dr(n,n.next,r,e))return!0;n=n.next}while(n!==r);return!1}function tr(r,e){return k(r.prev,r,r.next)<0?k(r,e,r.next)>=0&&k(r,r.prev,e)>=0:k(r,e,r.prev)<0||k(r,r.next,e)<0}function dn(r,e){var n=r,t=!1,i=(r.x+e.x)/2,a=(r.y+e.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(t=!t),n=n.next;while(n!==r);return t}function Vr(r,e){var n=new Lr(r.i,r.x,r.y),t=new Lr(e.i,e.x,e.y),i=r.next,a=e.prev;return r.next=e,e.prev=r,n.next=i,i.prev=n,t.next=n,n.prev=t,a.next=t,t.prev=a,t}function Xr(r,e,n,t){var i=new Lr(r,e,n);return t?(i.next=t.next,i.prev=t,t.next.prev=i,t.next=i):(i.prev=i,i.next=i),i}function ir(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Lr(r,e,n){this.i=r,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}cr.deviation=function(r,e,n,t){var i=e&&e.length,a=i?e[0]*n:r.length,s=Math.abs(wr(r,0,a,n));if(i)for(var h=0,c=e.length;h<c;h++){var l=e[h]*n,f=h<c-1?e[h+1]*n:r.length;s-=Math.abs(wr(r,l,f,n))}var o=0;for(h=0;h<t.length;h+=3){var v=t[h]*n,M=t[h+1]*n,p=t[h+2]*n;o+=Math.abs((r[v]-r[p])*(r[M+1]-r[v+1])-(r[v]-r[M])*(r[p+1]-r[v+1]))}return s===0&&o===0?0:Math.abs((o-s)/s)};function wr(r,e,n,t){for(var i=0,a=e,s=n-t;a<n;a+=t)i+=(r[s]-r[a])*(r[a+1]+r[s+1]),s=a;return i}cr.flatten=function(r){for(var e=r[0][0].length,n={vertices:[],holes:[],dimensions:e},t=0,i=0;i<r.length;i++){for(var a=0;a<r[i].length;a++)for(var s=0;s<e;s++)n.vertices.push(r[i][a][s]);i>0&&(t+=r[i-1].length,n.holes.push(t))}return n};const U={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function un(r,{precision:e=U.precision}={}){return r=Tn(r),"".concat(parseFloat(r.toPrecision(e)))}function $r(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Ur(r,e,n){const t=U.EPSILON;n&&(U.EPSILON=n);try{if(r===e)return!0;if($r(r)&&$r(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!Ur(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=U.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{U.EPSILON=t}}function Tn(r){return Math.round(r/U.EPSILON)*U.EPSILON}function _n(r){function e(){var n=Reflect.construct(r,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(r.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r,e}class En extends _n(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let t=0;t<this.ELEMENTS;++t)this[t]=e[t+n];return this.check()}toArray(e=[],n=0){for(let t=0;t<this.ELEMENTS;++t)e[n+t]=this[t];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:$r(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(U)}formatString(e){let n="";for(let t=0;t<this.ELEMENTS;++t)n+=(t>0?", ":"")+un(this[t],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Ur(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,t){if(t===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const a=e[i];this[i]=a+t*(n[i]-a)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(Math.max(this[t],e[t]),n[t]);return this.check()}add(...e){for(const n of e)for(let t=0;t<this.ELEMENTS;++t)this[t]+=n[t];return this.check()}subtract(...e){for(const n of e)for(let t=0;t<this.ELEMENTS;++t)this[t]-=n[t];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(U.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(Math.max(this[t],e),n);return this.check()}get elements(){return this}}function Rn(r,e){if(r.length!==e)return!1;for(let n=0;n<r.length;++n)if(!Number.isFinite(r[n]))return!1;return!0}function On(r){if(!Number.isFinite(r))throw new Error("Invalid number ".concat(r));return r}function zr(r,e,n=""){if(U.debug&&!Rn(r,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return r}var E={},W={};Object.defineProperty(W,"__esModule",{value:!0}),W.setMatrixArrayType=Pn,W.toRadian=wn,W.equals=$n,W.RANDOM=W.ARRAY_TYPE=W.EPSILON=void 0;var Ir=1e-6;W.EPSILON=Ir;var Kr=typeof Float32Array!="undefined"?Float32Array:Array;W.ARRAY_TYPE=Kr;var An=Math.random;W.RANDOM=An;function Pn(r){W.ARRAY_TYPE=Kr=r}var Ln=Math.PI/180;function wn(r){return r*Ln}function $n(r,e){return Math.abs(r-e)<=Ir*Math.max(1,Math.abs(r),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function or(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?or=function(n){return typeof n}:or=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},or(r)}Object.defineProperty(E,"__esModule",{value:!0}),E.create=Hr,E.clone=Cn,E.fromValues=Nn,E.copy=Fn,E.set=qn,E.add=Yn,E.subtract=Qr,E.multiply=Jr,E.divide=jr,E.ceil=kn,E.floor=bn,E.min=Wn,E.max=Bn,E.round=Zn,E.scale=Dn,E.scaleAndAdd=Vn,E.distance=re,E.squaredDistance=ee,E.length=ne,E.squaredLength=te,E.negate=Xn,E.inverse=Un,E.normalize=In,E.dot=Kn,E.cross=Gn,E.lerp=Hn,E.random=Qn,E.transformMat2=Jn,E.transformMat2d=jn,E.transformMat3=rt;var zn=E.transformMat4=et;E.rotate=nt,E.angle=tt,E.zero=it,E.str=at,E.exactEquals=st,E.equals=ht,E.forEach=E.sqrLen=E.sqrDist=E.dist=E.div=E.mul=E.sub=E.len=void 0;var Q=Sn(W);function Gr(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Gr=function(i){return i?n:e})(r)}function Sn(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||or(r)!=="object"&&typeof r!="function")return{default:r};var n=Gr(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function Hr(){var r=new Q.ARRAY_TYPE(2);return Q.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0),r}function Cn(r){var e=new Q.ARRAY_TYPE(2);return e[0]=r[0],e[1]=r[1],e}function Nn(r,e){var n=new Q.ARRAY_TYPE(2);return n[0]=r,n[1]=e,n}function Fn(r,e){return r[0]=e[0],r[1]=e[1],r}function qn(r,e,n){return r[0]=e,r[1]=n,r}function Yn(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r}function Qr(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r}function Jr(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r}function jr(r,e,n){return r[0]=e[0]/n[0],r[1]=e[1]/n[1],r}function kn(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r}function bn(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r}function Wn(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r}function Bn(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r}function Zn(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r}function Dn(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r}function Vn(r,e,n,t){return r[0]=e[0]+n[0]*t,r[1]=e[1]+n[1]*t,r}function re(r,e){var n=e[0]-r[0],t=e[1]-r[1];return Math.hypot(n,t)}function ee(r,e){var n=e[0]-r[0],t=e[1]-r[1];return n*n+t*t}function ne(r){var e=r[0],n=r[1];return Math.hypot(e,n)}function te(r){var e=r[0],n=r[1];return e*e+n*n}function Xn(r,e){return r[0]=-e[0],r[1]=-e[1],r}function Un(r,e){return r[0]=1/e[0],r[1]=1/e[1],r}function In(r,e){var n=e[0],t=e[1],i=n*n+t*t;return i>0&&(i=1/Math.sqrt(i)),r[0]=e[0]*i,r[1]=e[1]*i,r}function Kn(r,e){return r[0]*e[0]+r[1]*e[1]}function Gn(r,e,n){var t=e[0]*n[1]-e[1]*n[0];return r[0]=r[1]=0,r[2]=t,r}function Hn(r,e,n,t){var i=e[0],a=e[1];return r[0]=i+t*(n[0]-i),r[1]=a+t*(n[1]-a),r}function Qn(r,e){e=e||1;var n=Q.RANDOM()*2*Math.PI;return r[0]=Math.cos(n)*e,r[1]=Math.sin(n)*e,r}function Jn(r,e,n){var t=e[0],i=e[1];return r[0]=n[0]*t+n[2]*i,r[1]=n[1]*t+n[3]*i,r}function jn(r,e,n){var t=e[0],i=e[1];return r[0]=n[0]*t+n[2]*i+n[4],r[1]=n[1]*t+n[3]*i+n[5],r}function rt(r,e,n){var t=e[0],i=e[1];return r[0]=n[0]*t+n[3]*i+n[6],r[1]=n[1]*t+n[4]*i+n[7],r}function et(r,e,n){var t=e[0],i=e[1];return r[0]=n[0]*t+n[4]*i+n[12],r[1]=n[1]*t+n[5]*i+n[13],r}function nt(r,e,n,t){var i=e[0]-n[0],a=e[1]-n[1],s=Math.sin(t),h=Math.cos(t);return r[0]=i*h-a*s+n[0],r[1]=i*s+a*h+n[1],r}function tt(r,e){var n=r[0],t=r[1],i=e[0],a=e[1],s=Math.sqrt(n*n+t*t)*Math.sqrt(i*i+a*a),h=s&&(n*i+t*a)/s;return Math.acos(Math.min(Math.max(h,-1),1))}function it(r){return r[0]=0,r[1]=0,r}function at(r){return"vec2("+r[0]+", "+r[1]+")"}function st(r,e){return r[0]===e[0]&&r[1]===e[1]}function ht(r,e){var n=r[0],t=r[1],i=e[0],a=e[1];return Math.abs(n-i)<=Q.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(t-a)<=Q.EPSILON*Math.max(1,Math.abs(t),Math.abs(a))}var ct=ne;E.len=ct;var lt=Qr;E.sub=lt;var ft=Jr;E.mul=ft;var vt=jr;E.div=vt;var ot=re;E.dist=ot;var Mt=ee;E.sqrDist=Mt;var pt=te;E.sqrLen=pt;var yt=function(){var r=Hr();return function(e,n,t,i,a,s){var h,c;for(n||(n=2),t||(t=0),i?c=Math.min(i*n+t,e.length):c=e.length,h=t;h<c;h+=n)r[0]=e[h],r[1]=e[h+1],a(r,r,s),e[h]=r[0],e[h+1]=r[1];return e}}();E.forEach=yt;function xt(r,e,n){const t=e[0],i=e[1],a=n[3]*t+n[7]*i||1;return r[0]=(n[0]*t+n[4]*i)/a,r[1]=(n[1]*t+n[5]*i)/a,r}function mt(r,e,n){const t=e[0],i=e[1],a=e[2],s=n[3]*t+n[7]*i+n[11]*a||1;return r[0]=(n[0]*t+n[4]*i+n[8]*a)/s,r[1]=(n[1]*t+n[5]*i+n[9]*a)/s,r[2]=(n[2]*t+n[6]*i+n[10]*a)/s,r}var T={};function Mr(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Mr=function(n){return typeof n}:Mr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Mr(r)}Object.defineProperty(T,"__esModule",{value:!0}),T.create=ae,T.clone=ut,T.length=se,T.fromValues=Tt,T.copy=_t,T.set=Et,T.add=Rt,T.subtract=he,T.multiply=ce,T.divide=le,T.ceil=Ot,T.floor=At,T.min=Pt,T.max=Lt,T.round=wt,T.scale=$t,T.scaleAndAdd=zt,T.distance=fe,T.squaredDistance=ve,T.squaredLength=oe,T.negate=St,T.inverse=Ct,T.normalize=Nt,T.dot=Me,T.cross=Ft,T.lerp=qt,T.hermite=Yt,T.bezier=kt,T.random=bt;var gt=T.transformMat4=Wt;T.transformMat3=Bt,T.transformQuat=Zt,T.rotateX=Dt,T.rotateY=Vt,T.rotateZ=Xt,T.angle=Ut,T.zero=It,T.str=Kt,T.exactEquals=Gt,T.equals=Ht,T.forEach=T.sqrLen=T.len=T.sqrDist=T.dist=T.div=T.mul=T.sub=void 0;var I=dt(W);function ie(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ie=function(i){return i?n:e})(r)}function dt(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||Mr(r)!=="object"&&typeof r!="function")return{default:r};var n=ie(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function ae(){var r=new I.ARRAY_TYPE(3);return I.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function ut(r){var e=new I.ARRAY_TYPE(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function se(r){var e=r[0],n=r[1],t=r[2];return Math.hypot(e,n,t)}function Tt(r,e,n){var t=new I.ARRAY_TYPE(3);return t[0]=r,t[1]=e,t[2]=n,t}function _t(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function Et(r,e,n,t){return r[0]=e,r[1]=n,r[2]=t,r}function Rt(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r}function he(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r}function ce(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r}function le(r,e,n){return r[0]=e[0]/n[0],r[1]=e[1]/n[1],r[2]=e[2]/n[2],r}function Ot(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r}function At(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r}function Pt(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r}function Lt(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r}function wt(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r}function $t(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r}function zt(r,e,n,t){return r[0]=e[0]+n[0]*t,r[1]=e[1]+n[1]*t,r[2]=e[2]+n[2]*t,r}function fe(r,e){var n=e[0]-r[0],t=e[1]-r[1],i=e[2]-r[2];return Math.hypot(n,t,i)}function ve(r,e){var n=e[0]-r[0],t=e[1]-r[1],i=e[2]-r[2];return n*n+t*t+i*i}function oe(r){var e=r[0],n=r[1],t=r[2];return e*e+n*n+t*t}function St(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function Ct(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r}function Nt(r,e){var n=e[0],t=e[1],i=e[2],a=n*n+t*t+i*i;return a>0&&(a=1/Math.sqrt(a)),r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r}function Me(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Ft(r,e,n){var t=e[0],i=e[1],a=e[2],s=n[0],h=n[1],c=n[2];return r[0]=i*c-a*h,r[1]=a*s-t*c,r[2]=t*h-i*s,r}function qt(r,e,n,t){var i=e[0],a=e[1],s=e[2];return r[0]=i+t*(n[0]-i),r[1]=a+t*(n[1]-a),r[2]=s+t*(n[2]-s),r}function Yt(r,e,n,t,i,a){var s=a*a,h=s*(2*a-3)+1,c=s*(a-2)+a,l=s*(a-1),f=s*(3-2*a);return r[0]=e[0]*h+n[0]*c+t[0]*l+i[0]*f,r[1]=e[1]*h+n[1]*c+t[1]*l+i[1]*f,r[2]=e[2]*h+n[2]*c+t[2]*l+i[2]*f,r}function kt(r,e,n,t,i,a){var s=1-a,h=s*s,c=a*a,l=h*s,f=3*a*h,o=3*c*s,v=c*a;return r[0]=e[0]*l+n[0]*f+t[0]*o+i[0]*v,r[1]=e[1]*l+n[1]*f+t[1]*o+i[1]*v,r[2]=e[2]*l+n[2]*f+t[2]*o+i[2]*v,r}function bt(r,e){e=e||1;var n=I.RANDOM()*2*Math.PI,t=I.RANDOM()*2-1,i=Math.sqrt(1-t*t)*e;return r[0]=Math.cos(n)*i,r[1]=Math.sin(n)*i,r[2]=t*e,r}function Wt(r,e,n){var t=e[0],i=e[1],a=e[2],s=n[3]*t+n[7]*i+n[11]*a+n[15];return s=s||1,r[0]=(n[0]*t+n[4]*i+n[8]*a+n[12])/s,r[1]=(n[1]*t+n[5]*i+n[9]*a+n[13])/s,r[2]=(n[2]*t+n[6]*i+n[10]*a+n[14])/s,r}function Bt(r,e,n){var t=e[0],i=e[1],a=e[2];return r[0]=t*n[0]+i*n[3]+a*n[6],r[1]=t*n[1]+i*n[4]+a*n[7],r[2]=t*n[2]+i*n[5]+a*n[8],r}function Zt(r,e,n){var t=n[0],i=n[1],a=n[2],s=n[3],h=e[0],c=e[1],l=e[2],f=i*l-a*c,o=a*h-t*l,v=t*c-i*h,M=i*v-a*o,p=a*f-t*v,x=t*o-i*f,y=s*2;return f*=y,o*=y,v*=y,M*=2,p*=2,x*=2,r[0]=h+f+M,r[1]=c+o+p,r[2]=l+v+x,r}function Dt(r,e,n,t){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(t)-i[2]*Math.sin(t),a[2]=i[1]*Math.sin(t)+i[2]*Math.cos(t),r[0]=a[0]+n[0],r[1]=a[1]+n[1],r[2]=a[2]+n[2],r}function Vt(r,e,n,t){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[2]*Math.sin(t)+i[0]*Math.cos(t),a[1]=i[1],a[2]=i[2]*Math.cos(t)-i[0]*Math.sin(t),r[0]=a[0]+n[0],r[1]=a[1]+n[1],r[2]=a[2]+n[2],r}function Xt(r,e,n,t){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0]*Math.cos(t)-i[1]*Math.sin(t),a[1]=i[0]*Math.sin(t)+i[1]*Math.cos(t),a[2]=i[2],r[0]=a[0]+n[0],r[1]=a[1]+n[1],r[2]=a[2]+n[2],r}function Ut(r,e){var n=r[0],t=r[1],i=r[2],a=e[0],s=e[1],h=e[2],c=Math.sqrt(n*n+t*t+i*i),l=Math.sqrt(a*a+s*s+h*h),f=c*l,o=f&&Me(r,e)/f;return Math.acos(Math.min(Math.max(o,-1),1))}function It(r){return r[0]=0,r[1]=0,r[2]=0,r}function Kt(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function Gt(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}function Ht(r,e){var n=r[0],t=r[1],i=r[2],a=e[0],s=e[1],h=e[2];return Math.abs(n-a)<=I.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(t-s)<=I.EPSILON*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(i-h)<=I.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))}var Qt=he;T.sub=Qt;var Jt=ce;T.mul=Jt;var jt=le;T.div=jt;var ri=fe;T.dist=ri;var ei=ve;T.sqrDist=ei;var ni=se;T.len=ni;var ti=oe;T.sqrLen=ti;var ii=function(){var r=ae();return function(e,n,t,i,a,s){var h,c;for(n||(n=3),t||(t=0),i?c=Math.min(i*n+t,e.length):c=e.length,h=t;h<c;h+=n)r[0]=e[h],r[1]=e[h+1],r[2]=e[h+2],a(r,r,s),e[h]=r[0],e[h+1]=r[1],e[h+2]=r[2];return e}}();T.forEach=ii;class ai extends En{toString(){let e="[";if(U.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let t=0;t<this.RANK;++t)e+=" ".concat(this[t*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,t){return this[n*this.RANK+e]=On(t),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const t=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[t+i];return n}setColumn(e,n){const t=e*this.RANK;for(let i=0;i<this.RANK;++i)this[t+i]=n[i];return this}}var w={};function pr(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pr=function(n){return typeof n}:pr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},pr(r)}Object.defineProperty(w,"__esModule",{value:!0}),w.create=hi,w.fromMat4=ci,w.clone=li,w.copy=fi,w.fromValues=vi,w.set=oi,w.identity=Mi,w.transpose=pi,w.invert=yi,w.adjoint=xi,w.determinant=mi,w.multiply=ye,w.translate=gi,w.rotate=di,w.scale=ui,w.fromTranslation=Ti,w.fromRotation=_i,w.fromScaling=Ei,w.fromMat2d=Ri,w.fromQuat=Oi,w.normalFromMat4=Ai,w.projection=Pi,w.str=Li,w.frob=wi,w.add=$i,w.subtract=xe,w.multiplyScalar=zi,w.multiplyScalarAndAdd=Si,w.exactEquals=Ci,w.equals=Ni,w.sub=w.mul=void 0;var B=si(W);function pe(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(pe=function(i){return i?n:e})(r)}function si(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||pr(r)!=="object"&&typeof r!="function")return{default:r};var n=pe(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function hi(){var r=new B.ARRAY_TYPE(9);return B.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ci(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r}function li(r){var e=new B.ARRAY_TYPE(9);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e}function fi(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function vi(r,e,n,t,i,a,s,h,c){var l=new B.ARRAY_TYPE(9);return l[0]=r,l[1]=e,l[2]=n,l[3]=t,l[4]=i,l[5]=a,l[6]=s,l[7]=h,l[8]=c,l}function oi(r,e,n,t,i,a,s,h,c,l){return r[0]=e,r[1]=n,r[2]=t,r[3]=i,r[4]=a,r[5]=s,r[6]=h,r[7]=c,r[8]=l,r}function Mi(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function pi(r,e){if(r===e){var n=e[1],t=e[2],i=e[5];r[1]=e[3],r[2]=e[6],r[3]=n,r[5]=e[7],r[6]=t,r[7]=i}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function yi(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=e[4],h=e[5],c=e[6],l=e[7],f=e[8],o=f*s-h*l,v=-f*a+h*c,M=l*a-s*c,p=n*o+t*v+i*M;return p?(p=1/p,r[0]=o*p,r[1]=(-f*t+i*l)*p,r[2]=(h*t-i*s)*p,r[3]=v*p,r[4]=(f*n-i*c)*p,r[5]=(-h*n+i*a)*p,r[6]=M*p,r[7]=(-l*n+t*c)*p,r[8]=(s*n-t*a)*p,r):null}function xi(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=e[4],h=e[5],c=e[6],l=e[7],f=e[8];return r[0]=s*f-h*l,r[1]=i*l-t*f,r[2]=t*h-i*s,r[3]=h*c-a*f,r[4]=n*f-i*c,r[5]=i*a-n*h,r[6]=a*l-s*c,r[7]=t*c-n*l,r[8]=n*s-t*a,r}function mi(r){var e=r[0],n=r[1],t=r[2],i=r[3],a=r[4],s=r[5],h=r[6],c=r[7],l=r[8];return e*(l*a-s*c)+n*(-l*i+s*h)+t*(c*i-a*h)}function ye(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=e[4],c=e[5],l=e[6],f=e[7],o=e[8],v=n[0],M=n[1],p=n[2],x=n[3],y=n[4],g=n[5],R=n[6],m=n[7],d=n[8];return r[0]=v*t+M*s+p*l,r[1]=v*i+M*h+p*f,r[2]=v*a+M*c+p*o,r[3]=x*t+y*s+g*l,r[4]=x*i+y*h+g*f,r[5]=x*a+y*c+g*o,r[6]=R*t+m*s+d*l,r[7]=R*i+m*h+d*f,r[8]=R*a+m*c+d*o,r}function gi(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=e[4],c=e[5],l=e[6],f=e[7],o=e[8],v=n[0],M=n[1];return r[0]=t,r[1]=i,r[2]=a,r[3]=s,r[4]=h,r[5]=c,r[6]=v*t+M*s+l,r[7]=v*i+M*h+f,r[8]=v*a+M*c+o,r}function di(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=e[4],c=e[5],l=e[6],f=e[7],o=e[8],v=Math.sin(n),M=Math.cos(n);return r[0]=M*t+v*s,r[1]=M*i+v*h,r[2]=M*a+v*c,r[3]=M*s-v*t,r[4]=M*h-v*i,r[5]=M*c-v*a,r[6]=l,r[7]=f,r[8]=o,r}function ui(r,e,n){var t=n[0],i=n[1];return r[0]=t*e[0],r[1]=t*e[1],r[2]=t*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function Ti(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=e[0],r[7]=e[1],r[8]=1,r}function _i(r,e){var n=Math.sin(e),t=Math.cos(e);return r[0]=t,r[1]=n,r[2]=0,r[3]=-n,r[4]=t,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function Ei(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=e[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function Ri(r,e){return r[0]=e[0],r[1]=e[1],r[2]=0,r[3]=e[2],r[4]=e[3],r[5]=0,r[6]=e[4],r[7]=e[5],r[8]=1,r}function Oi(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=n+n,h=t+t,c=i+i,l=n*s,f=t*s,o=t*h,v=i*s,M=i*h,p=i*c,x=a*s,y=a*h,g=a*c;return r[0]=1-o-p,r[3]=f-g,r[6]=v+y,r[1]=f+g,r[4]=1-l-p,r[7]=M-x,r[2]=v-y,r[5]=M+x,r[8]=1-l-o,r}function Ai(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=e[4],h=e[5],c=e[6],l=e[7],f=e[8],o=e[9],v=e[10],M=e[11],p=e[12],x=e[13],y=e[14],g=e[15],R=n*h-t*s,m=n*c-i*s,d=n*l-a*s,P=t*c-i*h,A=t*l-a*h,F=i*l-a*c,S=f*x-o*p,C=f*y-v*p,$=f*g-M*p,q=o*y-v*x,N=o*g-M*x,Y=v*g-M*y,L=R*Y-m*N+d*q+P*$-A*C+F*S;return L?(L=1/L,r[0]=(h*Y-c*N+l*q)*L,r[1]=(c*$-s*Y-l*C)*L,r[2]=(s*N-h*$+l*S)*L,r[3]=(i*N-t*Y-a*q)*L,r[4]=(n*Y-i*$+a*C)*L,r[5]=(t*$-n*N-a*S)*L,r[6]=(x*F-y*A+g*P)*L,r[7]=(y*d-p*F-g*m)*L,r[8]=(p*A-x*d+g*R)*L,r):null}function Pi(r,e,n){return r[0]=2/e,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/n,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r}function Li(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"}function wi(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}function $i(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3]+n[3],r[4]=e[4]+n[4],r[5]=e[5]+n[5],r[6]=e[6]+n[6],r[7]=e[7]+n[7],r[8]=e[8]+n[8],r}function xe(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r[3]=e[3]-n[3],r[4]=e[4]-n[4],r[5]=e[5]-n[5],r[6]=e[6]-n[6],r[7]=e[7]-n[7],r[8]=e[8]-n[8],r}function zi(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*n,r}function Si(r,e,n,t){return r[0]=e[0]+n[0]*t,r[1]=e[1]+n[1]*t,r[2]=e[2]+n[2]*t,r[3]=e[3]+n[3]*t,r[4]=e[4]+n[4]*t,r[5]=e[5]+n[5]*t,r[6]=e[6]+n[6]*t,r[7]=e[7]+n[7]*t,r[8]=e[8]+n[8]*t,r}function Ci(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]}function Ni(r,e){var n=r[0],t=r[1],i=r[2],a=r[3],s=r[4],h=r[5],c=r[6],l=r[7],f=r[8],o=e[0],v=e[1],M=e[2],p=e[3],x=e[4],y=e[5],g=e[6],R=e[7],m=e[8];return Math.abs(n-o)<=B.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(t-v)<=B.EPSILON*Math.max(1,Math.abs(t),Math.abs(v))&&Math.abs(i-M)<=B.EPSILON*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(a-p)<=B.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-x)<=B.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(h-y)<=B.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-g)<=B.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(l-R)<=B.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(f-m)<=B.EPSILON*Math.max(1,Math.abs(f),Math.abs(m))}var Fi=ye;w.mul=Fi;var qi=xe;w.sub=qi;var me;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(me||(me={})),Object.freeze([1,0,0,0,1,0,0,0,1]);var _={};function yr(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?yr=function(n){return typeof n}:yr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},yr(r)}Object.defineProperty(_,"__esModule",{value:!0}),_.create=Hi,_.clone=Qi,_.copy=Ji,_.fromValues=ji,_.set=r1,_.identity=ue;var Yi=_.transpose=e1,ki=_.invert=n1;_.adjoint=t1;var bi=_.determinant=i1,ge=_.multiply=Te,Wi=_.translate=a1,Bi=_.scale=s1,Zi=_.rotate=h1,Di=_.rotateX=c1,Vi=_.rotateY=l1,Xi=_.rotateZ=f1;_.fromTranslation=v1,_.fromScaling=o1,_.fromRotation=M1,_.fromXRotation=p1,_.fromYRotation=y1,_.fromZRotation=x1,_.fromRotationTranslation=_e,_.fromQuat2=m1,_.getTranslation=g1,_.getScaling=Ee,_.getRotation=d1,_.fromRotationTranslationScale=u1,_.fromRotationTranslationScaleOrigin=T1;var Ui=_.fromQuat=_1,Ii=_.frustum=E1;_.perspectiveNO=Re,_.perspectiveZO=O1,_.perspectiveFromFieldOfView=A1,_.orthoNO=Ae,_.orthoZO=L1;var Ki=_.lookAt=w1;_.targetTo=$1,_.str=z1,_.frob=S1,_.add=C1,_.subtract=Le,_.multiplyScalar=N1,_.multiplyScalarAndAdd=F1,_.exactEquals=q1,_.equals=Y1,_.sub=_.mul=Pe=_.ortho=Oe=_.perspective=void 0;var z=Gi(W);function de(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(de=function(i){return i?n:e})(r)}function Gi(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||yr(r)!=="object"&&typeof r!="function")return{default:r};var n=de(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function Hi(){var r=new z.ARRAY_TYPE(16);return z.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Qi(r){var e=new z.ARRAY_TYPE(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Ji(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function ji(r,e,n,t,i,a,s,h,c,l,f,o,v,M,p,x){var y=new z.ARRAY_TYPE(16);return y[0]=r,y[1]=e,y[2]=n,y[3]=t,y[4]=i,y[5]=a,y[6]=s,y[7]=h,y[8]=c,y[9]=l,y[10]=f,y[11]=o,y[12]=v,y[13]=M,y[14]=p,y[15]=x,y}function r1(r,e,n,t,i,a,s,h,c,l,f,o,v,M,p,x,y){return r[0]=e,r[1]=n,r[2]=t,r[3]=i,r[4]=a,r[5]=s,r[6]=h,r[7]=c,r[8]=l,r[9]=f,r[10]=o,r[11]=v,r[12]=M,r[13]=p,r[14]=x,r[15]=y,r}function ue(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function e1(r,e){if(r===e){var n=e[1],t=e[2],i=e[3],a=e[6],s=e[7],h=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=n,r[6]=e[9],r[7]=e[13],r[8]=t,r[9]=a,r[11]=e[14],r[12]=i,r[13]=s,r[14]=h}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function n1(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=e[4],h=e[5],c=e[6],l=e[7],f=e[8],o=e[9],v=e[10],M=e[11],p=e[12],x=e[13],y=e[14],g=e[15],R=n*h-t*s,m=n*c-i*s,d=n*l-a*s,P=t*c-i*h,A=t*l-a*h,F=i*l-a*c,S=f*x-o*p,C=f*y-v*p,$=f*g-M*p,q=o*y-v*x,N=o*g-M*x,Y=v*g-M*y,L=R*Y-m*N+d*q+P*$-A*C+F*S;return L?(L=1/L,r[0]=(h*Y-c*N+l*q)*L,r[1]=(i*N-t*Y-a*q)*L,r[2]=(x*F-y*A+g*P)*L,r[3]=(v*A-o*F-M*P)*L,r[4]=(c*$-s*Y-l*C)*L,r[5]=(n*Y-i*$+a*C)*L,r[6]=(y*d-p*F-g*m)*L,r[7]=(f*F-v*d+M*m)*L,r[8]=(s*N-h*$+l*S)*L,r[9]=(t*$-n*N-a*S)*L,r[10]=(p*A-x*d+g*R)*L,r[11]=(o*d-f*A-M*R)*L,r[12]=(h*C-s*q-c*S)*L,r[13]=(n*q-t*C+i*S)*L,r[14]=(x*m-p*P-y*R)*L,r[15]=(f*P-o*m+v*R)*L,r):null}function t1(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=e[4],h=e[5],c=e[6],l=e[7],f=e[8],o=e[9],v=e[10],M=e[11],p=e[12],x=e[13],y=e[14],g=e[15];return r[0]=h*(v*g-M*y)-o*(c*g-l*y)+x*(c*M-l*v),r[1]=-(t*(v*g-M*y)-o*(i*g-a*y)+x*(i*M-a*v)),r[2]=t*(c*g-l*y)-h*(i*g-a*y)+x*(i*l-a*c),r[3]=-(t*(c*M-l*v)-h*(i*M-a*v)+o*(i*l-a*c)),r[4]=-(s*(v*g-M*y)-f*(c*g-l*y)+p*(c*M-l*v)),r[5]=n*(v*g-M*y)-f*(i*g-a*y)+p*(i*M-a*v),r[6]=-(n*(c*g-l*y)-s*(i*g-a*y)+p*(i*l-a*c)),r[7]=n*(c*M-l*v)-s*(i*M-a*v)+f*(i*l-a*c),r[8]=s*(o*g-M*x)-f*(h*g-l*x)+p*(h*M-l*o),r[9]=-(n*(o*g-M*x)-f*(t*g-a*x)+p*(t*M-a*o)),r[10]=n*(h*g-l*x)-s*(t*g-a*x)+p*(t*l-a*h),r[11]=-(n*(h*M-l*o)-s*(t*M-a*o)+f*(t*l-a*h)),r[12]=-(s*(o*y-v*x)-f*(h*y-c*x)+p*(h*v-c*o)),r[13]=n*(o*y-v*x)-f*(t*y-i*x)+p*(t*v-i*o),r[14]=-(n*(h*y-c*x)-s*(t*y-i*x)+p*(t*c-i*h)),r[15]=n*(h*v-c*o)-s*(t*v-i*o)+f*(t*c-i*h),r}function i1(r){var e=r[0],n=r[1],t=r[2],i=r[3],a=r[4],s=r[5],h=r[6],c=r[7],l=r[8],f=r[9],o=r[10],v=r[11],M=r[12],p=r[13],x=r[14],y=r[15],g=e*s-n*a,R=e*h-t*a,m=e*c-i*a,d=n*h-t*s,P=n*c-i*s,A=t*c-i*h,F=l*p-f*M,S=l*x-o*M,C=l*y-v*M,$=f*x-o*p,q=f*y-v*p,N=o*y-v*x;return g*N-R*q+m*$+d*C-P*S+A*F}function Te(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=e[4],c=e[5],l=e[6],f=e[7],o=e[8],v=e[9],M=e[10],p=e[11],x=e[12],y=e[13],g=e[14],R=e[15],m=n[0],d=n[1],P=n[2],A=n[3];return r[0]=m*t+d*h+P*o+A*x,r[1]=m*i+d*c+P*v+A*y,r[2]=m*a+d*l+P*M+A*g,r[3]=m*s+d*f+P*p+A*R,m=n[4],d=n[5],P=n[6],A=n[7],r[4]=m*t+d*h+P*o+A*x,r[5]=m*i+d*c+P*v+A*y,r[6]=m*a+d*l+P*M+A*g,r[7]=m*s+d*f+P*p+A*R,m=n[8],d=n[9],P=n[10],A=n[11],r[8]=m*t+d*h+P*o+A*x,r[9]=m*i+d*c+P*v+A*y,r[10]=m*a+d*l+P*M+A*g,r[11]=m*s+d*f+P*p+A*R,m=n[12],d=n[13],P=n[14],A=n[15],r[12]=m*t+d*h+P*o+A*x,r[13]=m*i+d*c+P*v+A*y,r[14]=m*a+d*l+P*M+A*g,r[15]=m*s+d*f+P*p+A*R,r}function a1(r,e,n){var t=n[0],i=n[1],a=n[2],s,h,c,l,f,o,v,M,p,x,y,g;return e===r?(r[12]=e[0]*t+e[4]*i+e[8]*a+e[12],r[13]=e[1]*t+e[5]*i+e[9]*a+e[13],r[14]=e[2]*t+e[6]*i+e[10]*a+e[14],r[15]=e[3]*t+e[7]*i+e[11]*a+e[15]):(s=e[0],h=e[1],c=e[2],l=e[3],f=e[4],o=e[5],v=e[6],M=e[7],p=e[8],x=e[9],y=e[10],g=e[11],r[0]=s,r[1]=h,r[2]=c,r[3]=l,r[4]=f,r[5]=o,r[6]=v,r[7]=M,r[8]=p,r[9]=x,r[10]=y,r[11]=g,r[12]=s*t+f*i+p*a+e[12],r[13]=h*t+o*i+x*a+e[13],r[14]=c*t+v*i+y*a+e[14],r[15]=l*t+M*i+g*a+e[15]),r}function s1(r,e,n){var t=n[0],i=n[1],a=n[2];return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*a,r[9]=e[9]*a,r[10]=e[10]*a,r[11]=e[11]*a,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function h1(r,e,n,t){var i=t[0],a=t[1],s=t[2],h=Math.hypot(i,a,s),c,l,f,o,v,M,p,x,y,g,R,m,d,P,A,F,S,C,$,q,N,Y,L,X;return h<z.EPSILON?null:(h=1/h,i*=h,a*=h,s*=h,c=Math.sin(n),l=Math.cos(n),f=1-l,o=e[0],v=e[1],M=e[2],p=e[3],x=e[4],y=e[5],g=e[6],R=e[7],m=e[8],d=e[9],P=e[10],A=e[11],F=i*i*f+l,S=a*i*f+s*c,C=s*i*f-a*c,$=i*a*f-s*c,q=a*a*f+l,N=s*a*f+i*c,Y=i*s*f+a*c,L=a*s*f-i*c,X=s*s*f+l,r[0]=o*F+x*S+m*C,r[1]=v*F+y*S+d*C,r[2]=M*F+g*S+P*C,r[3]=p*F+R*S+A*C,r[4]=o*$+x*q+m*N,r[5]=v*$+y*q+d*N,r[6]=M*$+g*q+P*N,r[7]=p*$+R*q+A*N,r[8]=o*Y+x*L+m*X,r[9]=v*Y+y*L+d*X,r[10]=M*Y+g*L+P*X,r[11]=p*Y+R*L+A*X,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function c1(r,e,n){var t=Math.sin(n),i=Math.cos(n),a=e[4],s=e[5],h=e[6],c=e[7],l=e[8],f=e[9],o=e[10],v=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=a*i+l*t,r[5]=s*i+f*t,r[6]=h*i+o*t,r[7]=c*i+v*t,r[8]=l*i-a*t,r[9]=f*i-s*t,r[10]=o*i-h*t,r[11]=v*i-c*t,r}function l1(r,e,n){var t=Math.sin(n),i=Math.cos(n),a=e[0],s=e[1],h=e[2],c=e[3],l=e[8],f=e[9],o=e[10],v=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=a*i-l*t,r[1]=s*i-f*t,r[2]=h*i-o*t,r[3]=c*i-v*t,r[8]=a*t+l*i,r[9]=s*t+f*i,r[10]=h*t+o*i,r[11]=c*t+v*i,r}function f1(r,e,n){var t=Math.sin(n),i=Math.cos(n),a=e[0],s=e[1],h=e[2],c=e[3],l=e[4],f=e[5],o=e[6],v=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=a*i+l*t,r[1]=s*i+f*t,r[2]=h*i+o*t,r[3]=c*i+v*t,r[4]=l*i-a*t,r[5]=f*i-s*t,r[6]=o*i-h*t,r[7]=v*i-c*t,r}function v1(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function o1(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function M1(r,e,n){var t=n[0],i=n[1],a=n[2],s=Math.hypot(t,i,a),h,c,l;return s<z.EPSILON?null:(s=1/s,t*=s,i*=s,a*=s,h=Math.sin(e),c=Math.cos(e),l=1-c,r[0]=t*t*l+c,r[1]=i*t*l+a*h,r[2]=a*t*l-i*h,r[3]=0,r[4]=t*i*l-a*h,r[5]=i*i*l+c,r[6]=a*i*l+t*h,r[7]=0,r[8]=t*a*l+i*h,r[9]=i*a*l-t*h,r[10]=a*a*l+c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function p1(r,e){var n=Math.sin(e),t=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t,r[6]=n,r[7]=0,r[8]=0,r[9]=-n,r[10]=t,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function y1(r,e){var n=Math.sin(e),t=Math.cos(e);return r[0]=t,r[1]=0,r[2]=-n,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=n,r[9]=0,r[10]=t,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function x1(r,e){var n=Math.sin(e),t=Math.cos(e);return r[0]=t,r[1]=n,r[2]=0,r[3]=0,r[4]=-n,r[5]=t,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function _e(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=t+t,c=i+i,l=a+a,f=t*h,o=t*c,v=t*l,M=i*c,p=i*l,x=a*l,y=s*h,g=s*c,R=s*l;return r[0]=1-(M+x),r[1]=o+R,r[2]=v-g,r[3]=0,r[4]=o-R,r[5]=1-(f+x),r[6]=p+y,r[7]=0,r[8]=v+g,r[9]=p-y,r[10]=1-(f+M),r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function m1(r,e){var n=new z.ARRAY_TYPE(3),t=-e[0],i=-e[1],a=-e[2],s=e[3],h=e[4],c=e[5],l=e[6],f=e[7],o=t*t+i*i+a*a+s*s;return o>0?(n[0]=(h*s+f*t+c*a-l*i)*2/o,n[1]=(c*s+f*i+l*t-h*a)*2/o,n[2]=(l*s+f*a+h*i-c*t)*2/o):(n[0]=(h*s+f*t+c*a-l*i)*2,n[1]=(c*s+f*i+l*t-h*a)*2,n[2]=(l*s+f*a+h*i-c*t)*2),_e(r,e,n),r}function g1(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function Ee(r,e){var n=e[0],t=e[1],i=e[2],a=e[4],s=e[5],h=e[6],c=e[8],l=e[9],f=e[10];return r[0]=Math.hypot(n,t,i),r[1]=Math.hypot(a,s,h),r[2]=Math.hypot(c,l,f),r}function d1(r,e){var n=new z.ARRAY_TYPE(3);Ee(n,e);var t=1/n[0],i=1/n[1],a=1/n[2],s=e[0]*t,h=e[1]*i,c=e[2]*a,l=e[4]*t,f=e[5]*i,o=e[6]*a,v=e[8]*t,M=e[9]*i,p=e[10]*a,x=s+f+p,y=0;return x>0?(y=Math.sqrt(x+1)*2,r[3]=.25*y,r[0]=(o-M)/y,r[1]=(v-c)/y,r[2]=(h-l)/y):s>f&&s>p?(y=Math.sqrt(1+s-f-p)*2,r[3]=(o-M)/y,r[0]=.25*y,r[1]=(h+l)/y,r[2]=(v+c)/y):f>p?(y=Math.sqrt(1+f-s-p)*2,r[3]=(v-c)/y,r[0]=(h+l)/y,r[1]=.25*y,r[2]=(o+M)/y):(y=Math.sqrt(1+p-s-f)*2,r[3]=(h-l)/y,r[0]=(v+c)/y,r[1]=(o+M)/y,r[2]=.25*y),r}function u1(r,e,n,t){var i=e[0],a=e[1],s=e[2],h=e[3],c=i+i,l=a+a,f=s+s,o=i*c,v=i*l,M=i*f,p=a*l,x=a*f,y=s*f,g=h*c,R=h*l,m=h*f,d=t[0],P=t[1],A=t[2];return r[0]=(1-(p+y))*d,r[1]=(v+m)*d,r[2]=(M-R)*d,r[3]=0,r[4]=(v-m)*P,r[5]=(1-(o+y))*P,r[6]=(x+g)*P,r[7]=0,r[8]=(M+R)*A,r[9]=(x-g)*A,r[10]=(1-(o+p))*A,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function T1(r,e,n,t,i){var a=e[0],s=e[1],h=e[2],c=e[3],l=a+a,f=s+s,o=h+h,v=a*l,M=a*f,p=a*o,x=s*f,y=s*o,g=h*o,R=c*l,m=c*f,d=c*o,P=t[0],A=t[1],F=t[2],S=i[0],C=i[1],$=i[2],q=(1-(x+g))*P,N=(M+d)*P,Y=(p-m)*P,L=(M-d)*A,X=(1-(v+g))*A,rr=(y+R)*A,er=(p+m)*F,Wr=(y-R)*F,Br=(1-(v+x))*F;return r[0]=q,r[1]=N,r[2]=Y,r[3]=0,r[4]=L,r[5]=X,r[6]=rr,r[7]=0,r[8]=er,r[9]=Wr,r[10]=Br,r[11]=0,r[12]=n[0]+S-(q*S+L*C+er*$),r[13]=n[1]+C-(N*S+X*C+Wr*$),r[14]=n[2]+$-(Y*S+rr*C+Br*$),r[15]=1,r}function _1(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=n+n,h=t+t,c=i+i,l=n*s,f=t*s,o=t*h,v=i*s,M=i*h,p=i*c,x=a*s,y=a*h,g=a*c;return r[0]=1-o-p,r[1]=f+g,r[2]=v-y,r[3]=0,r[4]=f-g,r[5]=1-l-p,r[6]=M+x,r[7]=0,r[8]=v+y,r[9]=M-x,r[10]=1-l-o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function E1(r,e,n,t,i,a,s){var h=1/(n-e),c=1/(i-t),l=1/(a-s);return r[0]=a*2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a*2*c,r[6]=0,r[7]=0,r[8]=(n+e)*h,r[9]=(i+t)*c,r[10]=(s+a)*l,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*a*2*l,r[15]=0,r}function Re(r,e,n,t,i){var a=1/Math.tan(e/2),s;return r[0]=a/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(s=1/(t-i),r[10]=(i+t)*s,r[14]=2*i*t*s):(r[10]=-1,r[14]=-2*t),r}var R1=Re,Oe=_.perspective=R1;function O1(r,e,n,t,i){var a=1/Math.tan(e/2),s;return r[0]=a/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(s=1/(t-i),r[10]=i*s,r[14]=i*t*s):(r[10]=-1,r[14]=-t),r}function A1(r,e,n,t){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),h=Math.tan(e.rightDegrees*Math.PI/180),c=2/(s+h),l=2/(i+a);return r[0]=c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=l,r[6]=0,r[7]=0,r[8]=-((s-h)*c*.5),r[9]=(i-a)*l*.5,r[10]=t/(n-t),r[11]=-1,r[12]=0,r[13]=0,r[14]=t*n/(n-t),r[15]=0,r}function Ae(r,e,n,t,i,a,s){var h=1/(e-n),c=1/(t-i),l=1/(a-s);return r[0]=-2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*c,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*l,r[11]=0,r[12]=(e+n)*h,r[13]=(i+t)*c,r[14]=(s+a)*l,r[15]=1,r}var P1=Ae,Pe=_.ortho=P1;function L1(r,e,n,t,i,a,s){var h=1/(e-n),c=1/(t-i),l=1/(a-s);return r[0]=-2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*c,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=l,r[11]=0,r[12]=(e+n)*h,r[13]=(i+t)*c,r[14]=a*l,r[15]=1,r}function w1(r,e,n,t){var i,a,s,h,c,l,f,o,v,M,p=e[0],x=e[1],y=e[2],g=t[0],R=t[1],m=t[2],d=n[0],P=n[1],A=n[2];return Math.abs(p-d)<z.EPSILON&&Math.abs(x-P)<z.EPSILON&&Math.abs(y-A)<z.EPSILON?ue(r):(f=p-d,o=x-P,v=y-A,M=1/Math.hypot(f,o,v),f*=M,o*=M,v*=M,i=R*v-m*o,a=m*f-g*v,s=g*o-R*f,M=Math.hypot(i,a,s),M?(M=1/M,i*=M,a*=M,s*=M):(i=0,a=0,s=0),h=o*s-v*a,c=v*i-f*s,l=f*a-o*i,M=Math.hypot(h,c,l),M?(M=1/M,h*=M,c*=M,l*=M):(h=0,c=0,l=0),r[0]=i,r[1]=h,r[2]=f,r[3]=0,r[4]=a,r[5]=c,r[6]=o,r[7]=0,r[8]=s,r[9]=l,r[10]=v,r[11]=0,r[12]=-(i*p+a*x+s*y),r[13]=-(h*p+c*x+l*y),r[14]=-(f*p+o*x+v*y),r[15]=1,r)}function $1(r,e,n,t){var i=e[0],a=e[1],s=e[2],h=t[0],c=t[1],l=t[2],f=i-n[0],o=a-n[1],v=s-n[2],M=f*f+o*o+v*v;M>0&&(M=1/Math.sqrt(M),f*=M,o*=M,v*=M);var p=c*v-l*o,x=l*f-h*v,y=h*o-c*f;return M=p*p+x*x+y*y,M>0&&(M=1/Math.sqrt(M),p*=M,x*=M,y*=M),r[0]=p,r[1]=x,r[2]=y,r[3]=0,r[4]=o*y-v*x,r[5]=v*p-f*y,r[6]=f*x-o*p,r[7]=0,r[8]=f,r[9]=o,r[10]=v,r[11]=0,r[12]=i,r[13]=a,r[14]=s,r[15]=1,r}function z1(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function S1(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function C1(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3]+n[3],r[4]=e[4]+n[4],r[5]=e[5]+n[5],r[6]=e[6]+n[6],r[7]=e[7]+n[7],r[8]=e[8]+n[8],r[9]=e[9]+n[9],r[10]=e[10]+n[10],r[11]=e[11]+n[11],r[12]=e[12]+n[12],r[13]=e[13]+n[13],r[14]=e[14]+n[14],r[15]=e[15]+n[15],r}function Le(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r[3]=e[3]-n[3],r[4]=e[4]-n[4],r[5]=e[5]-n[5],r[6]=e[6]-n[6],r[7]=e[7]-n[7],r[8]=e[8]-n[8],r[9]=e[9]-n[9],r[10]=e[10]-n[10],r[11]=e[11]-n[11],r[12]=e[12]-n[12],r[13]=e[13]-n[13],r[14]=e[14]-n[14],r[15]=e[15]-n[15],r}function N1(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*n,r[9]=e[9]*n,r[10]=e[10]*n,r[11]=e[11]*n,r[12]=e[12]*n,r[13]=e[13]*n,r[14]=e[14]*n,r[15]=e[15]*n,r}function F1(r,e,n,t){return r[0]=e[0]+n[0]*t,r[1]=e[1]+n[1]*t,r[2]=e[2]+n[2]*t,r[3]=e[3]+n[3]*t,r[4]=e[4]+n[4]*t,r[5]=e[5]+n[5]*t,r[6]=e[6]+n[6]*t,r[7]=e[7]+n[7]*t,r[8]=e[8]+n[8]*t,r[9]=e[9]+n[9]*t,r[10]=e[10]+n[10]*t,r[11]=e[11]+n[11]*t,r[12]=e[12]+n[12]*t,r[13]=e[13]+n[13]*t,r[14]=e[14]+n[14]*t,r[15]=e[15]+n[15]*t,r}function q1(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}function Y1(r,e){var n=r[0],t=r[1],i=r[2],a=r[3],s=r[4],h=r[5],c=r[6],l=r[7],f=r[8],o=r[9],v=r[10],M=r[11],p=r[12],x=r[13],y=r[14],g=r[15],R=e[0],m=e[1],d=e[2],P=e[3],A=e[4],F=e[5],S=e[6],C=e[7],$=e[8],q=e[9],N=e[10],Y=e[11],L=e[12],X=e[13],rr=e[14],er=e[15];return Math.abs(n-R)<=z.EPSILON*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(t-m)<=z.EPSILON*Math.max(1,Math.abs(t),Math.abs(m))&&Math.abs(i-d)<=z.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-P)<=z.EPSILON*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(s-A)<=z.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(h-F)<=z.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(c-S)<=z.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(l-C)<=z.EPSILON*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(f-$)<=z.EPSILON*Math.max(1,Math.abs(f),Math.abs($))&&Math.abs(o-q)<=z.EPSILON*Math.max(1,Math.abs(o),Math.abs(q))&&Math.abs(v-N)<=z.EPSILON*Math.max(1,Math.abs(v),Math.abs(N))&&Math.abs(M-Y)<=z.EPSILON*Math.max(1,Math.abs(M),Math.abs(Y))&&Math.abs(p-L)<=z.EPSILON*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(x-X)<=z.EPSILON*Math.max(1,Math.abs(x),Math.abs(X))&&Math.abs(y-rr)<=z.EPSILON*Math.max(1,Math.abs(y),Math.abs(rr))&&Math.abs(g-er)<=z.EPSILON*Math.max(1,Math.abs(g),Math.abs(er))}var k1=Te;_.mul=k1;var b1=Le;_.sub=b1;var O={};function xr(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?xr=function(n){return typeof n}:xr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},xr(r)}Object.defineProperty(O,"__esModule",{value:!0}),O.create=$e,O.clone=Z1,O.fromValues=D1,O.copy=V1,O.set=X1,O.add=U1,O.subtract=ze,O.multiply=Se,O.divide=Ce,O.ceil=I1,O.floor=K1,O.min=G1,O.max=H1,O.round=Q1,O.scale=J1,O.scaleAndAdd=j1,O.distance=Ne,O.squaredDistance=Fe,O.length=qe,O.squaredLength=Ye,O.negate=ra,O.inverse=ea,O.normalize=na,O.dot=ta,O.cross=ia,O.lerp=sa,O.random=ha;var W1=O.transformMat4=ca;O.transformQuat=la,O.zero=fa,O.str=va,O.exactEquals=oa,O.equals=Ma,O.forEach=O.sqrLen=O.len=O.sqrDist=O.dist=O.div=O.mul=O.sub=void 0;var D=B1(W);function we(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(we=function(i){return i?n:e})(r)}function B1(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||xr(r)!=="object"&&typeof r!="function")return{default:r};var n=we(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function $e(){var r=new D.ARRAY_TYPE(4);return D.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Z1(r){var e=new D.ARRAY_TYPE(4);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function D1(r,e,n,t){var i=new D.ARRAY_TYPE(4);return i[0]=r,i[1]=e,i[2]=n,i[3]=t,i}function V1(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function X1(r,e,n,t,i){return r[0]=e,r[1]=n,r[2]=t,r[3]=i,r}function U1(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3]+n[3],r}function ze(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r[3]=e[3]-n[3],r}function Se(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r[3]=e[3]*n[3],r}function Ce(r,e,n){return r[0]=e[0]/n[0],r[1]=e[1]/n[1],r[2]=e[2]/n[2],r[3]=e[3]/n[3],r}function I1(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r[3]=Math.ceil(e[3]),r}function K1(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r[3]=Math.floor(e[3]),r}function G1(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r[3]=Math.min(e[3],n[3]),r}function H1(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r[3]=Math.max(e[3],n[3]),r}function Q1(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r[3]=Math.round(e[3]),r}function J1(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r}function j1(r,e,n,t){return r[0]=e[0]+n[0]*t,r[1]=e[1]+n[1]*t,r[2]=e[2]+n[2]*t,r[3]=e[3]+n[3]*t,r}function Ne(r,e){var n=e[0]-r[0],t=e[1]-r[1],i=e[2]-r[2],a=e[3]-r[3];return Math.hypot(n,t,i,a)}function Fe(r,e){var n=e[0]-r[0],t=e[1]-r[1],i=e[2]-r[2],a=e[3]-r[3];return n*n+t*t+i*i+a*a}function qe(r){var e=r[0],n=r[1],t=r[2],i=r[3];return Math.hypot(e,n,t,i)}function Ye(r){var e=r[0],n=r[1],t=r[2],i=r[3];return e*e+n*n+t*t+i*i}function ra(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r}function ea(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r[3]=1/e[3],r}function na(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=n*n+t*t+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),r[0]=n*s,r[1]=t*s,r[2]=i*s,r[3]=a*s,r}function ta(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function ia(r,e,n,t){var i=n[0]*t[1]-n[1]*t[0],a=n[0]*t[2]-n[2]*t[0],s=n[0]*t[3]-n[3]*t[0],h=n[1]*t[2]-n[2]*t[1],c=n[1]*t[3]-n[3]*t[1],l=n[2]*t[3]-n[3]*t[2],f=e[0],o=e[1],v=e[2],M=e[3];return r[0]=o*l-v*c+M*h,r[1]=-(f*l)+v*s-M*a,r[2]=f*c-o*s+M*i,r[3]=-(f*h)+o*a-v*i,r}function sa(r,e,n,t){var i=e[0],a=e[1],s=e[2],h=e[3];return r[0]=i+t*(n[0]-i),r[1]=a+t*(n[1]-a),r[2]=s+t*(n[2]-s),r[3]=h+t*(n[3]-h),r}function ha(r,e){e=e||1;var n,t,i,a,s,h;do n=D.RANDOM()*2-1,t=D.RANDOM()*2-1,s=n*n+t*t;while(s>=1);do i=D.RANDOM()*2-1,a=D.RANDOM()*2-1,h=i*i+a*a;while(h>=1);var c=Math.sqrt((1-s)/h);return r[0]=e*n,r[1]=e*t,r[2]=e*i*c,r[3]=e*a*c,r}function ca(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3];return r[0]=n[0]*t+n[4]*i+n[8]*a+n[12]*s,r[1]=n[1]*t+n[5]*i+n[9]*a+n[13]*s,r[2]=n[2]*t+n[6]*i+n[10]*a+n[14]*s,r[3]=n[3]*t+n[7]*i+n[11]*a+n[15]*s,r}function la(r,e,n){var t=e[0],i=e[1],a=e[2],s=n[0],h=n[1],c=n[2],l=n[3],f=l*t+h*a-c*i,o=l*i+c*t-s*a,v=l*a+s*i-h*t,M=-s*t-h*i-c*a;return r[0]=f*l+M*-s+o*-c-v*-h,r[1]=o*l+M*-h+v*-s-f*-c,r[2]=v*l+M*-c+f*-h-o*-s,r[3]=e[3],r}function fa(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r}function va(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}function oa(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]}function Ma(r,e){var n=r[0],t=r[1],i=r[2],a=r[3],s=e[0],h=e[1],c=e[2],l=e[3];return Math.abs(n-s)<=D.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(t-h)<=D.EPSILON*Math.max(1,Math.abs(t),Math.abs(h))&&Math.abs(i-c)<=D.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-l)<=D.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))}var pa=ze;O.sub=pa;var ya=Se;O.mul=ya;var xa=Ce;O.div=xa;var ma=Ne;O.dist=ma;var ga=Fe;O.sqrDist=ga;var da=qe;O.len=da;var ua=Ye;O.sqrLen=ua;var Ta=function(){var r=$e();return function(e,n,t,i,a,s){var h,c;for(n||(n=4),t||(t=0),i?c=Math.min(i*n+t,e.length):c=e.length,h=t;h<c;h+=n)r[0]=e[h],r[1]=e[h+1],r[2]=e[h+2],r[3]=e[h+3],a(r,r,s),e[h]=r[0],e[h+1]=r[1],e[h+2]=r[2],e[h+3]=r[3];return e}}();O.forEach=Ta;var Sr;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(Sr||(Sr={}));const _a=45*Math.PI/180,Ea=1,Cr=.1,Nr=500,Ra=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ar extends ai{static get IDENTITY(){return Aa()}static get ZERO(){return Oa()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Sr}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,t,i,a,s,h,c,l,f,o,v,M,p,x,y){return this[0]=e,this[1]=n,this[2]=t,this[3]=i,this[4]=a,this[5]=s,this[6]=h,this[7]=c,this[8]=l,this[9]=f,this[10]=o,this[11]=v,this[12]=M,this[13]=p,this[14]=x,this[15]=y,this.check()}setRowMajor(e,n,t,i,a,s,h,c,l,f,o,v,M,p,x,y){return this[0]=e,this[1]=a,this[2]=l,this[3]=M,this[4]=n,this[5]=s,this[6]=f,this[7]=p,this[8]=t,this[9]=h,this[10]=o,this[11]=x,this[12]=i,this[13]=c,this[14]=v,this[15]=y,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Ra)}fromObject(e){return this.check()}fromQuaternion(e){return Ui(this,e),this.check()}frustum(e){const{left:n,right:t,bottom:i,top:a,near:s=Cr,far:h=Nr}=e;return h===1/0?Pa(this,n,t,i,a,s):Ii(this,n,t,i,a,s,h),this.check()}lookAt(e){const{eye:n,center:t=[0,0,0],up:i=[0,1,0]}=e;return Ki(this,n,t,i),this.check()}ortho(e){const{left:n,right:t,bottom:i,top:a,near:s=Cr,far:h=Nr}=e;return Pe(this,n,t,i,a,s,h),this.check()}orthographic(e){const{fovy:n=_a,aspect:t=Ea,focalDistance:i=1,near:a=Cr,far:s=Nr}=e;ke(n);const h=n/2,c=i*Math.tan(h),l=c*t;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:a,far:s})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:t=1,near:i=.1,far:a=500}=e;return ke(n),Oe(this,n,t,i,a),this.check()}determinant(){return bi(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const t=this.getScale(n),i=1/t[0],a=1/t[1],s=1/t[2];return e[0]=this[0]*i,e[1]=this[1]*a,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*a,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*a,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const t=this.getScale(n),i=1/t[0],a=1/t[1],s=1/t[2];return e[0]=this[0]*i,e[1]=this[1]*a,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*a,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*a,e[8]=this[10]*s,e}transpose(){return Yi(this,this),this.check()}invert(){return ki(this,this),this.check()}multiplyLeft(e){return ge(this,e,this),this.check()}multiplyRight(e){return ge(this,this,e),this.check()}rotateX(e){return Di(this,this,e),this.check()}rotateY(e){return Vi(this,this,e),this.check()}rotateZ(e){return Xi(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return Zi(this,this,e,n),this.check()}scale(e){return Bi(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Wi(this,this,e),this.check()}transform(e,n){return e.length===4?(n=W1(n||[-0,-0,-0,-0],e,this),zr(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:t}=e;let i;switch(t){case 2:i=zn(n||[-0,-0],e,this);break;case 3:i=gt(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return zr(i,e.length),i}transformAsVector(e,n){let t;switch(e.length){case 2:t=xt(n||[-0,-0],e,this);break;case 3:t=mt(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return zr(t,e.length),t}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,t){return this.identity().translate([e,n,t])}}let mr,gr;function Oa(){return mr||(mr=new ar([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(mr)),mr}function Aa(){return gr||(gr=new ar,Object.freeze(gr)),gr}function ke(r){if(r>Math.PI*2)throw Error("expected radians")}function Pa(r,e,n,t,i,a){const s=2*a/(n-e),h=2*a/(i-t),c=(n+e)/(n-e),l=(i+t)/(i-t),f=-1,o=-1,v=-2*a;return r[0]=s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=c,r[9]=l,r[10]=f,r[11]=o,r[12]=0,r[13]=0,r[14]=v,r[15]=0,r}var u={};function dr(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?dr=function(n){return typeof n}:dr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},dr(r)}Object.defineProperty(u,"__esModule",{value:!0}),u.create=Fr,u.identity=wa,u.setAxisAngle=We,u.getAxisAngle=$a,u.getAngle=za,u.multiply=Be,u.rotateX=Sa,u.rotateY=Ca,u.rotateZ=Na,u.calculateW=Fa,u.exp=Ze,u.ln=De,u.pow=qa,u.slerp=Tr,u.random=Ya,u.invert=ka,u.conjugate=ba,u.fromMat3=Ve,u.fromEuler=Wa,u.str=Ba,u.setAxes=u.sqlerp=u.rotationTo=u.equals=u.exactEquals=u.normalize=u.sqrLen=u.squaredLength=u.len=u.length=u.lerp=u.dot=u.scale=u.mul=u.add=u.set=u.copy=u.fromValues=u.clone=void 0;var J=ur(W),La=ur(w),K=ur(T),Z=ur(O);function be(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(be=function(i){return i?n:e})(r)}function ur(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||dr(r)!=="object"&&typeof r!="function")return{default:r};var n=be(e);if(n&&n.has(r))return n.get(r);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var s=i?Object.getOwnPropertyDescriptor(r,a):null;s&&(s.get||s.set)?Object.defineProperty(t,a,s):t[a]=r[a]}return t.default=r,n&&n.set(r,t),t}function Fr(){var r=new J.ARRAY_TYPE(4);return J.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function wa(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function We(r,e,n){n=n*.5;var t=Math.sin(n);return r[0]=t*e[0],r[1]=t*e[1],r[2]=t*e[2],r[3]=Math.cos(n),r}function $a(r,e){var n=Math.acos(e[3])*2,t=Math.sin(n/2);return t>J.EPSILON?(r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t):(r[0]=1,r[1]=0,r[2]=0),n}function za(r,e){var n=Ue(r,e);return Math.acos(2*n*n-1)}function Be(r,e,n){var t=e[0],i=e[1],a=e[2],s=e[3],h=n[0],c=n[1],l=n[2],f=n[3];return r[0]=t*f+s*h+i*l-a*c,r[1]=i*f+s*c+a*h-t*l,r[2]=a*f+s*l+t*c-i*h,r[3]=s*f-t*h-i*c-a*l,r}function Sa(r,e,n){n*=.5;var t=e[0],i=e[1],a=e[2],s=e[3],h=Math.sin(n),c=Math.cos(n);return r[0]=t*c+s*h,r[1]=i*c+a*h,r[2]=a*c-i*h,r[3]=s*c-t*h,r}function Ca(r,e,n){n*=.5;var t=e[0],i=e[1],a=e[2],s=e[3],h=Math.sin(n),c=Math.cos(n);return r[0]=t*c-a*h,r[1]=i*c+s*h,r[2]=a*c+t*h,r[3]=s*c-i*h,r}function Na(r,e,n){n*=.5;var t=e[0],i=e[1],a=e[2],s=e[3],h=Math.sin(n),c=Math.cos(n);return r[0]=t*c+i*h,r[1]=i*c-t*h,r[2]=a*c+s*h,r[3]=s*c-a*h,r}function Fa(r,e){var n=e[0],t=e[1],i=e[2];return r[0]=n,r[1]=t,r[2]=i,r[3]=Math.sqrt(Math.abs(1-n*n-t*t-i*i)),r}function Ze(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=Math.sqrt(n*n+t*t+i*i),h=Math.exp(a),c=s>0?h*Math.sin(s)/s:0;return r[0]=n*c,r[1]=t*c,r[2]=i*c,r[3]=h*Math.cos(s),r}function De(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=Math.sqrt(n*n+t*t+i*i),h=s>0?Math.atan2(s,a)/s:0;return r[0]=n*h,r[1]=t*h,r[2]=i*h,r[3]=.5*Math.log(n*n+t*t+i*i+a*a),r}function qa(r,e,n){return De(r,e),Xe(r,r,n),Ze(r,r),r}function Tr(r,e,n,t){var i=e[0],a=e[1],s=e[2],h=e[3],c=n[0],l=n[1],f=n[2],o=n[3],v,M,p,x,y;return M=i*c+a*l+s*f+h*o,M<0&&(M=-M,c=-c,l=-l,f=-f,o=-o),1-M>J.EPSILON?(v=Math.acos(M),p=Math.sin(v),x=Math.sin((1-t)*v)/p,y=Math.sin(t*v)/p):(x=1-t,y=t),r[0]=x*i+y*c,r[1]=x*a+y*l,r[2]=x*s+y*f,r[3]=x*h+y*o,r}function Ya(r){var e=J.RANDOM(),n=J.RANDOM(),t=J.RANDOM(),i=Math.sqrt(1-e),a=Math.sqrt(e);return r[0]=i*Math.sin(2*Math.PI*n),r[1]=i*Math.cos(2*Math.PI*n),r[2]=a*Math.sin(2*Math.PI*t),r[3]=a*Math.cos(2*Math.PI*t),r}function ka(r,e){var n=e[0],t=e[1],i=e[2],a=e[3],s=n*n+t*t+i*i+a*a,h=s?1/s:0;return r[0]=-n*h,r[1]=-t*h,r[2]=-i*h,r[3]=a*h,r}function ba(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function Ve(r,e){var n=e[0]+e[4]+e[8],t;if(n>0)t=Math.sqrt(n+1),r[3]=.5*t,t=.5/t,r[0]=(e[5]-e[7])*t,r[1]=(e[6]-e[2])*t,r[2]=(e[1]-e[3])*t;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var a=(i+1)%3,s=(i+2)%3;t=Math.sqrt(e[i*3+i]-e[a*3+a]-e[s*3+s]+1),r[i]=.5*t,t=.5/t,r[3]=(e[a*3+s]-e[s*3+a])*t,r[a]=(e[a*3+i]+e[i*3+a])*t,r[s]=(e[s*3+i]+e[i*3+s])*t}return r}function Wa(r,e,n,t){var i=.5*Math.PI/180;e*=i,n*=i,t*=i;var a=Math.sin(e),s=Math.cos(e),h=Math.sin(n),c=Math.cos(n),l=Math.sin(t),f=Math.cos(t);return r[0]=a*c*f-s*h*l,r[1]=s*h*f+a*c*l,r[2]=s*c*l-a*h*f,r[3]=s*c*f+a*h*l,r}function Ba(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}var Za=Z.clone;u.clone=Za;var Da=Z.fromValues;u.fromValues=Da;var Va=Z.copy;u.copy=Va;var Xa=Z.set;u.set=Xa;var Ua=Z.add;u.add=Ua;var Ia=Be;u.mul=Ia;var Xe=Z.scale;u.scale=Xe;var Ue=Z.dot;u.dot=Ue;var Ka=Z.lerp;u.lerp=Ka;var Ie=Z.length;u.length=Ie;var Ga=Ie;u.len=Ga;var Ke=Z.squaredLength;u.squaredLength=Ke;var Ha=Ke;u.sqrLen=Ha;var qr=Z.normalize;u.normalize=qr;var Qa=Z.exactEquals;u.exactEquals=Qa;var Ja=Z.equals;u.equals=Ja;var ja=function(){var r=K.create(),e=K.fromValues(1,0,0),n=K.fromValues(0,1,0);return function(t,i,a){var s=K.dot(i,a);return s<-.999999?(K.cross(r,e,i),K.len(r)<1e-6&&K.cross(r,n,i),K.normalize(r,r),We(t,r,Math.PI),t):s>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(K.cross(r,i,a),t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1+s,qr(t,t))}}();u.rotationTo=ja;var r0=function(){var r=Fr(),e=Fr();return function(n,t,i,a,s,h){return Tr(r,t,s,h),Tr(e,i,a,h),Tr(n,r,e,2*h*(1-h)),n}}();u.sqlerp=r0;var e0=function(){var r=La.create();return function(e,n,t,i){return r[0]=t[0],r[3]=t[1],r[6]=t[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-n[0],r[5]=-n[1],r[8]=-n[2],qr(e,Ve(e,r))}}();u.setAxes=e0;var Ge;(function(r){r[r.ZYX=0]="ZYX",r[r.YXZ=1]="YXZ",r[r.XZY=2]="XZY",r[r.ZXY=3]="ZXY",r[r.YZX=4]="YZX",r[r.XYZ=5]="XYZ"})(Ge||(Ge={}));const b=3.141592653589793,_r=6378245,Er=.006693421622965943,Rr=b*3e3/180;function sr(r,e,n){const t=b/180*e,i=Math.pow(2,n),a=Math.floor((r+180)/360*i),s=Math.floor((1-Math.asinh(Math.tan(t))/b)/2*i);return[a,s]}function He(r,e,n){const t=Math.pow(2,n),i=r/t*360-180,a=Math.atan(Math.sinh(b*(1-2*e/t)))*180/b;return[i,a]}function n0(r,e){let n=je(r-105,e-35),t=rn(r-105,e-35);const i=e/180*b;let a=Math.sin(i);a=1-Er*a*a;const s=Math.sqrt(a);n=n*180/(_r*(1-Er)/(a*s)*b),t=t*180/(_r/s*Math.cos(i)*b);const h=e+n;return{lng:r+t,lat:h}}function Qe(r,e){const n=i0(r,e),t=r*2-n.lng,i=e*2-n.lat;return{lng:t,lat:i}}function Je(r,e){const n=Math.sqrt(r*r+e*e)+2e-5*Math.sin(e*Rr),t=Math.atan2(e,r)+3e-6*Math.cos(r*Rr),i=n*Math.cos(t)+.0065,a=n*Math.sin(t)+.006;return{lng:i,lat:a}}function t0(r,e){const n=r-.0065,t=e-.006,i=Math.sqrt(n*n+t*t)-2e-5*Math.sin(t*Rr),a=Math.atan2(t,n)-3e-6*Math.cos(n*Rr),s=i*Math.cos(a),h=i*Math.sin(a);return{lng:s,lat:h}}function i0(r,e){let n=je(r-105,e-35),t=rn(r-105,e-35);const i=e/180*b;let a=Math.sin(i);a=1-Er*a*a;const s=Math.sqrt(a);n=n*180/(_r*(1-Er)/(a*s)*b),t=t*180/(_r/s*Math.cos(i)*b);const h=e+n;return{lng:r+t,lat:h}}function je(r,e){let n=-100+2*r+3*e+.2*e*e+.1*r*e+.2*Math.sqrt(Math.abs(r));return n+=(20*Math.sin(6*r*b)+20*Math.sin(2*r*b))*2/3,n+=(20*Math.sin(e*b)+40*Math.sin(e/3*b))*2/3,n+=(160*Math.sin(e/12*b)+320*Math.sin(e*b/30))*2/3,n}function rn(r,e){let n=300+r+2*e+.1*r*r+.1*r*e+.1*Math.sqrt(Math.abs(r));return n+=(20*Math.sin(6*r*b)+20*Math.sin(2*r*b))*2/3,n+=(20*Math.sin(r*b)+40*Math.sin(r/3*b))*2/3,n+=(150*Math.sin(r/12*b)+300*Math.sin(r/30*b))*2/3,n}function en(r,e){for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r}function a0(r,e){for(var n in e)r[n]=e[n]}function nn(r){return typeof r=="string"}var tn=void 0,Or=null;function V(r,e){isNaN(r)&&(r=Ib(r),r=isNaN(r)?0:r),nn(r)&&(r=parseFloat(r)),isNaN(e)&&(e=Ib(e),e=isNaN(e)?0:e),nn(e)&&(e=parseFloat(e)),this.lng=r,this.lat=e}V.TL=function(r){return r&&180>=r.lng&&-180<=r.lng&&74>=r.lat&&-74<=r.lat},V.prototype.lb=function(r){return r&&this.lat==r.lat&&this.lng==r.lng};function Ar(r,e){this.x=r||0,this.y=e||0,this.x=this.x,this.y=this.y}Ar.prototype.lb=function(r){return r&&r.x==this.x&&r.y==this.y};function Yr(){}Yr.prototype.nh=function(){aa("lngLatToPoint\u65B9\u6CD5\u672A\u5B9E\u73B0")},Yr.prototype.wi=function(){aa("pointToLngLat\u65B9\u6CD5\u672A\u5B9E\u73B0")};function G(){}G.prototype=new Yr,en(G,{$O:637099681e-2,lG:[1289059486e-2,836237787e-2,5591021,348198983e-2,167804312e-2,0],Au:[75,60,45,30,15,0],fP:[[1410526172116255e-23,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,173379812e-1],[-7435856389565537e-24,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1026014486e-2],[-3030883460898826e-23,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,685681737e-2],[-1981981304930552e-23,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,448277706e-2],[309191371068437e-23,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,25551644e-1],[2890871144776878e-24,8983055095805407e-21,-3068298e-14,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],iG:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,6477955746671607e-7,-4082003173641316e-6,1077490566351142e-5,-1517187553151559e-5,1205306533862167e-5,-5124939663577472e-6,9133119359512032e-7,67.5],[.00337398766765,111320.7020202162,4481351045890365e-9,-2339375119931662e-8,7968221547186455e-8,-1159649932797253e-7,9723671115602145e-8,-4366194633752821e-8,8477230501135234e-9,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837749470245e-9,992013.7397791013,-122195221711287e-8,1340652697009075e-9,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758690035394e-9,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],Z1:function(i,e){if(!i||!e)return 0;var n,t,i=this.Fb(i);return i?(n=this.Tk(i.lng),t=this.Tk(i.lat),e=this.Fb(e),e?this.Pe(n,this.Tk(e.lng),t,this.Tk(e.lat)):0):0},Vo:function(r,e){return!r||!e?0:(r.lng=this.JD(r.lng,-180,180),r.lat=this.ND(r.lat,-74,74),e.lng=this.JD(e.lng,-180,180),e.lat=this.ND(e.lat,-74,74),this.Pe(this.Tk(r.lng),this.Tk(e.lng),this.Tk(r.lat),this.Tk(e.lat)))},Fb:function(r){if(r===Or||r===tn)return new V(0,0);var e,n;e=new V(Math.abs(r.lng),Math.abs(r.lat));for(var t=0;t<this.lG.length;t++)if(e.lat>=this.lG[t]){n=this.fP[t];break}return r=this.gK(r,n),r=new V(r.lng.toFixed(6),r.lat.toFixed(6))},Eb:function(r){if(r===Or||r===tn||180<r.lng||-180>r.lng||90<r.lat||-90>r.lat)return new V(0,0);var e,n;r.lng=this.JD(r.lng,-180,180),r.lat=this.ND(r.lat,-74,74),e=new V(r.lng,r.lat);for(var t=0;t<this.Au.length;t++)if(e.lat>=this.Au[t]){n=this.iG[t];break}if(!n){for(t=0;t<this.Au.length;t++)if(e.lat<=-this.Au[t]){n=this.iG[t];break}}return r=this.gK(r,n),r=new V(r.lng.toFixed(2),r.lat.toFixed(2))},gK:function(r,e){if(r&&e){var n=e[0]+e[1]*Math.abs(r.lng),t=Math.abs(r.lat)/e[9],t=e[2]+e[3]*t+e[4]*t*t+e[5]*t*t*t+e[6]*t*t*t*t+e[7]*t*t*t*t*t+e[8]*t*t*t*t*t*t,n=n*(0>r.lng?-1:1),t=t*(0>r.lat?-1:1);return new V(n,t)}},Pe:function(r,e,n,t){return this.$O*Math.acos(Math.sin(n)*Math.sin(t)+Math.cos(n)*Math.cos(t)*Math.cos(e-r))},Tk:function(r){return Math.PI*r/180},Z3:function(r){return 180*r/Math.PI},ND:function(r,e,n){return e!=Or&&(r=Math.max(r,e)),n!=Or&&(r=Math.min(r,n)),r},JD:function(r,e,n){for(;r>n;)r-=n-e;for(;r<e;)r+=n-e;return r}}),en(G.prototype,{Jm:function(r){return G.Eb(r)},nh:function(r){return r=G.Eb(r),new Ar(r.lng,r.lat)},qh:function(r){return G.Fb(r)},wi:function(r){return r=new V(r.x,r.y),G.Fb(r)},fc:function(r,e,n,t,i){if(r)return r=this.Jm(r,i),e=this.Lc(e),new Ar(Math.round((r.lng-n.lng)/e+t.width/2),Math.round((n.lat-r.lat)/e+t.height/2))},zb:function(r,e,n,t,i){if(r)return e=this.Lc(e),this.qh(new V(n.lng+e*(r.x-t.width/2),n.lat-e*(r.y-t.height/2)),i)},Lc:function(r){return Math.pow(2,18-r)}});var kr=G.prototype;a0(kr,{lngLatToPoint:kr.nh,pointToLngLat:kr.wi});let br={Point:V,Pixel:Ar,MercatorProjection:G};class s0{constructor(e,n){this.projection=new br.MercatorProjection,this.levelMax=e,this.levelMin=n}_getRetain(e){return Math.pow(2,e-18)}getResolution(e,n){return Math.pow(2,18-n)*Math.cos(e)}lnglatToPoint(e,n){let t=new br.Point(e,n),i=this.projection.lngLatToPoint(t);return{pointX:i.x,pointY:i.y}}pointToLnglat(e,n){let t=new br.Pixel(e,n),i=this.projection.pointToLngLat(t);return{lng:i.lng,lat:i.lat}}_lngToTileX(e,n){let t=this.lnglatToPoint(e,0);return Math.floor(t.pointX*this._getRetain(n)/256)}_latToTileY(e,n){let t=this.lnglatToPoint(0,e);return Math.floor(t.pointY*this._getRetain(n)/256)}lnglatToTile(e,n,t){let i=this._lngToTileX(e,t),a=this._latToTileY(n,t);return[i,a]}_lngToPixelX(e,n){let t=this._lngToTileX(e,n),i=this.lnglatToPoint(e,0);return Math.floor(i.pointX*this._getRetain(n)-t*256)}_latToPixelY(e,n){let t=this._latToTileY(e,n),i=this.lnglatToPoint(0,e);return Math.floor(i.pointY*this._getRetain(n)-t*256)}lnglatToPixel(e,n,t){let i=this._lngToPixelX(e,t),a=this._latToPixelY(n,t);return{pixelX:i,pixelY:a}}_pixelXToLng(e,n,t){let i=(n*256+e)/this._getRetain(t);return this.pointToLnglat(i,0).lng}_pixelYToLat(e,n,t){let i=(n*256+e)/this._getRetain(t);return this.pointToLnglat(0,i).lat}pixelToLnglat(e,n,t,i,a){let s=(t*256+e)/this._getRetain(a),h=(i*256+n)/this._getRetain(a),c=this.pointToLnglat(s,h);return[c.lng,c.lat]}}Object.freeze=function(r){return r};var h0=/\{ *([\w_-]+) *\}/g;function c0(r,e){return r.replace(h0,function(n,t){let i=e[t];if(i===void 0)throw new Error(`No value provided for variable ${n}`);return typeof i=="function"&&(i=i(e)),i})}class l0{constructor(e,n){if(this.program=null,this.showTiles=[],this.isReadRender=!1,this.isLayerShow=!1,this.tileCache=[],this.gridCache={},this.transformBaidu=new s0,this.maskCache=[],this._projectionMatrix=new ar,this._viewMatrix4=new ar,this._mvpMatrix4=new ar,this.isOrtho=!1,!e)throw new Error("\u8BF7\u4F20\u5165\u5730\u56FE\u5B9E\u4F8B");this.validate(n),this.map=e,this.center=e.getCenter().toArray(),this.options=Object.assign(this.getDefaultGlLayerOptions(),n),this.customCoords=e.customCoords,this.customCoords.lngLatsToCoords([this.center]),this.layer=new AMap.GLCustomLayer({zooms:this.options.zooms,opacity:this.options.opacity,visible:this.options.visible,zIndex:this.options.zIndex,init:t=>{this.gl=t;const i=`
                    uniform mat4 u_ProjectionMatrix;
                    uniform mat4 u_ViewMatrix4;
                    uniform mat4 u_MvpMatrix4;
                    uniform bool u_isOrtho;
                    attribute vec2 a_pos;
                    attribute vec2 a_TextCoord;
                    varying vec2 v_TextCoord;
                    void main() {
                       if(u_isOrtho){
                         gl_Position = u_MvpMatrix4 * vec4(a_pos,0.0, 1.0);
                       }else{
                         gl_Position = u_ProjectionMatrix * u_ViewMatrix4 * vec4(a_pos,0.0, 1.0);
                       }
                       v_TextCoord = a_TextCoord;
                    }`,a=`
                    precision mediump float;
                    uniform sampler2D u_Sampler;
                    uniform bool u_isFirst;
                    varying vec2 v_TextCoord;
                    void main() {
                       if(u_isFirst){
                         gl_FragColor = vec4(1.0, 0.0, 0.0, 0.0);
                       }else{
                         gl_FragColor = texture2D(u_Sampler, v_TextCoord);
                       }
                    }`,s=t.createShader(t.VERTEX_SHADER);t.shaderSource(s,i),t.compileShader(s);const h=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(h,a),t.compileShader(h),this.program=t.createProgram(),t.attachShader(this.program,s),t.attachShader(this.program,h),t.linkProgram(this.program),this.a_Pos=t.getAttribLocation(this.program,"a_pos"),this.a_TextCoord=t.getAttribLocation(this.program,"a_TextCoord");const c="uniform mat4 u_ProjectionMatrix;uniform mat4 u_ViewMatrix4;uniform mat4 u_MvpMatrix4;uniform bool u_isOrtho;attribute vec2 a_pos;void main() {   if(u_isOrtho){     gl_Position = u_MvpMatrix4 * vec4(a_pos,0.0, 1.0);   }else{     gl_Position = u_ProjectionMatrix * u_ViewMatrix4 * vec4(a_pos,0.0, 1.0);   }}",l="void main() {    gl_FragColor = vec4(0.0, 1.0, 0.0, 0.0);}",f=t.createShader(t.VERTEX_SHADER);t.shaderSource(f,c),t.compileShader(f);const o=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(o,l),t.compileShader(o),this.maskProgram=t.createProgram(),t.attachShader(this.maskProgram,f),t.attachShader(this.maskProgram,o),t.linkProgram(this.maskProgram),this.mask_Pos=t.getAttribLocation(this.maskProgram,"a_pos"),this.options.visible&&(this.isLayerShow=!0),this.mapCallback=()=>{this.isLayerShow&&this.update()},e.on("dragging",this.mapCallback),e.on("moveend",this.mapCallback),e.on("zoomchange",this.mapCallback),e.on("rotatechange",this.mapCallback),this._createMask(this.options.mask),this.update()},render:t=>{if(!this.isReadRender)return;const i=this.options.zooms;if(!(this.map.getZoom()<i[0]||this.map.getZoom()>i[1])){if(this.customCoords.setCenter(this.center),e.getView().type==="3D"){this.isOrtho=!1;const{near:a,far:s,fov:h,up:c,lookAt:l,position:f}=this.customCoords.getCameraParams();this._viewMatrix4.lookAt({eye:f,center:l,up:c}).translate([0,0,this.options.altitude]),this._projectionMatrix.perspective({fovy:h*Math.PI/180,far:s,near:a,aspect:t.drawingBufferWidth/t.drawingBufferHeight})}else{this.isOrtho=!0;const a=this.customCoords.getMVPMatrix();this._mvpMatrix4.copy(a)}this.maskCache.length>0?(t.clearStencil(0),t.clear(t.STENCIL_BUFFER_BIT),t.enable(t.STENCIL_TEST),t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),this._renderMask(t),t.stencilFunc(t.EQUAL,1,255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.disable(t.DEPTH_TEST),this._renderTile(t),t.enable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST)):this._renderTile(t)}}}),e.add(this.layer)}_renderMask(e){if(this.maskCache.length){this.customCoords.setCenter(this.center),e.useProgram(this.maskProgram),this.setVertex(e,this.maskProgram);for(const n of this.maskCache)e.bindBuffer(e.ARRAY_BUFFER,n.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.indexBuffer),e.vertexAttribPointer(this.mask_Pos,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.mask_Pos),e.drawElements(e.TRIANGLES,n.deviationLength,e.UNSIGNED_INT,0)}}_renderTile(e){var n,t,i,a,s,h;this.customCoords.setCenter(this.center),e.useProgram(this.program),this.setVertex(e,this.program);let c=0;for(const l of this.showTiles){if(!l.isLoad||l.imageError)continue;e.bindTexture(e.TEXTURE_2D,l.texture),e.activeTexture(e.TEXTURE0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT);const f=e.getUniformLocation(this.program,"u_Sampler");e.uniform1i(f,0),e.uniform1f(e.getUniformLocation(this.program,"u_isFirst"),c===0),e.bindBuffer(e.ARRAY_BUFFER,l.buffer),e.vertexAttribPointer(this.a_Pos,(n=l.PosParam)===null||n===void 0?void 0:n.size,e.FLOAT,!1,(t=l.PosParam)===null||t===void 0?void 0:t.stride,(i=l.PosParam)===null||i===void 0?void 0:i.offset),e.vertexAttribPointer(this.a_TextCoord,(a=l.TextCoordParam)===null||a===void 0?void 0:a.size,e.FLOAT,!1,(s=l.TextCoordParam)===null||s===void 0?void 0:s.stride,(h=l.TextCoordParam)===null||h===void 0?void 0:h.offset),e.enableVertexAttribArray(this.a_Pos),e.enableVertexAttribArray(this.a_TextCoord),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,0,4),c++}}validate(e){if(!e.url)throw new Error("\u8BF7\u4F20\u5165url");if(e.url.includes("{s}")&&(!e.subdomains||e.subdomains.length===0))throw new Error("\u8BF7\u4F20\u5165subdomains")}getDefaultGlLayerOptions(){return{url:"",zooms:[2,18],opacity:1,visible:!0,zIndex:120,proj:"gcj02",tileType:"xyz",debug:!1,cacheSize:512,tileMaxZoom:18,altitude:0}}_createMask(e){if(!e||e.length===0){this.maskCache=[];return}const n=this.getMaskDeep(e);if(n<2||n>4){console.warn("mask\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E");return}n===2?e=[[e]]:n===3&&(e=[e]);for(let t of e){t=this._convertMaskLnglatToCoords(t);const i=hr.exports.flatten(t),a=hr.exports(i.vertices,i.holes,i.dimensions),s=this.gl,h=new Float32Array(i.vertices),c=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,c),s.bufferData(s.ARRAY_BUFFER,h,s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,null);const l=s.createBuffer();s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,l),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint32Array(a),s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),this.maskCache.push({FSIZE:h.BYTES_PER_ELEMENT,vertexBuffer:c,indexBuffer:l,deviationLength:a.length})}}getMaskDeep(e,n=1){return e.length?typeof e[0]=="number"?n:this.getMaskDeep(e[0],n+1):-1}_convertMaskLnglatToCoords(e){return!e||e.length===0?e:typeof e[0]=="number"?this._convertLnglatToCoords([e[0],e[1]]):e.map(n=>this._convertMaskLnglatToCoords(n))}_convertLnglatToCoords(e){return this.customCoords.setCenter(this.center),this.customCoords.lngLatsToCoords([e])[0]}update(){if(!this.gl)return;this.isReadRender=!1;const e=this.gl,n=this.map,t=n.getCenter();let i=Math.ceil(n.getZoom());i>this.options.tileMaxZoom&&(i=this.options.tileMaxZoom);const a=n.getBounds();let s,h,c,l;if(this.options.tileType==="xyz"?(c=a.getNorthWest().toArray(),l=a.getSouthEast().toArray()):(c=a.getSouthWest().toArray(),l=a.getNorthEast().toArray()),this.options.proj==="wgs84"){const v=Qe(...c),M=Qe(...l);s=sr(v.lng,v.lat,i),h=sr(M.lng,M.lat,i)}else if(this.options.proj==="bd09"){const v=Je(...c),M=Je(...l);s=this.transformBaidu.lnglatToTile(v.lng,v.lat,i),h=this.transformBaidu.lnglatToTile(M.lng,M.lat,i)}else s=sr(c[0],c[1],i),h=sr(l[0],l[1],i);const f=[];for(let v=s[0];v<=h[0];v++)for(let M=s[1];M<=h[1];M++){const p={x:v,y:M,z:i};f.push(p),this.addGridCache(p,0,0),v===h[0]&&this.addGridCache(p,1,0),M===h[1]&&this.addGridCache(p,0,1),v===h[0]&&M===h[1]&&this.addGridCache(p,1,1)}let o;this.options.tileType==="xyz"?o=sr(t.getLng(),t.getLat(),i):o=this.transformBaidu.lnglatToTile(t.getLng(),t.getLat(),i),f.sort((v,M)=>this.tileDistance(v,o)-this.tileDistance(M,o)),this._cancelOutViewImage(f),this._clearShowTile();for(const v of f){const M=this.createTileKey(v),p=this.getTileCache(M);if(p){if(p.imageError)continue;!p.isLoad&&p.image&&p.imageCanceled&&(p.image.src=p.url,p.imageCanceled=!1),this.showTiles.push(p)}else{const x=this.createTile(e,v);this.showTiles.push(x),this.pushTileCache(x)}}this.showTiles.length>0&&this.showTiles.unshift(this.showTiles[0]),this.isReadRender=!0}_cancelOutViewImage(e){this.tileCache.forEach(n=>{e.findIndex(t=>this.createTileKey(t)===n.xyzKey)===-1&&!n.isLoad&&n.image&&(n.image.src="",n.imageCanceled=!0)})}getTileCache(e){return this.tileCache.find(n=>n.xyzKey===e)}pushTileCache(e){const n=this.options.cacheSize;n>0&&this.tileCache.length>=n&&(this.showTiles.findIndex(t=>t.xyzKey===this.tileCache[0].xyzKey)<0&&this._destroyTile(this.tileCache[0]),this.tileCache.splice(0,1)),this.tileCache.push(e)}addGridCache(e,n,t){const i=this.createTileKey(e.x+n,e.y+t,e.z);if(!this.gridCache[i])if(this.options.proj==="wgs84"){const a=n0(...He(e.x+n,e.y+t,e.z)),s=this._convertLnglatToCoords([a.lng,a.lat]);this.gridCache[i]={lng:s[0],lat:s[1]}}else if(this.options.tileType==="bd09"){const a=t0(...this.transformBaidu.pixelToLnglat(0,0,e.x+n,e.y+t,e.z)),s=this._convertLnglatToCoords([a.lng,a.lat]);this.gridCache[i]={lng:s[0],lat:s[1]}}else{const a=this._convertLnglatToCoords(He(e.x+n,e.y+t,e.z));this.gridCache[i]={lng:a[0],lat:a[1]}}}tileDistance(e,n){return Math.sqrt(Math.pow(e.x-n[0],2)+Math.pow(e.y-n[1],2))}createTileKey(e,n,t){return e instanceof Object?`${e.z}/${e.x}/${e.y}`:`${t}/${e}/${n}`}deepFormatTileNumber(e,n){return e>=0&&e<n?e:(e>0&&e>=n?e=e-n:e<0&&(e=e+n),this.deepFormatTileNumber(e,n))}createTile(e,n){let t=Math.ceil(this.map.getZoom());t>this.options.tileMaxZoom&&(t=this.options.tileMaxZoom);const i=Math.pow(2,t);let a=n.x,s=n.y;a=this.deepFormatTileNumber(a,i),s=this.deepFormatTileNumber(s,i);const h={x:a,y:s,z:n.z};this.options.subdomains&&(h.s=this.options.subdomains[Math.abs(n.x+n.y)%this.options.subdomains.length]);const c=c0(this.options.url,h),l={xyz:n,xyzKey:this.createTileKey(n),isLoad:!1,url:c,imageCanceled:!1};let f,o,v,M;this.options.tileType==="xyz"?(f=this.gridCache[this.createTileKey(n)],o=this.gridCache[this.createTileKey(n.x+1,n.y,n.z)],v=this.gridCache[this.createTileKey(n.x,n.y+1,n.z)],M=this.gridCache[this.createTileKey(n.x+1,n.y+1,n.z)]):(f=this.gridCache[this.createTileKey(n.x,n.y+1,n.z)],o=this.gridCache[this.createTileKey(n.x+1,n.y+1,n.z)],v=this.gridCache[this.createTileKey(n)],M=this.gridCache[this.createTileKey(n.x+1,n.y,n.z)]);const p=new Float32Array([f.lng,f.lat,0,1,v.lng,v.lat,0,0,o.lng,o.lat,1,1,M.lng,M.lat,1,0]),x=p.BYTES_PER_ELEMENT,y=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,y),e.bufferData(e.ARRAY_BUFFER,p,e.STATIC_DRAW),l.buffer=y,l.PosParam={size:2,stride:x*4,offset:0},l.TextCoordParam={size:2,stride:x*4,offset:x*2};const g=new Image(256,256);return g.onload=()=>{if(l.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,l.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),this.options.debug){const R=document.createElement("canvas");R.width=256,R.height=256;const m=R.getContext("2d");m.drawImage(g,0,0),m.font="25px Verdana",m.fillStyle="#ff0000",m.strokeStyle="#FF0000",m.strokeRect(0,0,256,256),m.fillText(`(${[n.x,n.y,n.z].join(",")})`,10,30),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,R)}else e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,g);l.isLoad=!0,this.showTiles.findIndex(R=>R===l)>=0&&this.requestRender()},g.onerror=()=>{l.imageCanceled||(l.imageError=!0)},g.crossOrigin="anonymous",g.src=c,l.image=g,l}setVertex(e,n){e.uniformMatrix4fv(e.getUniformLocation(n,"u_ProjectionMatrix"),!1,this._projectionMatrix.toArray()),e.uniformMatrix4fv(e.getUniformLocation(n,"u_ViewMatrix4"),!1,this._viewMatrix4.toArray()),e.uniformMatrix4fv(e.getUniformLocation(n,"u_MvpMatrix4"),!1,this._mvpMatrix4.toArray()),e.uniform1f(e.getUniformLocation(n,"u_isOrtho"),this.isOrtho)}requestRender(){this.map&&(this.map.getContext().setDirty(),this.map.render())}show(){this.isLayerShow=!0,this.update(),this.layer.show()}hide(){this.isLayerShow=!1,this.layer.hide()}getzIndex(){return this.layer.getzIndex()}setzIndex(e){this.options.zIndex=e,this.layer.setzIndex(e)}getOpacity(){return this.layer.getOpacity()}setOpacity(e){this.options.opacity=e,this.layer.setOpacity(e)}getZooms(){return this.layer.getZooms()}setZooms(e){this.options.zooms=e,this.layer.setZooms(e)}setMask(e){this._destroyMaskCache(),this._createMask(e),this.options.mask=e,this.requestRender()}getMask(){return this.options.mask}getMap(){return this.map}_destroyMaskCache(){this.maskCache.forEach(e=>{this.gl.deleteBuffer(e.vertexBuffer),this.gl.deleteBuffer(e.indexBuffer)}),this.maskCache=[]}_destroyTile(e){e.buffer&&this.gl.deleteBuffer(e.buffer),e.texture&&this.gl.deleteTexture(e.texture)}_clearAllCacheTile(){this.tileCache.forEach(e=>{this._destroyTile(e)}),this.tileCache=[]}_clearShowTile(){this.showTiles.forEach(e=>{this.tileCache.findIndex(n=>n.xyzKey===e.xyzKey)<0&&this._destroyTile(e)}),this.showTiles=[]}destroy(){this.isLayerShow=!1,this.map.remove(this.layer),this.map.off("dragging",this.mapCallback),this.map.off("moveend",this.mapCallback),this.map.off("zoomchange",this.mapCallback),this.map.off("rotatechange",this.mapCallback),this._destroyMaskCache(),this._clearShowTile(),this._clearAllCacheTile(),this.gridCache={},this.transformBaidu=null,this.mapCallback=null,this.gl.deleteProgram(this.program),this.gl.deleteProgram(this.maskProgram),this.program=null,this.maskProgram=null,this.options=void 0,this.customCoords=void 0,this.center=void 0,this.layer=null,this.gl=null,this.map=null}}export{l0 as CustomXyzLayer};
//# sourceMappingURL=index.mjs.map
